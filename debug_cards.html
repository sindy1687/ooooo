<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>å¡ç‰‡èª¿è©¦ - Typing Hero</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    .debug-info {
      background: #2a2a2a;
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #444;
    }
    .error { border-color: #ff4444; background: #3a2a2a; }
    .success { border-color: #44ff44; background: #2a3a2a; }
    .warning { border-color: #ffff44; background: #3a3a2a; }
    button {
      background: #4a6a7c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover { background: #5a7a8c; }
    .log {
      background: #000;
      color: #0f0;
      padding: 10px;
      border-radius: 4px;
      font-family: monospace;
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>ğŸ” å¡ç‰‡èª¿è©¦å·¥å…·</h1>
  
  <div class="debug-info">
    <h3>ğŸ“Š å³æ™‚ç‹€æ…‹</h3>
    <div id="status"></div>
    <button onclick="checkStatus()">ğŸ”„ æª¢æŸ¥ç‹€æ…‹</button>
  </div>
  
  <div class="debug-info">
    <h3>ğŸ’¾ æœ¬åœ°å„²å­˜</h3>
    <div id="storage"></div>
    <button onclick="checkStorage()">ğŸ”„ æª¢æŸ¥å„²å­˜</button>
  </div>
  
  <div class="debug-info">
    <h3>ğŸ´ å¡ç‰‡è³‡æ–™</h3>
    <div id="cards"></div>
    <button onclick="checkCards()">ğŸ”„ æª¢æŸ¥å¡ç‰‡</button>
  </div>
  
  <div class="debug-info">
    <h3>ğŸ“ æ“ä½œæ—¥èªŒ</h3>
    <div id="log" class="log"></div>
    <button onclick="clearLog()">ğŸ—‘ï¸ æ¸…é™¤æ—¥èªŒ</button>
  </div>
  
  <div class="debug-info">
    <h3>ğŸ”§ æ¸¬è©¦å·¥å…·</h3>
    <button onclick="addTestCard()">â• æ·»åŠ æ¸¬è©¦å¡ç‰‡</button>
    <button onclick="clearAllCards()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰å¡ç‰‡</button>
    <button onclick="backupData()">ğŸ’¾ å‚™ä»½è³‡æ–™</button>
    <button onclick="restoreData()">ğŸ“¥ æ¢å¾©è³‡æ–™</button>
  </div>

  <!-- è¼‰å…¥å¿…è¦çš„ JavaScript -->
  <script src="js/sound.js"></script>
  <script src="js/userData.js"></script>
  <script src="js/autoSaveSystem.js"></script>
  <script src="js/starRewardSystem.js"></script>
  <script src="js/cardUtils.js"></script>
  <script src="js/cardStorage.js"></script>
  <script src="js/cards.js"></script>
  <script src="js/achievementSystem.js"></script>
  <script src="js/contextMenuSystem.js"></script>
  <script src="js/enhancedSaveReminder.js"></script>

  <script>
    let logMessages = [];
    
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      const logEntry = `[${timestamp}] ${message}`;
      logMessages.push(logEntry);
      
      const logElement = document.getElementById('log');
      if (logElement) {
        logElement.textContent = logMessages.join('\n');
        logElement.scrollTop = logElement.scrollHeight;
      }
      
      console.log(logEntry);
    }
    
    function clearLog() {
      logMessages = [];
      document.getElementById('log').textContent = '';
    }
    
    function checkStatus() {
      const statusDiv = document.getElementById('status');
      let html = '';
      
      // æª¢æŸ¥ allCards
      if (window.allCards && window.allCards.length > 0) {
        html += '<div class="success">âœ… allCards å·²è¼‰å…¥: ' + window.allCards.length + ' å¼µå¡ç‰‡</div>';
        log('allCards å·²è¼‰å…¥: ' + window.allCards.length + ' å¼µå¡ç‰‡');
      } else {
        html += '<div class="error">âŒ allCards æœªè¼‰å…¥æˆ–ç‚ºç©º</div>';
        log('allCards æœªè¼‰å…¥æˆ–ç‚ºç©º', 'error');
      }
      
      // æª¢æŸ¥ LinkageSystem
      if (window.LinkageSystem) {
        html += '<div class="success">âœ… LinkageSystem å·²è¼‰å…¥</div>';
        log('LinkageSystem å·²è¼‰å…¥');
      } else {
        html += '<div class="error">âŒ LinkageSystem æœªè¼‰å…¥</div>';
        log('LinkageSystem æœªè¼‰å…¥', 'error');
      }
      
      statusDiv.innerHTML = html;
    }
    
    function checkStorage() {
      const storageDiv = document.getElementById('storage');
      let html = '';
      
      const keys = ['ownedCards', 'cardShards', 'totalStars'];
      
      keys.forEach(key => {
        try {
          const value = localStorage.getItem(key);
          if (value !== null) {
            const data = JSON.parse(value);
            if (typeof data === 'object') {
              const count = Object.keys(data).length;
              html += `<div class="success">âœ… ${key}: ${count} é …è³‡æ–™</div>`;
              log(`${key}: ${count} é …è³‡æ–™`);
            } else {
              html += `<div class="success">âœ… ${key}: ${data}</div>`;
              log(`${key}: ${data}`);
            }
          } else {
            html += `<div class="warning">âš ï¸ ${key}: ä¸å­˜åœ¨</div>`;
            log(`${key}: ä¸å­˜åœ¨`, 'warning');
          }
        } catch (error) {
          html += `<div class="error">âŒ ${key}: è§£æéŒ¯èª¤</div>`;
          log(`${key}: è§£æéŒ¯èª¤ - ${error.message}`, 'error');
        }
      });
      
      storageDiv.innerHTML = html;
    }
    
    function checkCards() {
      const cardsDiv = document.getElementById('cards');
      let html = '';
      
      if (!window.LinkageSystem) {
        html += '<div class="error">âŒ LinkageSystem æœªè¼‰å…¥</div>';
        cardsDiv.innerHTML = html;
        return;
      }
      
      try {
        const ownedCards = window.LinkageSystem.cards.getOwnedCards();
        const shards = window.LinkageSystem.cards.getShards();
        const totalStars = window.LinkageSystem.stars.get();
        
        const ownedCount = Object.keys(ownedCards).length;
        const shardCount = Object.keys(shards).length;
        const totalShards = Object.values(shards).reduce((sum, count) => sum + count, 0);
        
        html += `<div class="success">ğŸ“Š å·²æ“æœ‰å¡ç‰‡: ${ownedCount} å¼µ</div>`;
        html += `<div class="success">ğŸ’ ç¢ç‰‡ç¨®é¡: ${shardCount} ç¨®</div>`;
        html += `<div class="success">ğŸ’ ç¸½ç¢ç‰‡æ•¸: ${totalShards} å€‹</div>`;
        html += `<div class="success">â­ ç¸½æ˜Ÿæ˜Ÿæ•¸: ${totalStars} é¡†</div>`;
        
        log(`å¡ç‰‡çµ±è¨ˆ: å·²æ“æœ‰ ${ownedCount} å¼µï¼Œç¢ç‰‡ç¨®é¡ ${shardCount} ç¨®ï¼Œç¸½ç¢ç‰‡ ${totalShards} å€‹ï¼Œæ˜Ÿæ˜Ÿ ${totalStars} é¡†`);
        
      } catch (error) {
        html += `<div class="error">âŒ æª¢æŸ¥å¡ç‰‡è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}</div>`;
        log(`æª¢æŸ¥å¡ç‰‡è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
      }
      
      cardsDiv.innerHTML = html;
    }
    
    function addTestCard() {
      if (!window.allCards || window.allCards.length === 0) {
        log('ç„¡æ³•æ·»åŠ æ¸¬è©¦å¡ç‰‡ï¼šallCards æœªè¼‰å…¥', 'error');
        return;
      }
      
      if (!window.LinkageSystem) {
        log('ç„¡æ³•æ·»åŠ æ¸¬è©¦å¡ç‰‡ï¼šLinkageSystem æœªè¼‰å…¥', 'error');
        return;
      }
      
      try {
        const testCard = window.allCards[0];
        window.LinkageSystem.cards.addCard(testCard.word);
        window.LinkageSystem.cards.addShard(testCard.word, 3);
        
        log(`å·²æ·»åŠ æ¸¬è©¦å¡ç‰‡: ${testCard.word}`);
        checkCards();
        
      } catch (error) {
        log(`æ·»åŠ æ¸¬è©¦å¡ç‰‡å¤±æ•—: ${error.message}`, 'error');
      }
    }
    
    function clearAllCards() {
      if (!confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰å¡ç‰‡å—ï¼Ÿ')) {
        return;
      }
      
      if (!window.LinkageSystem) {
        log('ç„¡æ³•æ¸…é™¤å¡ç‰‡ï¼šLinkageSystem æœªè¼‰å…¥', 'error');
        return;
      }
      
      try {
        window.LinkageSystem.cards.setOwnedCards({});
        window.LinkageSystem.cards.setShards({});
        window.LinkageSystem.stars.set(0);
        
        log('å·²æ¸…é™¤æ‰€æœ‰å¡ç‰‡');
        checkCards();
        
      } catch (error) {
        log(`æ¸…é™¤å¡ç‰‡å¤±æ•—: ${error.message}`, 'error');
      }
    }
    
    function backupData() {
      if (!window.LinkageSystem) {
        log('ç„¡æ³•å‚™ä»½è³‡æ–™ï¼šLinkageSystem æœªè¼‰å…¥', 'error');
        return;
      }
      
      try {
        const backup = {
          ownedCards: window.LinkageSystem.cards.getOwnedCards(),
          shards: window.LinkageSystem.cards.getShards(),
          totalStars: window.LinkageSystem.stars.get(),
          timestamp: new Date().toISOString()
        };
        
        localStorage.setItem('cardBackup', JSON.stringify(backup));
        log('è³‡æ–™å‚™ä»½å®Œæˆ');
        
      } catch (error) {
        log(`å‚™ä»½å¤±æ•—: ${error.message}`, 'error');
      }
    }
    
    function restoreData() {
      try {
        const backupStr = localStorage.getItem('cardBackup');
        if (!backupStr) {
          log('æ²’æœ‰æ‰¾åˆ°å‚™ä»½è³‡æ–™', 'warning');
          return;
        }
        
        const backup = JSON.parse(backupStr);
        
        if (window.LinkageSystem) {
          window.LinkageSystem.cards.setOwnedCards(backup.ownedCards);
          window.LinkageSystem.cards.setShards(backup.shards);
          window.LinkageSystem.stars.set(backup.totalStars);
        }
        
        log('è³‡æ–™æ¢å¾©å®Œæˆ');
        checkCards();
        
      } catch (error) {
        log(`æ¢å¾©å¤±æ•—: ${error.message}`, 'error');
      }
    }
    
    // ç›£è½ localStorage è®ŠåŒ–
    window.addEventListener('storage', function(e) {
      log(`localStorage è®ŠåŒ–: ${e.key} = ${e.newValue}`);
    });
    
    // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
    window.addEventListener('load', function() {
      log('èª¿è©¦å·¥å…·å·²è¼‰å…¥');
      
      setTimeout(() => {
        checkStatus();
        checkStorage();
        checkCards();
      }, 2000);
    });
  </script>
</body>
</html> 