<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Â°´Á©∫ÊåëÊà∞ - Ëã±ÊâìÂ∞èËã±ÈõÑ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="responsive_enhanced.css">
  <style>
    body {
      margin:0; font-family:'Segoe UI',Arial,sans-serif,'Orbitron',sans-serif;
      background: linear-gradient(135deg, #232526 0%, #414345 100%);
      color:#fff; text-align:center; padding:20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    h1 {
      color:#ffd700; text-shadow:0 0 8px #ffd700;
      margin-bottom:20px; letter-spacing:2px;
      font-family:'Orbitron',Arial,sans-serif;
      font-size:2.2rem;
    }
    .top-btns {
      position:absolute; top:16px; left:16px; display:flex; gap:8px;
    }
    .top-btns button {
      padding:6px 12px; font-size:1rem;
      background:#ffd700; color:#000;
      border:none; border-radius:12px;
      cursor:pointer; box-shadow:0 0 6px rgba(255,215,0,0.2);
      font-family:'Orbitron',Arial,sans-serif;
      transition: background 0.2s;
    }
    .top-btns button:hover { background:#ffe54f; }
    #star-counter {
      display:flex; align-items:center; justify-content:center; gap:18px;
      background:rgba(30,30,40,0.92); border-radius:18px;
      box-shadow:0 4px 18px 0 rgba(31,38,135,0.18);
      padding:14px 32px; margin-bottom:18px;
      border:1.5px solid #ffd70044;
      font-size:1.18rem; color:#ffd700;
      min-width:260px;
      font-family:'Orbitron',Arial,sans-serif;
    }
    #timer { font-size:1.1rem; margin-bottom:16px; }
    #timer.hidden { display:none; }
    #question-container {
      background:rgba(30,30,40,0.97);
      border-radius:22px; box-shadow:0 8px 32px rgba(31,38,135,0.37);
      padding:38px 30px 30px;
      max-width:440px; width:100%; margin:auto;
      border:1.5px solid #ffd70044;
      display:flex; flex-direction:column; align-items:center;
      margin-bottom: 18px;
    }
    .question-title { font-size:1.1rem; margin-bottom:8px; letter-spacing:1px; }
    .question-sentence { font-size:1.7rem; font-weight:bold; margin:10px 0 20px 0; line-height:1.5; word-break:break-word; }
    .question-sentence .blank { color:#0ff; background:#fff2; border-radius:8px; padding:2px 16px; box-shadow:0 1px 4px #0ff2; }
    .question-zh { color:#ffd700; margin-bottom:16px; font-size:1.08rem; }
    input {
      width:92%; padding:15px; font-size:1.15rem;
      border:2px solid #ffd700; border-radius:14px;
      background:#222; color:#fff; margin-bottom:22px;
      box-shadow:0 2px 8px #0003;
      outline:none; transition:border 0.2s;
    }
    input:focus { border-color:#0ff; }
    .btn-row { display:flex; justify-content:center; gap:20px; margin-bottom:14px; width:100%; }
    button {
      font-size:1rem; padding:10px 26px;
      border:none; border-radius:12px;
      cursor:pointer; transition:background 0.2s;
      box-shadow:0 2px 8px #0002;
      font-family:'Orbitron',Arial,sans-serif;
    }
    #submit-btn { background:#ffd700; color:#111; }
    #submit-btn:disabled { background:#ccc; color:#888; cursor:not-allowed; }
    #skip-btn { background:#bbb; color:#222; }
    #skip-btn:hover { background:#ccc; }
    #speak-btn { background:#0ff; color:#111; margin-top:10px; }
    #speak-btn:disabled { background:#555; color:#888; }
    #speak-btn:hover { background:#7ff; }
    #next-btn { background:#4caf50; color:#fff; margin-top:10px; }
    #next-btn:hover { background:#6fdc7f; }
    #feedback { margin-top:12px; font-size:1.13rem; min-height:28px; }
    .complete-anim { animation:pop 0.7s cubic-bezier(.68,-0.55,.27,1.55) both; }
    @keyframes pop { 0% { transform:scale(0.7); opacity:0; } 60% { transform:scale(1.15); opacity:1; } 100% { transform:scale(1); } }
    @media (max-width:600px) { #question-container, #star-counter { max-width:98vw; padding:18px 4vw; } .question-sentence { font-size:1.15rem; } input { font-size:1rem; } button { font-size:0.98rem; padding:8px 12px; } }

    /* Áµ±‰∏ÄÊòüÊòüÈ°ØÁ§∫ÂçÄÂ°äÊ®£Âºè */
    #starsDisplay {
      position: fixed; top: 20px; left: 20px; background: rgba(10, 20, 40, 0.85);
      padding: 8px 14px; border-radius: 10px; color: #ffd700; font-weight: bold;
      box-shadow: 0 0 12px #ffd700, 0 0 32px #00ffff; border: 2px solid #00ffff;
      font-size: 1.2rem; z-index: 10;
    }
    .top-btns { position: fixed; top: 20px; right: 20px; left: auto; display: flex; gap: 8px; z-index: 11; }

    /* ÂèçÈ•ãÂãïÁï´Ê®£Âºè */
    .feedback-box { display:inline-block; padding:10px 22px; border-radius:16px; font-size:1.18rem; font-weight:bold; box-shadow:0 2px 16px #0004; margin-top:8px; transition: background 0.3s, color 0.3s, transform 0.2s; animation: popfade 0.7s cubic-bezier(.68,-0.55,.27,1.55);} 
    .feedback-correct { background: linear-gradient(90deg,#2ecc40,#bfff00); color:#222; }
    .feedback-wrong { background: linear-gradient(90deg,#ff4f4f,#ffbaba); color:#fff; }
    .feedback-bonus { color:#ffd700; animation: bonusflash 1s infinite alternate; font-size:1.25em; }
    @keyframes popfade { 0%{transform:scale(0.7);opacity:0;} 60%{transform:scale(1.15);opacity:1;} 100%{transform:scale(1);} }
    @keyframes bonusflash { 0%{text-shadow:0 0 8px #ffd700;} 100%{text-shadow:0 0 24px #fff700;} }

    /* ===== ÈÅäÊà≤ÁµêÊùüÁï´Èù¢Ê®£Âºè ===== */
    .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); display: flex; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(4px); }
    .modal-content { background: rgba(30, 30, 40, 0.95); border: 2px solid #ffd700; border-radius: 20px; padding: 40px; text-align: center; max-width: 500px; width: 90%; box-shadow: 0 0 32px #ffd70044, 0 0 80px #00ffff22 inset; animation: modalPop 0.5s cubic-bezier(.68, -0.55, .27, 1.55); }
    .end-icon { font-size: 4rem; margin-bottom: 20px; animation: tada 1.2s infinite; }
    .modal-content h2 { color: #ffd700; font-size: 2rem; margin-bottom: 25px; text-shadow: 0 0 12px #ffd700; font-family: 'Orbitron', Arial, sans-serif; }
    .end-stats { margin-bottom: 30px; }
    .end-stats p { font-size: 1.2rem; margin: 10px 0; color: #fff; }
    .end-stats span { color: #ffd700; font-weight: bold; }
    .end-buttons { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
    .end-buttons button { background: linear-gradient(90deg, #ffd700, #ffed4e); color: #000; border: none; border-radius: 12px; padding: 12px 24px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; font-family: 'Orbitron', Arial, sans-serif; }
    .end-buttons button:hover { transform: scale(1.05); box-shadow: 0 0 16px #ffd700; }
    @keyframes modalPop { 0% { transform: scale(0.7); opacity: 0; } 60% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); } }
    @keyframes tada { 0% { transform: scale(1); } 10%, 20% { transform: scale(0.9) rotate(-3deg); } 30%, 50%, 70%, 90% { transform: scale(1.1) rotate(3deg); } 40%, 60%, 80% { transform: scale(1.1) rotate(-3deg); } 100% { transform: scale(1) rotate(0); } }

    /* ===== ÈüøÊáâÂºèË®≠Ë®àÂÑ™Âåñ ===== */
    @media (max-width: 768px) {
      .top-btns { position: fixed; top: 10px; right: 10px; left: auto; display: flex; gap: 6px; z-index: 11; flex-wrap: wrap; justify-content: flex-end; }
      .top-btns button { padding: 4px 8px; font-size: 0.9rem; }
      #starsDisplay { top: 10px; left: 10px; padding: 6px 10px; font-size: 1rem; }
      h1 { font-size: 1.8rem; margin-top: 60px; }
      #question-container { max-width: 95vw; padding: 20px 15px; margin: 10px auto; }
      .question-sentence { font-size: 1.3rem; }
      .modal-content { padding: 20px; margin: 10px; max-width: 95vw; }
      .end-buttons { flex-direction: column; gap: 10px; }
      .end-buttons button { width: 100%; padding: 10px; }
    }

    @media (max-width: 480px) {
      body { padding: 10px; }
      .top-btns { position: relative; top: auto; right: auto; left: auto; justify-content: center; margin-bottom: 15px; }
      #starsDisplay { position: relative; top: auto; left: auto; display: inline-block; margin-bottom: 10px; }
      h1 { font-size: 1.5rem; margin-top: 10px; }
      #star-counter { font-size: 1rem; padding: 10px 20px; min-width: 200px; }
      .question-sentence { font-size: 1.1rem; }
      input { font-size: 1rem; padding: 12px; }
      .btn-row { flex-direction: column; gap: 10px; }
      .btn-row button { width: 100%; padding: 12px; }
    }

    /* ===== ËÉåÊôØÈü≥Ê®ÇÊéßÂà∂ÊåâÈàïÊ®£Âºè ===== */
    #bgMusicControl {
      position: fixed; bottom: 20px; right: 20px; background: rgba(255, 215, 0, 0.9);
      color: #000; border: none; border-radius: 50%; width: 50px; height: 50px; font-size: 1.5rem;
      cursor: pointer; z-index: 12; box-shadow: 0 0 12px rgba(255, 215, 0, 0.4);
      transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;
    }
    #bgMusicControl:hover { background: rgba(255, 215, 0, 1); transform: scale(1.1); box-shadow: 0 0 20px rgba(255, 215, 0, 0.6); }
    #bgMusicControl.paused { background: rgba(255, 255, 255, 0.3); color: #fff; }
    #bgMusicControl.paused:hover { background: rgba(255, 255, 255, 0.5); }
  </style>
</head>
<body>
  <!-- ËÉåÊôØÈü≥Ê®ÇÊéßÂà∂ÊåâÈàï -->
  <button id="bgMusicControl" onclick="toggleBackgroundMusic()" title="ËÉåÊôØÈü≥Ê®ÇÊéßÂà∂">üéµ</button>

  <!-- Â∑¶‰∏äËßíÊòüÊòüÊï∏È°ØÁ§∫ÂçÄÂ°ä -->
  <div id="starsDisplay">
    ‚≠ê<span id="totalStarsCount">0</span>
  </div>
  <!-- Êú¨Ê¨°ÊòüÊòüÈ°ØÁ§∫ÔºàË£úÈΩäÔºåÈÅøÂÖç nullÔºâ -->
  <div id="sessionStarsDisplay" style="margin:10px 0;color:#ffd700;font-weight:bold;">Êú¨Ê¨°Â∑≤Áç≤Âæó 0 È°ÜÊòüÊòü</div>

  <div class="top-btns">
    <button onclick="location.href='atlas.html?tab=greek'" aria-label="ÂõûÈ¶ñÈ†Å">üè† ÂõûÈ¶ñÈ†Å</button>
    <button onclick="resetProgress()" aria-label="ÈáçÊñ∞ÈñãÂßã">üîÑ ÈáçÊñ∞ÈñãÂßã</button>
    <button onclick="showReviewModal()" aria-label="Ë§áÁøíÂñÆÂ≠ó">üìö Ë§áÁøíÂñÆÂ≠ó</button>
  </div>
  <h1>Ëµ´Êãâ Hera - Â°´Á©∫ÊåëÊà∞</h1>
  <div id="star-counter">Á¨¨ <span id="current-index">0</span> / <span id="total-questions">0</span> È°å</div>
  <div id="timer" class="hidden">‚è≥ ÂÄíÊï∏Ôºö<span id="time-left">0</span> Áßí</div>
  <div id="question-container"></div>

  <!-- ÈÅäÊà≤ÁµêÊùüÁï´Èù¢ -->
  <div id="gameEndModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="end-icon">üéâ</div>
      <h2>ÈÅäÊà≤ÂÆåÊàêÔºÅ</h2>
      <div class="end-stats">
        <p>‚≠ê Êú¨Ê¨°Áç≤ÂæóÊòüÊòüÔºö<span id="endSessionStars">0</span></p>
        <p>‚úÖ Á≠îÂ∞çÈ°åÊï∏Ôºö<span id="endCorrectCount">0</span></p>
        <p>‚ùå Á≠îÈåØÈ°åÊï∏Ôºö<span id="endWrongCount">0</span></p>
        <p>‚≠ê Á¥ØÁ©çÁ∏ΩÊòüÊòüÔºö<span id="endTotalStars">0</span></p>
      </div>
      <div class="end-buttons">
        <button onclick="restartGame()">üîÑ ÈáçÊñ∞ÈñãÂßã</button>
        <button onclick="location.href='atlas.html?tab=greek'">üè† ËøîÂõûÈ¶ñÈ†Å</button>
      </div>
    </div>
  </div>

  <!-- Ë§áÁøíÂñÆÂ≠óÂΩàÁ™ó -->
  <div id="reviewModal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="end-icon">üìö</div>
      <h2>ÂñÆÂ≠óË§áÁøí</h2>
      <div style="margin-bottom: 20px;">
        <label for="categoryFilter" style="color: #ffd700; font-weight: bold; margin-right: 10px;">ÈÅ∏ÊìáÂàÜÈ°ûÔºö</label>
        <select id="categoryFilter" style="background:#222;color:#fff;border:2px solid #ffd700;border-radius:8px;padding:8px 12px;font-size:1rem;cursor:pointer;">
          <option value="all">ÂÖ®ÈÉ®ÂñÆÂ≠ó</option>
          <option value="ÈÄ£Êé•Ë©û‰ªãÁ≥ªË©û">ÈÄ£Êé•Ë©û‰ªãÁ≥ªË©û</option>
          <option value="È£üÁâ©È£≤Êñô">È£üÁâ©È£≤Êñô</option>
          <option value="Âãï‰ΩúÂãïË©û">Âãï‰ΩúÂãïË©û</option>
          <option value="Â∫èÊï∏Ë©û">Â∫èÊï∏Ë©û</option>
          <option value="ÈáëÈå¢Áõ∏Èóú">ÈáëÈå¢Áõ∏Èóú</option>
          <option value="ÁØÄÊó•ÊÖ∂Á•ù">ÁØÄÊó•ÊÖ∂Á•ù</option>
          <option value="ÊäΩË±°Ê¶ÇÂøµ">ÊäΩË±°Ê¶ÇÂøµ</option>
          <option value="ÈÇèËºØÈóú‰øÇ">ÈÇèËºØÈóú‰øÇ</option>
          <option value="Êó•Â∏∏ÁîüÊ¥ªÁî®ÂìÅ">Êó•Â∏∏ÁîüÊ¥ªÁî®ÂìÅ</option>
          <option value="ÂÄã‰∫∫Ë°õÁîü">ÂÄã‰∫∫Ë°õÁîü</option>
          <option value="ÂãïÁâ©">ÂãïÁâ©</option>
          <option value="ÂïÜÊ•≠Â†¥ÊâÄ">ÂïÜÊ•≠Â†¥ÊâÄ</option>
          <option value="ÂΩ¢ÂÆπË©û">ÂΩ¢ÂÆπË©û</option>
          <option value="ÊôÇÈñìÈ†ªÁéá">ÊôÇÈñìÈ†ªÁéá</option>
          <option value="ÈúÄÊ±ÇË°®ÈÅî">ÈúÄÊ±ÇË°®ÈÅî</option>
          <option value="ÁµêÊùüÂÆåÊàê">ÁµêÊùüÂÆåÊàê</option>
          <option value="ÈáëÈå¢‰∫§Êòì">ÈáëÈå¢‰∫§Êòì</option>
          <option value="Âãï‰ΩúÊìç‰Ωú">Âãï‰ΩúÊìç‰Ωú</option>
          <option value="ÊÉÖÊÑüË°®ÈÅî">ÊÉÖÊÑüË°®ÈÅî</option>
          <option value="ÂïÜÊ•≠Ê¥ªÂãï">ÂïÜÊ•≠Ê¥ªÂãï</option>
          <option value="ÈôÑÂä†Ë°®ÈÅî">ÈôÑÂä†Ë°®ÈÅî</option>
          <option value="È†ªÁéáË°®ÈÅî">È†ªÁéáË°®ÈÅî</option>
          <!-- Ë£ú‰∏äÊú¨Ë≥áÊñôÈõÜ‰∏≠ÂØ¶Èöõ‰ΩøÁî®ÁöÑÂàÜÈ°û -->
          <option value="Á®±Ë¨Ç‰∫∫Èöõ">Á®±Ë¨Ç‰∫∫Èöõ</option>
          <option value="ËÅ≤Èü≥Ë°®Êºî">ËÅ≤Èü≥Ë°®Êºî</option>
          <option value="Â†¥ÊâÄ‰ΩçÁΩÆ">Â†¥ÊâÄ‰ΩçÁΩÆ</option>
          <option value="Êï∏ÈáèÂàÜÊï∏">Êï∏ÈáèÂàÜÊï∏</option>
        </select>
      </div>
      <div id="vocabStats" style="background:rgba(255,215,0,0.1);border:1px solid #ffd700;border-radius:8px;padding:10px;margin-bottom:15px;color:#ffd700;font-size:0.9rem;">
        Á∏ΩÂÖ± <span id="totalVocabCount">0</span> ÂÄãÂñÆÂ≠ó
        <button onclick="showVocabStats()" style="background:#0ff;color:#000;border:none;border-radius:6px;padding:4px 8px;font-size:0.8rem;margin-left:10px;cursor:pointer;">üìä Ë©≥Á¥∞Áµ±Ë®à</button>
        <button onclick="exportVocabData()" style="background:#4caf50;color:#fff;border:none;border-radius:6px;padding:4px 8px;font-size:0.8rem;margin-left:5px;cursor:pointer;">üì• ÂåØÂá∫Â≠óÂ∫´</button>
      </div>
      <div id="reviewWordsContainer" style="max-height: 400px; overflow-y: auto; margin: 20px 0;"></div>
      <div class="end-buttons">
        <button onclick="closeReviewModal()">ÈóúÈñâ</button>
      </div>
    </div>
  </div>

  <script src="js/gameDialogue.js"></script>
  <script>
   const VOCAB_DATA = [
  { "word": "balcony", "zh": "ÈôΩÂè∞", "en_sentence": "We drink tea on the balcony in the evening.", "zh_sentence": "ÊàëÂÄëÊôö‰∏äÂú®ÈôΩÂè∞ÂñùËå∂„ÄÇ", "category": "Â†¥ÊâÄ‰ΩçÁΩÆ" },
  { "word": "koala", "zh": "ÁÑ°Â∞æÁÜä", "en_sentence": "A koala sleeps in the eucalyptus tree.", "zh_sentence": "ÁÑ°Â∞æÁÜäÁù°Âú®Â∞§Âä†Âà©Ê®π‰∏ä„ÄÇ", "category": "ÂãïÁâ©" },
  { "word": "hippo", "zh": "Ê≤≥È¶¨", "en_sentence": "The hippo swims across the river.", "zh_sentence": "Ê≤≥È¶¨Ê∏∏ÈÅéÊ≤≥Èù¢„ÄÇ", "category": "ÂãïÁâ©" },
  { "word": "zebra", "zh": "ÊñëÈ¶¨", "en_sentence": "The zebra has black and white stripes.", "zh_sentence": "ÊñëÈ¶¨ÊúâÈªëÁôΩÁõ∏ÈñìÁöÑÊ¢ùÁ¥ã„ÄÇ", "category": "ÂãïÁâ©" },
  { "word": "kangaroo", "zh": "Ë¢ãÈº†", "en_sentence": "A kangaroo can jump very far.", "zh_sentence": "Ë¢ãÈº†ÂèØ‰ª•Ë∑≥ÂæóÂæàÈÅ†„ÄÇ", "category": "ÂãïÁâ©" },
  { "word": "person", "zh": "‰∫∫(ÂñÆÊï∏)", "en_sentence": "One person is waiting at the door.", "zh_sentence": "‰∏ÄÂÄã‰∫∫Âú®ÈñÄÂè£Á≠âÂÄô„ÄÇ", "category": "Á®±Ë¨Ç‰∫∫Èöõ" },
  { "word": "people", "zh": "‰∫∫ÂÄë(Ë§áÊï∏)", "en_sentence": "Many people visit the museum on weekends.", "zh_sentence": "ÂæàÂ§ö‰∫∫ÈÄ±Êú´ÂèÉËßÄÂçöÁâ©È§®„ÄÇ", "category": "Á®±Ë¨Ç‰∫∫Èöõ" },
  { "word": "man", "zh": "Áî∑‰∫∫", "en_sentence": "The man reads a newspaper.", "zh_sentence": "ÈÇ£‰ΩçÁî∑‰∫∫Âú®ÁúãÂ†±Á¥ô„ÄÇ", "category": "Á®±Ë¨Ç‰∫∫Èöõ" },
  { "word": "woman", "zh": "Â•≥‰∫∫", "en_sentence": "The woman works at a bank.", "zh_sentence": "ÈÇ£‰ΩçÂ•≥‰∫∫Âú®ÈäÄË°åÂ∑•‰Ωú„ÄÇ", "category": "Á®±Ë¨Ç‰∫∫Èöõ" },
  { "word": "center", "zh": "‰∏≠ÂøÉÔºõ‰∏≠Â§Æ", "en_sentence": "Please stand in the center of the circle.", "zh_sentence": "Ë´ãÁ´ôÂú®ÂúìÁöÑ‰∏≠Â§Æ„ÄÇ", "category": "Â†¥ÊâÄ‰ΩçÁΩÆ" },
  { "word": "future", "zh": "Êú™‰æÜ", "en_sentence": "We should plan for the future.", "zh_sentence": "ÊàëÂÄëÊáâË©≤ÁÇ∫Êú™‰æÜÂÅöÊâìÁÆó„ÄÇ", "category": "ÊäΩË±°Ê¶ÇÂøµ" },
  { "word": "age", "zh": "Âπ¥ÈΩ°", "en_sentence": "What is your age?", "zh_sentence": "‰Ω†ÁöÑÂπ¥ÈΩ°ÊòØÂ§öÂ∞ëÔºü", "category": "ÊäΩË±°Ê¶ÇÂøµ" },
  { "word": "minute", "zh": "ÂàÜÈêò", "en_sentence": "Please wait one minute.", "zh_sentence": "Ë´ãÁ≠â‰∏ÄÂàÜÈêò„ÄÇ", "category": "ÊôÇÈñìÊó•Êúü" },
  { "word": "Christmas", "zh": "ËÅñË™ïÁØÄ", "en_sentence": "We open gifts on Christmas morning.", "zh_sentence": "ÊàëÂÄëÂú®ËÅñË™ïÁØÄÊó©‰∏äÊâìÈñãÁ¶ÆÁâ©„ÄÇ", "category": "ÁØÄÊó•ÊÖ∂Á•ù" },
  { "word": "bell", "zh": "Èà¥ÔºõÈêò", "en_sentence": "The school bell rings at eight.", "zh_sentence": "Â≠∏Ê†°ÁöÑÈêòÂú®ÂÖ´ÈªûÈüøËµ∑„ÄÇ", "category": "ËÅ≤Èü≥Ë°®Êºî" },
  { "word": "turkey", "zh": "ÁÅ´Èõû", "en_sentence": "We eat turkey for dinner.", "zh_sentence": "ÊàëÂÄëÊôöÈ§êÂêÉÁÅ´Èõû„ÄÇ", "category": "ÂãïÁâ©" },
  { "word": "thing", "zh": "‰∫ãÁâ©ÔºõÊù±Ë•ø", "en_sentence": "This thing is very useful.", "zh_sentence": "ÈÄôÂÄãÊù±Ë•øÂæàÊúâÁî®„ÄÇ", "category": "ÊäΩË±°Ê¶ÇÂøµ" },
  { "word": "glasses", "zh": "ÁúºÈè°", "en_sentence": "She wears glasses to read.", "zh_sentence": "Â•πÊà¥ÁúºÈè°Èñ±ËÆÄ„ÄÇ", "category": "Êó•Â∏∏ÁîüÊ¥ªÁî®ÂìÅ" },
  { "word": "belt", "zh": "ÁöÆÂ∏∂", "en_sentence": "He wears a belt with his jeans.", "zh_sentence": "‰ªñÁâõ‰ªîË§≤ÈÖç‰∫Ü‰∏ÄÊ¢ùÁöÆÂ∏∂„ÄÇ", "category": "Êó•Â∏∏ÁîüÊ¥ªÁî®ÂìÅ" },
  { "word": "think", "zh": "ÊÄùËÄÉÔºõË™çÁÇ∫", "en_sentence": "I think this answer is correct.", "zh_sentence": "ÊàëË™çÁÇ∫ÈÄôÂÄãÁ≠îÊ°àÊòØÊ≠£Á¢∫ÁöÑ„ÄÇ", "category": "Âãï‰ΩúÂãïË©û" },
  { "word": "quiet", "zh": "ÂÆâÈùúÁöÑ", "en_sentence": "Please be quiet in the library.", "zh_sentence": "Ë´ãÂú®ÂúñÊõ∏È§®‰øùÊåÅÂÆâÈùú„ÄÇ", "category": "ÂΩ¢ÂÆπË©û" },
  { "word": "interesting", "zh": "ÊúâË∂£ÁöÑ", "en_sentence": "This book is very interesting.", "zh_sentence": "ÈÄôÊú¨Êõ∏ÈùûÂ∏∏ÊúâË∂£„ÄÇ", "category": "ÂΩ¢ÂÆπË©û" },
  { "word": "favorite", "zh": "ÊúÄÂñúÊÑõÁöÑ", "en_sentence": "Ice cream is my favorite dessert.", "zh_sentence": "ÂÜ∞Ê∑áÊ∑ãÊòØÊàëÊúÄÂñúÊÑõÁöÑÁîúÈªû„ÄÇ", "category": "ÂΩ¢ÂÆπË©û" },
  { "word": "any", "zh": "‰ªª‰ΩïÁöÑ", "en_sentence": "Do you have any questions?", "zh_sentence": "‰Ω†Êúâ‰ªª‰ΩïÂïèÈ°åÂóéÔºü", "category": "ÂΩ¢ÂÆπË©û" },
  { "word": "wait", "zh": "Á≠âÂæÖ", "en_sentence": "Please wait for your turn.", "zh_sentence": "Ë´ãÁ≠âÂæÖËº™Âà∞‰Ω†„ÄÇ", "category": "Âãï‰ΩúÂãïË©û" },
  { "word": "worry", "zh": "ÊìîÂøÉ", "en_sentence": "Don't worry about the test.", "zh_sentence": "Âà•ÊìîÂøÉËÄÉË©¶„ÄÇ", "category": "ÊÉÖÊÑüË°®ÈÅî" },
  { "word": "get", "zh": "ÂæóÂà∞ÔºõÂèñÂæó", "en_sentence": "I will get a new bike.", "zh_sentence": "ÊàëË¶ÅÂæóÂà∞‰∏ÄÂè∞Êñ∞ËÖ≥Ë∏èËªä„ÄÇ", "category": "Âãï‰ΩúÂãïË©û" },
  { "word": "share", "zh": "ÂàÜ‰∫´", "en_sentence": "We share our snacks with friends.", "zh_sentence": "ÊàëÂÄëÂíåÊúãÂèãÂàÜ‰∫´Èõ∂È£ü„ÄÇ", "category": "Âãï‰ΩúÂãïË©û" },
  { "word": "kick", "zh": "Ë∏¢", "en_sentence": "He can kick the ball very hard.", "zh_sentence": "‰ªñËÉΩÂæàÁî®ÂäõÂú∞Ë∏¢ÁêÉ„ÄÇ", "category": "Âãï‰ΩúÂãïË©û" },
  { "word": "remember", "zh": "Ë®òÂæó", "en_sentence": "Please remember to lock the door.", "zh_sentence": "Ë´ãË®òÂæóÊääÈñÄÈéñ‰∏ä„ÄÇ", "category": "Âãï‰ΩúÂãïË©û" },
  { "word": "fight", "zh": "ÊâìÊû∂ÔºõÂ∞çÊäó", "en_sentence": "They fight over the toy.", "zh_sentence": "‰ªñÂÄëÁÇ∫‰∫ÜÁé©ÂÖ∑ÊâìÊû∂„ÄÇ", "category": "Âãï‰ΩúÂãïË©û" },
  { "word": "shout", "zh": "Â§ßÂñä", "en_sentence": "Don't shout in the classroom.", "zh_sentence": "‰∏çË¶ÅÂú®ÊïôÂÆ§Ë£°Â§ßÂñä„ÄÇ", "category": "Âãï‰ΩúÂãïË©û" },
  { "word": "behind", "zh": "Âú®‚Ä¶ÂæåÈù¢", "en_sentence": "The cat is behind the chair.", "zh_sentence": "Ë≤ìÂú®Ê§ÖÂ≠êÂæåÈù¢„ÄÇ", "category": "Â†¥ÊâÄ‰ΩçÁΩÆ" },
  { "word": "front", "zh": "Âú®‚Ä¶ÂâçÈù¢ÔºõÂâçÈù¢", "en_sentence": "Stand in front of the line.", "zh_sentence": "Ë´ãÁ´ôÂú®Èöä‰ºçÂâçÈù¢„ÄÇ", "category": "Â†¥ÊâÄ‰ΩçÁΩÆ" },
  { "word": "between", "zh": "Âú®‚Ä¶‰πãÈñì", "en_sentence": "The ball is between the boxes.", "zh_sentence": "ÁêÉÂú®ÂÖ©ÂÄãÁÆ±Â≠ê‰πãÈñì„ÄÇ", "category": "Â†¥ÊâÄ‰ΩçÁΩÆ" },
  { "word": "down", "zh": "Âêë‰∏ãÔºõÂú®‰∏ãÊñπ", "en_sentence": "The bird flies down to the tree.", "zh_sentence": "ÈÇ£ÈöªÈ≥•Âêë‰∏ãÈ£õÂà∞Ê®π‰∏ä„ÄÇ", "category": "Â†¥ÊâÄ‰ΩçÁΩÆ" },
  { "word": "then", "zh": "ÁÑ∂ÂæåÔºõÊé•Ëëó", "en_sentence": "Finish your homework, then play.", "zh_sentence": "ÂÖàÂÆåÊàê‰ΩúÊ•≠ÔºåÁÑ∂ÂæåÂÜçÁé©„ÄÇ", "category": "ÈÇèËºØÈóú‰øÇ" },
  { "word": "even", "zh": "ÁîöËá≥", "en_sentence": "He can swim even in cold water.", "zh_sentence": "‰ªñÁîöËá≥ÂèØ‰ª•Âú®ÂÜ∑Ê∞¥‰∏≠Ê∏∏Ê≥≥„ÄÇ", "category": "ÈôÑÂä†Ë°®ÈÅî" },
  { "word": "wrong", "zh": "ÈåØË™§ÁöÑ", "en_sentence": "Your answer is wrong.", "zh_sentence": "‰Ω†ÁöÑÁ≠îÊ°àÊòØÈåØÁöÑ„ÄÇ", "category": "ÂΩ¢ÂÆπË©û" },
  { "word": "many", "zh": "Ë®±Â§ö", "en_sentence": "There are many books on the shelf.", "zh_sentence": "Êõ∏Êû∂‰∏äÊúâË®±Â§öÊõ∏„ÄÇ", "category": "Êï∏ÈáèÂàÜÊï∏" }
];

    const QUESTIONS_COUNT = 20;
    const TIME_LIMIT = 30;
    let data, currentIndex, attemptCount, answered;
    let timerInterval;
    let preferredVoice = null;
    let answerLog = [];
    let sessionStars = 0;

    // Èü≥ÊïàË≥áÊ∫ê
    const correctSound = new Audio('sound/correct.mp3');
    const wrongSound = new Audio('sound/wrong.mp3');
    const typeSound = new Audio('sound/type.mp3');

    // ===== ËÉåÊôØÈü≥Ê®ÇÊéßÂà∂ =====
    let bgMusic = null;
    let isMusicPlaying = false;

    function initBackgroundMusic() {
      bgMusic = new Audio('sound/ÂçàÂæåÊîæÈ¨ÜÊôÇÂÖâÔºàÁ¥îÈü≥Ê®ÇÔºâ.mp3');
      bgMusic.loop = true;
      bgMusic.volume = 0.3;
      const musicState = localStorage.getItem('bgMusicState');
      if (musicState === 'playing') { playBackgroundMusic(); }
    }
    function toggleBackgroundMusic() { if (isMusicPlaying) { pauseBackgroundMusic(); } else { playBackgroundMusic(); } }
    function playBackgroundMusic() {
      if (bgMusic) {
        bgMusic.play().then(() => {
          isMusicPlaying = true;
          document.getElementById('bgMusicControl').textContent = 'üîä';
          document.getElementById('bgMusicControl').classList.remove('paused');
          localStorage.setItem('bgMusicState', 'playing');
        }).catch(err => { console.log('ËÉåÊôØÈü≥Ê®ÇÊí≠ÊîæÂ§±Êïó:', err); });
      }
    }
    function pauseBackgroundMusic() {
      if (bgMusic) {
        bgMusic.pause();
        isMusicPlaying = false;
        document.getElementById('bgMusicControl').textContent = 'üîá';
        document.getElementById('bgMusicControl').classList.add('paused');
        localStorage.setItem('bgMusicState', 'paused');
      }
    }

    function escapeRegExp(s){return s.replace(/[.*+?^${}()|[\\]\\]/g,'\\$&');}
    function getRandomQuestions(arr,n){const c=Math.min(n,arr.length);return arr.slice().sort(()=>Math.random()-0.5).slice(0,c);}    
    function initData(){
      const selected = getRandomQuestions(VOCAB_DATA, QUESTIONS_COUNT);
      data = selected.map(item=>({
        answer:item.word, zh:item.zh,
        sentence:item.en_sentence.replace(new RegExp(escapeRegExp(item.word),'i'),'___'),
        original:item.en_sentence,
        category: item.category
      }));
      document.getElementById('total-questions').textContent = data.length;
    }

    function saveProgress(){ localStorage.setItem('fillIndex', currentIndex); }
    function loadProgress(){
      currentIndex = parseInt(localStorage.getItem('fillIndex')) || 0;
      if (typeof data !== 'undefined' && Array.isArray(data) && currentIndex >= data.length) {
        currentIndex = 0; localStorage.removeItem('fillIndex');
      }
    }
    function resetProgress(){ localStorage.removeItem('fillIndex'); location.reload(); }
    function updateCounter(){ document.getElementById('current-index').textContent = currentIndex+1; }

    function startTimer(){
      clearInterval(timerInterval);
      let t=TIME_LIMIT;
      document.getElementById('time-left').textContent = t;
      document.getElementById('timer').classList.remove('hidden');
      timerInterval = setInterval(()=>{
        t--; document.getElementById('time-left').textContent = t;
        if(t<=0){ clearInterval(timerInterval); revealAnswer(true); }
      },1000);
    }
    function stopTimer(){ clearInterval(timerInterval); }

    function pickVoice() {
      const voices = window.speechSynthesis.getVoices();
      const prefer = ['Google US English','Microsoft Aria Online','Microsoft Jenny Online','Samantha','Jenny','Aria','en-US'];
      preferredVoice = voices.find(v => prefer.some(p => v.name.includes(p))) || voices.find(v => v.lang === 'en-US') || voices[0];
    }
    if (typeof speechSynthesis !== 'undefined') { speechSynthesis.onvoiceschanged = pickVoice; pickVoice(); }

    function speak(text, rate = 1.0, callback) {
      if (!window.speechSynthesis) return;
      const utter = new window.SpeechSynthesisUtterance(text);
      utter.lang = 'en-US'; utter.rate = rate; utter.pitch = 1.12;
      if (preferredVoice) utter.voice = preferredVoice;
      if (callback) utter.onend = callback;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    }

    function speakQuestionAndWord(q) {
      window.speechSynthesis.cancel();
      speak(q.original, 0.97, function() {
        setTimeout(() => speak(q.original.replace(new RegExp(escapeRegExp(q.answer), 'i'), '...'), 1.02, function() {
          setTimeout(() => speak(q.answer, 1.08), 350);
        }), 350);
      });
    }

    function revealAnswer(autoNext=false){
      attemptCount = Infinity;
      document.getElementById('feedback').innerHTML = `<span style='color:#f66;'>‚è∞ ÊôÇÈñìÂà∞ÔºÅÊ≠£Á¢∫Á≠îÊ°àÔºö<b>${data[currentIndex].answer}</b></span>`;
      document.getElementById('submit-btn').disabled=true;
      document.getElementById('user-input').disabled=true;
      answerLog[currentIndex] = {
        word: data[currentIndex].answer,
        zh: data[currentIndex].zh_sentence ? data[currentIndex].zh_sentence : data[currentIndex].zh,
        en: data[currentIndex].original,
        user: document.getElementById('user-input')?.value || '',
        correct: false,
        stars: 0
      };
      if(autoNext) setTimeout(()=>{ currentIndex++; showQuestion(); }, 500);
    }

    function checkAnswer(){
      if(answered) return;
      attemptCount++;
      const ui = document.getElementById('user-input');
      const feedback = document.getElementById('feedback');
      const ans=data[currentIndex].answer.toLowerCase();
      if(ui.value.trim().toLowerCase()===ans){
        answered=true; stopTimer();
        const usedSeconds = (Date.now() - (window.answerStartTime || Date.now())) / 1000;
        let bonus = 0;
        let feedbackMsg = `<div class='feedback-box feedback-correct'>‚úÖ Á≠îÂ∞ç‰∫ÜÔºÅÂ§™Ê£í‰∫ÜÔºÅ`;
        if (usedSeconds < 10) { bonus = 2; feedbackMsg += ` <span class='feedback-bonus'>BONUS! ‚è±Ô∏è +2</span>`; }
        feedbackMsg += `</div>`;
        feedback.innerHTML = feedbackMsg;
        ui.disabled = true; document.getElementById('submit-btn').disabled = true;
        speak(ans,1.1); saveProgress(); updateCounter();
        answerLog[currentIndex] = {
          word: data[currentIndex].answer,
          zh: data[currentIndex].zh_sentence ? data[currentIndex].zh_sentence : data[currentIndex].zh,
          en: data[currentIndex].original,
          user: ui.value.trim(),
          correct: true,
          stars: 0
        };
        let stars = loadTotalStars();
        let addStars = 1 + bonus; stars += addStars;
        localStorage.setItem('totalStars', stars);
        updateStarsDisplay();
        sessionStars += addStars;
        document.getElementById('totalStarsCount').textContent = stars;
        try { correctSound.currentTime = 0; correctSound.play(); } catch(e){}
        setTimeout(()=>{ currentIndex++; showQuestion(); }, 1300);
        showCorrectAnswerDialogue();
      } else {
        if(attemptCount < 3) {
          feedback.innerHTML = `<div class='feedback-box feedback-wrong'>‚ùå ÂÜçË©¶‰∏ÄÊ¨°ÔºÅ‰Ω†ÂèØ‰ª•ÁöÑÔºÅ</div>`;
          try { wrongSound.currentTime = 0; wrongSound.play(); } catch(e){}
        } else {
          feedback.innerHTML = `<div class='feedback-box feedback-wrong'>‚ùå Ê≠£Á¢∫Á≠îÊ°àÔºö<b>${data[currentIndex].answer}</b><br>Âà•Ê∞£È§íÔºåÂÜçÊé•ÂÜçÂé≤ÔºÅ</div>`;
          ui.disabled = true; document.getElementById('submit-btn').disabled = true;
          answerLog[currentIndex] = {
            word: data[currentIndex].answer,
            zh: data[currentIndex].zh_sentence ? data[currentIndex].zh_sentence : data[currentIndex].zh,
            en: data[currentIndex].original,
            user: ui.value.trim(),
            correct: false,
            stars: 0
          };
          try { wrongSound.currentTime = 0; wrongSound.play(); } catch(e){}
          setTimeout(()=>{ currentIndex++; showQuestion(); }, 1300);
          showWrongAnswerDialogue();
        }
      }
    }

    function showQuestion(){
      if(!data || !Array.isArray(data) || data.length === 0) {
        document.getElementById('question-container').innerHTML = '<div style="color:#f66;font-size:1.2rem;">‚ö†Ô∏è È°åÂ∫´Ê≤íÊúâÈ°åÁõÆÔºåË´ãÊ™¢Êü•Ë≥áÊñôÔºÅ</div>';
        return;
      }
      if(currentIndex < 0 || currentIndex >= data.length) { showGameEndScreen(); return; }
      answered=false; attemptCount=0;
      const q=data[currentIndex];
      document.getElementById('question-container').innerHTML = `
        <div class="question-title">Ëã±ÊñáÂè•Â≠êÔºö</div>
        <div class="question-sentence">${q.sentence.replace('___','<span class=\'blank\'>___</span>')}</div>
        <div class="question-zh">‰∏≠ÊñáÊèêÁ§∫Ôºö${q.zh_sentence ? q.zh_sentence : q.zh}</div>
        <input id="user-input" placeholder="Ëº∏ÂÖ•Á≠îÊ°à‚Ä¶" autocomplete="off" />
        <div class="btn-row">
          <button id="submit-btn" onclick="checkAnswer()">ÈÄÅÂá∫</button>
          <button id="skip-btn" onclick="skipQuestion()">Ë∑≥ÈÅé</button>
          <button id="next-btn" onclick="nextQuestion()">‰∏ã‰∏ÄÈ°å</button>
        </div>
        <div id="feedback"></div>
        <button id="speak-btn" onclick="speakQuestionAndWord(q)">üîä ÊúóËÆÄ</button>
      `;
      const inputEl = document.getElementById('user-input');
      inputEl.focus();
      inputEl.onkeydown = function(e) {
        if (e.key === 'Enter') checkAnswer();
        else if (e.key.length === 1) { try { typeSound.currentTime = 0; typeSound.play(); } catch(e){} }
      };
      updateCounter(); startTimer();
      setTimeout(() => { speak(q.original, 0.97); }, 400);
      document.getElementById('speak-btn').onclick = () => speakQuestionAndWord(q);
      window.answerStartTime = Date.now();
      lockReviewButton();
    }

    function skipQuestion(){ stopTimer();
      answerLog[currentIndex] = { word: data[currentIndex].answer, zh: data[currentIndex].zh_sentence ? data[currentIndex].zh_sentence : data[currentIndex].zh, en: data[currentIndex].original, user: '', correct: null, stars: 0 };
      const feedback = document.getElementById('feedback');
      if (feedback) feedback.innerHTML = `<span style='color:#bbb;'>Â∑≤Ë∑≥ÈÅéÊú¨È°å</span>`;
      setTimeout(()=>{ currentIndex++; showQuestion(); }, 400);
    }

    function nextQuestion(){ stopTimer();
      if(!answerLog[currentIndex]){
        answerLog[currentIndex] = { word: data[currentIndex].answer, zh: data[currentIndex].zh_sentence ? data[currentIndex].zh_sentence : data[currentIndex].zh, en: data[currentIndex].original, user: document.getElementById('user-input')?.value || '', correct: false, stars: 0 };
        const feedback = document.getElementById('feedback');
        if (feedback) feedback.innerHTML = `<span style='color:#bbb;'>Êú™‰ΩúÁ≠î</span>`;
      }
      setTimeout(()=>{ currentIndex++; showQuestion(); }, 400);
    }

    // ===== ÈÅäÊà≤ÁµêÊùüÁï´Èù¢ =====
    function showGameEndScreen() {
      const correctCount = answerLog.filter(log => log && log.correct === true).length;
      const wrongCount = answerLog.filter(log => log && log.correct === false).length;
      const totalStars = loadTotalStars();
      document.getElementById('endSessionStars').textContent = sessionStars;
      document.getElementById('endCorrectCount').textContent = correctCount;
      document.getElementById('endWrongCount').textContent = wrongCount;
      document.getElementById('endTotalStars').textContent = totalStars;
      document.getElementById('gameEndModal').style.display = 'flex';
      stopTimer(); unlockReviewButton();
      try { correctSound.currentTime = 0; correctSound.play(); } catch (e) {}
      showGameVictoryDialogue();
    }

    function restartGame() {
      document.getElementById('gameEndModal').style.display = 'none';
      currentIndex = 0; sessionStars = 0; answerLog = [];
      initData(); updateCounter(); showQuestion();
      document.getElementById('sessionStarsDisplay').textContent = 'Êú¨Ê¨°Â∑≤Áç≤Âæó 0 È°ÜÊòüÊòü';
    }

    // ÊØèÊ¨°ÈÄ≤ÂÖ•Ëá™ÂãïÈáçÁΩÆÈÄ≤Â∫¶
    localStorage.removeItem('fillIndex');

    // ÂàùÂßãÂåñ
    document.getElementById('totalStarsCount').textContent = 0;
    initData(); loadProgress(); updateCounter(); showQuestion();
    unlockReviewButton();

    // ===== ÊòüÊòüÈ°ØÁ§∫ÂäüËÉΩ =====
    function loadTotalStars() { const v = localStorage.getItem('totalStars'); return v !== null ? parseInt(v, 10) : 0; }
    function updateStarsDisplay() { document.getElementById('totalStarsCount').textContent = loadTotalStars(); }
    document.addEventListener('DOMContentLoaded', updateStarsDisplay);

    // ÂàùÂßãÂåñËÉåÊôØÈü≥Ê®Ç
    document.addEventListener('DOMContentLoaded', initBackgroundMusic);

    // ===== Ë§áÁøíÂñÆÂ≠óÂäüËÉΩÔºàÁµ±‰∏Ä‰ΩøÁî® VOCAB_DATAÔºâ =====
    function showReviewModal() {
      stopTimer();
      const categoryFilter = document.getElementById('categoryFilter');
      const totalVocabCount = document.getElementById('totalVocabCount');
      totalVocabCount.textContent = VOCAB_DATA.length;
      displayVocabByCategory('all');
      categoryFilter.onchange = function() { displayVocabByCategory(this.value); };
      document.getElementById('reviewModal').style.display = 'flex';
    }

    function displayVocabByCategory(category) {
      const container = document.getElementById('reviewWordsContainer');
      const totalVocabCount = document.getElementById('totalVocabCount');
      container.innerHTML = '';
      let filteredVocab = VOCAB_DATA;
      if (category !== 'all') { filteredVocab = VOCAB_DATA.filter(item => item.category === category); }
      totalVocabCount.textContent = filteredVocab.length;
      if (category !== 'all') {
        const categoryTitle = document.createElement('div');
        categoryTitle.style.cssText = `color:#0ff;font-size:1.3rem;font-weight:bold;margin:15px 0 10px 0;padding:10px;background:rgba(0,255,255,0.1);border-radius:8px;text-align:center;`;
        categoryTitle.textContent = `üìÇ ${category} (${filteredVocab.length}ÂÄãÂñÆÂ≠ó)`;
        container.appendChild(categoryTitle);
      }
      filteredVocab.forEach((item, index) => {
        const wordDiv = document.createElement('div');
        wordDiv.style.cssText = `background:rgba(255,255,255,0.1);border:1px solid #ffd700;border-radius:10px;padding:15px;margin:10px 0;text-align:left;cursor:pointer;transition:all .3s;`;
        const categoryLabel = category === 'all' ? `<span style="color:#0ff;font-size:.8rem;background:rgba(0,255,255,.2);padding:2px 6px;border-radius:4px;margin-left:8px;">${item.category}</span>` : '';
        wordDiv.innerHTML = `
          <div style="display:flex;align-items:flex-start;gap:15px;">
            <div style="flex:1;min-width:0;">
              <div style="color:#ffd700;font-size:1.2rem;font-weight:bold;margin-bottom:8px;word-break:break-word;">${index+1}. ${item.word}${categoryLabel}</div>
              <div style="color:#fff;font-size:1rem;margin-bottom:8px;word-break:break-word;"><span style="color:#ffd700;font-weight:bold;">„Äê${item.zh}„Äë</span></div>
              <div style="color:#0ff;font-size:.9rem;font-style:italic;word-break:break-word;">${item.en_sentence}</div>
            </div>
            <button onclick="event.stopPropagation(); speakWord('${item.word}')" style="background:#0ff;color:#000;border:none;border-radius:50%;width:45px;height:45px;font-size:1.3rem;cursor:pointer;flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all .2s;box-shadow:0 2px 8px rgba(0,255,255,.3);">üîä</button>
          </div>`;
        wordDiv.addEventListener('mouseenter', () => { wordDiv.style.background = 'rgba(255, 215, 0, 0.2)'; wordDiv.style.transform = 'scale(1.02)'; });
        wordDiv.addEventListener('mouseleave', () => { wordDiv.style.background = 'rgba(255, 255, 255, 0.1)'; wordDiv.style.transform = 'scale(1)'; });
        wordDiv.addEventListener('click', () => { speakWord(item.word); });
        container.appendChild(wordDiv);
      });
      if (filteredVocab.length === 0) {
        const noWordsDiv = document.createElement('div');
        noWordsDiv.style.cssText = `text-align:center;color:#888;font-size:1.1rem;padding:40px;font-style:italic;`;
        noWordsDiv.textContent = 'Ê≠§ÂàÜÈ°ûÊö´ÁÑ°ÂñÆÂ≠ó';
        container.appendChild(noWordsDiv);
      }
    }

    function closeReviewModal() { document.getElementById('reviewModal').style.display = 'none'; if (currentIndex < data.length && !answered) { startTimer(); } }

    function speakWord(word) {
      if (!window.speechSynthesis) return;
      const utter = new window.SpeechSynthesisUtterance(word);
      utter.lang = 'en-US'; utter.rate = 0.9; utter.pitch = 1.1; if (preferredVoice) utter.voice = preferredVoice;
      window.speechSynthesis.cancel(); window.speechSynthesis.speak(utter);
    }

    // ===== Ë§áÁøíÊåâÈàïÈéñÂÆöÂäüËÉΩ =====
    function lockReviewButton() { const reviewBtn = document.querySelector('.top-btns button[onclick*="showReviewModal"]'); if (reviewBtn) { reviewBtn.disabled = true; reviewBtn.style.background = '#555'; reviewBtn.style.color = '#888'; reviewBtn.style.cursor = 'not-allowed'; reviewBtn.title = 'ÈÅäÊà≤ÈÄ≤Ë°å‰∏≠ÔºåÁÑ°Ê≥ïË§áÁøíÂñÆÂ≠ó'; } }
    function unlockReviewButton() { const reviewBtn = document.querySelector('.top-btns button[onclick*="showReviewModal"]'); if (reviewBtn) { reviewBtn.disabled = false; reviewBtn.style.background = '#ffd700'; reviewBtn.style.color = '#000'; reviewBtn.style.cursor = 'pointer'; reviewBtn.title = 'Ë§áÁøíÂñÆÂ≠ó'; } }

    // ===== Â≠óÂ∫´Áµ±Ë®àÂäüËÉΩÔºà‰ΩøÁî® VOCAB_DATAÔºâ =====
    function showVocabStats() {
      const categoryStats = {};
      VOCAB_DATA.forEach(item => { categoryStats[item.category] = (categoryStats[item.category] || 0) + 1; });
      const statsModal = document.createElement('div');
      statsModal.className = 'modal'; statsModal.style.display = 'flex';
      statsModal.innerHTML = `
        <div class="modal-content" style="max-width: 600px;">
          <div class="end-icon">üìä</div>
          <h2>Â≠óÂ∫´Áµ±Ë®à</h2>
          <div style="text-align: left; margin: 20px 0;">
            <h3 style="color: #ffd700; margin-bottom: 15px;">üìà ÂàÜÈ°ûÁµ±Ë®à</h3>
            ${Object.entries(categoryStats).map(([category, count]) => `
              <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,215,0,0.3);">
                <span style="color:#fff;">${category}</span>
                <span style="color:#0ff;font-weight:bold;">${count} ÂÄãÂñÆÂ≠ó</span>
              </div>`).join('')}
            <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-top:2px solid #ffd700;margin-top:10px;font-weight:bold;">
              <span style="color:#ffd700;">Á∏ΩË®à</span>
              <span style="color:#ffd700;">${VOCAB_DATA.length} ÂÄãÂñÆÂ≠ó</span>
            </div>
          </div>
          <div class="end-buttons"><button onclick="this.closest('.modal').remove()">ÈóúÈñâ</button></div>
        </div>`;
      statsModal.addEventListener('click', function(e) { if (e.target === statsModal) { statsModal.remove(); } });
      document.body.appendChild(statsModal);
    }

    // ===== Â≠óÂ∫´ÂåØÂá∫ÂäüËÉΩÔºà‰ΩøÁî® VOCAB_DATAÔºâ =====
    function exportVocabData() {
      const csvContent = [
        ['ÂñÆÂ≠ó','‰∏≠Êñá','Ëã±Êñá‰æãÂè•','‰∏≠Êñá‰æãÂè•','ÂàÜÈ°û'],
        ...VOCAB_DATA.map(item => [ item.word, item.zh, item.en_sentence, item.zh_sentence, item.category ])
      ].map(row => row.map(cell => `"${cell}"`).join(',')).join('\n');
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', `hera_vocabulary_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden'; document.body.appendChild(link); link.click(); document.body.removeChild(link);
      showNotification('‚úÖ Â≠óÂ∫´Â∑≤ÊàêÂäüÂåØÂá∫ÔºÅ', 'success');
    }

    // ===== ÈÄöÁü•ÂäüËÉΩ =====
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.style.cssText = `position:fixed;top:20px;left:50%;transform:translateX(-50%);background:${type==='success'?'#4caf50':'#2196f3'};color:white;padding:12px 24px;border-radius:8px;font-weight:bold;z-index:10000;animation:slideDown .3s ease-out;`;
      notification.textContent = message;
      const style = document.createElement('style');
      style.textContent = `@keyframes slideDown { from { transform: translateX(-50%) translateY(-100%); opacity:0;} to { transform: translateX(-50%) translateY(0); opacity:1;} }`;
      document.head.appendChild(style);
      document.body.appendChild(notification);
      setTimeout(() => { notification.remove(); style.remove(); }, 3000);
    }

    // ÈªûÊìäÂΩàÁ™óÂ§ñ‰πüËÉΩÈóúÈñâ
    document.addEventListener('DOMContentLoaded', function() {
      const reviewModal = document.getElementById('reviewModal');
      const gameEndModal = document.getElementById('gameEndModal');
      if(reviewModal){ reviewModal.addEventListener('click', function(e){ if(e.target === reviewModal){ closeReviewModal(); } }); }
      if(gameEndModal){ gameEndModal.addEventListener('click', function(e){ if(e.target === gameEndModal){ document.getElementById('gameEndModal').style.display = 'none'; } }); }
    });

    // ËßíËâ≤‰∫íÂãïÁ≥ªÁµ±Êï¥Âêà
    let currentCharacter = localStorage.getItem('characterName') || 'zeus';
    if (window.GameDialogue) { window.GameDialogue.currentCharacter = currentCharacter; }
    function showGameStartDialogue() { if (window.GameDialogue) { window.GameDialogue.showGameStartDialogue(); } }
    function showCorrectAnswerDialogue() { if (window.GameDialogue) { window.GameDialogue.showCorrectAnswerDialogue(); } }
    function showWrongAnswerDialogue() { if (window.GameDialogue) { window.GameDialogue.showWrongAnswerDialogue(); } }
    function showGameVictoryDialogue() { if (window.GameDialogue) { window.GameDialogue.showGameVictoryDialogue(); } }
    function showGameDefeatDialogue() { if (window.GameDialogue) { window.GameDialogue.showGameDefeatDialogue(); } }
    window.addEventListener('DOMContentLoaded', function() { if (window.GameDialogue) { window.GameDialogue.init(); showGameStartDialogue(); } });
  </script>
</body>
</html>
