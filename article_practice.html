<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>è‹±æ–‡æ–‡ç« ç·´ç¿’ - Article Practice</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="responsive_enhanced.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* ç¦ç”¨å³éµé¸å–®å’Œè¤‡è£½åŠŸèƒ½ */
    body {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    /* å…è¨±è¼¸å…¥æ¡†å¯ä»¥é¸å– */
    input, textarea {
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
    
    /* é˜²æ­¢æ°´å¹³æ»¾å‹• */
    html {
      overflow-x: hidden;
    }
    
    /* ç¢ºä¿æ‰€æœ‰å…ƒç´ éƒ½åœ¨è¦–çª—ç¯„åœå…§ */
    * {
      box-sizing: border-box;
      max-width: 100%;
    }

    /* æ”¹å–„è‹±æ–‡å­—é«” */
    body {
      font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
    }

    /* è‹±æ–‡æ–‡ç« å…§å®¹ä½¿ç”¨æ›´å¥½çš„å­—é«” */
    .article-content {
      font-family: 'Georgia', 'Times New Roman', 'Segoe UI', 'Roboto', serif;
      line-height: 2.2;
      font-size: 1.1rem;
      letter-spacing: 1.2px;
      word-spacing: 2px;
    }

    /* è‹±æ–‡æ¨™é¡Œä½¿ç”¨æ¸…æ™°å­—é«” */
    .article-title {
      font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', sans-serif;
      font-weight: 600;
      letter-spacing: 0.8px;
    }

    /* ç·´ç¿’å•é¡Œä½¿ç”¨æ˜“è®€å­—é«” */
    .practice-input p {
      font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'Noto Sans TC', 'Microsoft JhengHei', sans-serif;
      line-height: 1.6;
    }

    /* è©å½™å–®å­—é«˜äº®æ¨£å¼ */
    .vocabulary-word {
      background: linear-gradient(120deg, #ffd700 0%, #ffed4e 100%);
      color: #333;
      font-weight: bold;
      padding: 0px 2px;
      border-radius: 2px;
      border: 1px solid #ffb300;
      box-shadow: 0 1px 2px rgba(255, 179, 0, 0.3);
      cursor: help;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline;
      margin: 0 1px;
      letter-spacing: 0.2px;
    }

    .vocabulary-word:hover {
      background: linear-gradient(120deg, #ffed4e 0%, #ffd700 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(255, 179, 0, 0.4);
    }

    /* è©å½™å–®å­—å·¥å…·æç¤ºæ¨£å¼ */
    .vocabulary-word::after {
      content: attr(title);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 14px;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      z-index: 1000;
      pointer-events: none;
    }

    .vocabulary-word:hover::after {
      opacity: 1;
      visibility: visible;
    }

    /* é¸æ“‡é¡Œé¸é …ä½¿ç”¨æ¸…æ™°å­—é«” */
    .quiz-option {
      font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', sans-serif;
      font-size: 0.95rem;
      line-height: 1.5;
    }
    
    /* === èƒŒæ™¯ï¼šæ˜Ÿç©ºèˆ‡æ¼¸å±¤ === */
    body {
      margin: 0;
      padding: 0;
      overflow: auto;
      color: #fff;
      background: linear-gradient(to bottom, #020111 0%, #000010 100%);
      width: 100%;
      overflow-x: hidden;
    }

    /* æ˜Ÿæ˜Ÿç²’å­ */
    #starfield {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
      pointer-events: none;
    }

    /* ä¸»è¦å®¹å™¨ */
    #container {
      position: relative;
      z-index: 1;
      max-width: 800px;
      margin: 40px auto;
      padding: 30px;
      background: rgba(10, 20, 40, 0.7);
      border-radius: 16px;
      box-shadow: 0 0 32px #00ffff44, 0 0 80px #a259ff22 inset;
      backdrop-filter: blur(8px);
    }

    /* è¿”å›é¦–é æŒ‰éˆ• */
    .home-btn {
      position: absolute;
      top: 20px;
      left: 20px;
      background: linear-gradient(90deg, #00ffff 0%, #a259ff 100%);
      color: #000;
      font-weight: bold;
      padding: 8px 16px;
      border-radius: 8px;
      box-shadow: 0 0 16px #00ffff;
      text-decoration: none;
      z-index: 2;
      transition: transform 0.2s, box-shadow 0.2s;
      font-family: 'Orbitron', 'Segoe UI', sans-serif;
    }
    .home-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 0 32px #00ffff;
    }

    /* æ¨™é¡Œ */
    h1 {
      text-align: center;
      color: #00ffff;
      margin-bottom: 30px;
      font-size: 2.5rem;
      text-shadow: 0 0 12px #00ffff, 0 0 32px #a259ff;
      font-family: 'Orbitron', 'Segoe UI', sans-serif;
    }

    /* æ¨¡å¼é¸æ“‡å€åŸŸ */
    .mode-selection {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .mode-card {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #00ffff;
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
    }

    .mode-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 255, 255, 0.3);
      border-color: #ffd700;
    }

    .mode-card h3 {
      color: #ffd700;
      margin-bottom: 10px;
      font-size: 1.3rem;
    }

    .mode-card p {
      color: #b8c7e0;
      font-size: 0.9rem;
      line-height: 1.5;
    }

    /* æ–‡ç« ç·´ç¿’å€åŸŸ */
    .article-section {
      display: none;
      margin-top: 20px;
    }

    .article-section.active {
      display: block;
    }

    .article-content {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid #00ffff;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      line-height: 1.8;
      font-size: 1.1rem;
    }

    .article-title {
      color: #ffd700;
      font-size: 1.4rem;
      margin-bottom: 15px;
      text-align: center;
    }

    /* ç·´ç¿’è¼¸å…¥å€åŸŸ */
    .practice-input {
      margin-top: 20px;
    }

    .practice-input textarea {
      width: 100%;
      min-height: 120px;
      padding: 15px;
      background: rgba(10, 20, 40, 0.8);
      border: 2px solid #00ffff;
      border-radius: 8px;
      color: #fff;
      font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', sans-serif;
      font-size: 1rem;
      line-height: 1.6;
      letter-spacing: 0.3px;
      resize: vertical;
    }

    .practice-input textarea:focus {
      outline: none;
      border-color: #ffd700;
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    /* æŒ‰éˆ•æ¨£å¼ */
    .btn {
      background: linear-gradient(135deg, #00ffff 0%, #a259ff 100%);
      color: #000;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Orbitron', 'Segoe UI', sans-serif;
      margin: 5px;
    }

    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(0, 255, 255, 0.4);
    }

    .btn-secondary {
      background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
      color: #000;
    }

    .btn-danger {
      background: linear-gradient(135deg, #ff6b6b 0%, #ff4757 100%);
      color: #fff;
    }

    /* éŠæˆ²é—œå¡å…¥å£ */
    .game-entrance {
      margin-top: 30px;
      padding: 20px;
      background: rgba(255, 215, 0, 0.1);
      border: 2px solid #ffd700;
      border-radius: 12px;
      text-align: center;
    }

    .game-entrance h3 {
      color: #ffd700;
      margin-bottom: 15px;
      font-size: 1.4rem;
    }

    .game-entrance p {
      color: #b8c7e0;
      margin-bottom: 20px;
    }

    /* é—œå¡é¸æ“‡æ¨£å¼ */
    .level-selection h3 {
      color: #00ffff;
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }

    .level-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .level-card {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #00ffff;
      border-radius: 12px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      position: relative;
    }

    .level-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 255, 255, 0.3);
      border-color: #ffd700;
    }

    .level-card h4 {
      color: #ffd700;
      margin-bottom: 8px;
      font-size: 1.1rem;
      font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', sans-serif;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .level-card p {
      color: #b8c7e0;
      font-size: 0.9rem;
      margin-bottom: 10px;
      font-family: 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', sans-serif;
      line-height: 1.4;
    }

    .level-status {
      color: #00ff00;
      font-size: 0.8rem;
      font-weight: bold;
    }

    /* é—œå¡å…§å®¹æ¨£å¼ */
    .level-content {
      margin-top: 20px;
    }

    .level-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      border: 1px solid #00ffff;
    }

    .level-header h3 {
      color: #ffd700;
      margin: 0;
      font-size: 1.3rem;
    }

    .level-progress {
      color: #00ffff;
      font-weight: bold;
      font-size: 1.1rem;
    }

    /* é—œå¡é¸æ“‡æ¨£å¼ */
    .level-selection h3 {
      color: #00ffff;
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.5rem;
    }

    .level-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .level-card {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid #00ffff;
      border-radius: 12px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      position: relative;
    }

    .level-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 255, 255, 0.3);
      border-color: #ffd700;
    }

    /* é—œå¡ç‹€æ…‹æ¨£å¼ */
    .level-card.locked {
      opacity: 0.6;
      border-color: #666;
      cursor: not-allowed;
    }
    
    .level-card.locked:hover {
      transform: none;
      box-shadow: none;
      border-color: #666;
    }
    
    .level-card.locked .level-status {
      color: #ff6b6b;
    }
    
    .level-card.unlocked {
      border-color: #00ffff;
    }
    
    .level-card.unlocked .level-status {
      color: #00ff00;
    }
    
    .level-card.completed {
      border-color: #ffd700;
      background: rgba(255, 215, 0, 0.1);
    }
    
    .level-card.completed .level-status {
      color: #ffd700;
    }
    
    /* é€šé—œå¾½ç« æ¨£å¼ */
    .completion-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: linear-gradient(45deg, #ffd700, #ffed4e);
      color: #000;
      font-weight: bold;
      font-size: 0.8rem;
      padding: 4px 8px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(255, 215, 0, 0.5);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .level-status {
      color: #00ff00;
      font-size: 0.8rem;
      font-weight: bold;
    }

    /* é—œå¡å…§å®¹æ¨£å¼ */
    .level-content {
      margin-top: 20px;
    }

    .level-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 15px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      border: 1px solid #00ffff;
    }

    .level-header h3 {
      color: #ffd700;
      margin: 0;
      font-size: 1.3rem;
    }

    .level-progress {
      color: #00ffff;
      font-weight: bold;
      font-size: 1.1rem;
    }

    /* é¸æ“‡é¡Œæ¨£å¼ */
    .quiz-question {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid #00ffff;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .quiz-question h5 {
      color: #ffd700;
      margin-bottom: 10px;
      font-size: 1rem;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .quiz-option {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid #00ffff;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .quiz-option:hover {
      background: rgba(0, 255, 255, 0.2);
      border-color: #ffd700;
    }

    .quiz-option.selected {
      background: rgba(255, 215, 0, 0.3);
      border-color: #ffd700;
    }

    .quiz-option.correct {
      background: rgba(0, 255, 0, 0.3);
      border-color: #00ff00;
    }

    .quiz-option.incorrect {
      background: rgba(255, 0, 0, 0.3);
      border-color: #ff0000;
    }

    .quiz-option input[type="radio"] {
      margin-right: 10px;
    }

    /* å•é¡Œé€²åº¦æ¨£å¼ */
    .question-progress {
      text-align: center;
      color: #00ffff;
      font-weight: bold;
      font-size: 1.1rem;
      margin: 10px 0;
    }

    /* é€²åº¦é¡¯ç¤º */
    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #00ffff, #ffd700);
      transition: width 0.3s ease;
    }

    /* æ˜Ÿæ˜Ÿé¡¯ç¤ºæ¨£å¼ */
    .stars-display {
      position: fixed;
      top: 15px;
      right: 15px;
      background: rgba(10, 20, 40, 0.6);
      padding: 6px 12px;
      border-radius: 10px;
      color: #ffd700;
      font-weight: bold;
      box-shadow: 0 0 12px #ffd700, 0 0 32px #00ffff;
      border: 2px solid #00ffff;
      font-size: 1.1rem;
      backdrop-filter: blur(1px);
      z-index: 1000;
    }

    .stars-display span {
      font-size: 1.1rem;
      font-weight: bold;
      color: #ffd700;
      text-shadow: 0 0 10px #ffd700;
      font-family: 'Orbitron', 'Segoe UI', sans-serif;
    }



    /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 768px) {
      #container {
        margin: 20px auto;
        padding: 20px;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .mode-selection {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- æ˜Ÿæ˜ŸèƒŒæ™¯ -->
  <div id="starfield"></div>

  <!-- è¿”å›é¦–é æŒ‰éˆ• -->
  <a href="index.html" class="home-btn">ğŸ  é¦–é </a>

  <div id="container">
    <h1>ğŸ“š è‹±æ–‡æ–‡ç« ç·´ç¿’</h1>
    
    <!-- æ˜Ÿæ˜Ÿé¡¯ç¤º -->
    <div class="stars-display">
      <span id="totalStarsCount">â­ 0</span>
    </div>
    
    <!-- æ¨¡å¼é¸æ“‡ -->
    <div class="mode-selection">
      <div class="mode-card" onclick="selectMode('reading')">
        <h3>ğŸ“– é–±è®€ç·´ç¿’</h3>
        <p>é–±è®€è‹±æ–‡æ–‡ç« ä¸¦å›ç­”å•é¡Œï¼Œæå‡ç†è§£èƒ½åŠ›</p>
      </div>
      <div class="mode-card" onclick="selectMode('writing')">
        <h3>âœï¸ å¯«ä½œç·´ç¿’</h3>
        <p>æ ¹æ“šæç¤ºå¯«ä½œè‹±æ–‡æ–‡ç« ï¼Œæå‡è¡¨é”èƒ½åŠ›</p>
      </div>
    </div>

    <!-- é–±è®€ç·´ç¿’å€åŸŸ -->
    <div id="reading-section" class="article-section">
      <!-- é—œå¡é¸æ“‡ -->
      <div class="level-selection" id="reading-level-selection">
        <h3>ğŸ“š é¸æ“‡é–±è®€é—œå¡</h3>
        <div style="text-align: center; margin-bottom: 15px;">
          <button class="btn btn-secondary" onclick="showCurrentLevelProgress()">ğŸ“Š æŸ¥çœ‹ç•¶å‰é—œå¡é€²åº¦</button>
          <div style="margin-top: 10px; color: #ffd700; font-weight: bold;">
            <span id="completion-summary">é€šé—œé€²åº¦ï¼š0/40</span>
          </div>
        </div>
        <div class="level-grid" id="level-grid">
          <!-- é—œå¡æœƒå‹•æ…‹è¼‰å…¥ -->
        </div>
      </div>

      <!-- é—œå¡å…§å®¹ -->
      <div class="level-content" id="reading-level-content" style="display: none;">
        <div class="level-header">
          <button class="btn btn-secondary" onclick="backToLevelSelection()">â† è¿”å›é—œå¡é¸æ“‡</button>
          <h3 id="current-level-title">é—œå¡æ¨™é¡Œ</h3>
          <div class="level-progress">
            <span id="current-level-number">1</span> / <span id="total-levels">1</span>
            <span id="level-completion-status" style="margin-left: 10px; color: #ffd700; font-weight: bold;"></span>
          </div>
        </div>

        <div class="article-content" id="current-article">
          <!-- æ–‡ç« å…§å®¹æœƒå‹•æ…‹è¼‰å…¥ -->
        </div>
        <div style="text-align: center; margin-top: 15px;">
          <button class="btn btn-secondary" onclick="playArticleAudio()" id="play-article-btn">
            ğŸ”Š æ’­æ”¾æ–‡ç« ç™¼éŸ³
          </button>
        </div>
        
        <div class="practice-input">
          <h4>ğŸ“ ç·´ç¿’å•é¡Œï¼š</h4>
          <div id="current-question">
            <!-- ç•¶å‰å•é¡Œæœƒå‹•æ…‹è¼‰å…¥ -->
          </div>
          <div class="question-progress">
            <span id="current-question-number">1</span> / <span id="total-questions">3</span>
          </div>
          <textarea id="reading-answer" placeholder="è«‹åœ¨é€™è£¡å¯«ä¸‹ä½ çš„ç­”æ¡ˆ..."></textarea>
          <button class="btn" onclick="checkReadingAnswer()" id="submit-answer-btn">âœ… æäº¤ç­”æ¡ˆ</button>
          <button class="btn btn-secondary" onclick="nextQuestion()" id="next-question-btn" style="display: none;">â¡ï¸ ä¸‹ä¸€é¡Œ</button>
          <div id="answer-feedback" style="margin-top: 10px; color: #ffd700; font-weight: bold;"></div>
          
          <h4 style="margin-top: 20px;">ğŸ¯ é–±è®€æ¸¬é©—ï¼š</h4>
          <div id="current-quiz">
            <!-- é¸æ“‡é¡Œæœƒå‹•æ…‹è¼‰å…¥ -->
          </div>
          <button class="btn" onclick="checkQuiz()">âœ… æª¢æŸ¥æ¸¬é©—</button>
        </div>
      </div>
    </div>

    <!-- å¯«ä½œç·´ç¿’å€åŸŸ -->
    <div id="writing-section" class="article-section">
      <div class="article-content">
        <div class="article-title" id="writing-title">å¯«ä½œä¸»é¡Œï¼šMy Dream Job</div>
        <p id="writing-description">è«‹æ ¹æ“šä»¥ä¸‹æç¤ºå¯«ä¸€ç¯‡é—œæ–¼ã€Œæˆ‘çš„ç†æƒ³å·¥ä½œã€çš„è‹±æ–‡æ–‡ç« ï¼š</p>
        <ul id="writing-prompts">
          <li>What is your dream job?</li>
          <li>Why do you want this job?</li>
          <li>What skills do you need for this job?</li>
          <li>How will you prepare for this career?</li>
        </ul>
      </div>
      
      <div class="practice-input">
        <h4>âœï¸ å¯«ä½œç·´ç¿’ï¼š</h4>
        <textarea id="writing-answer" placeholder="è«‹åœ¨é€™è£¡å¯«ä¸‹ä½ çš„è‹±æ–‡æ–‡ç« ..."></textarea>
        <button class="btn" onclick="saveWriting()">ğŸ’¾ å„²å­˜æ–‡ç« </button>
        <button class="btn btn-secondary" onclick="showWritingTips()">ğŸ’¡ å¯«ä½œæŠ€å·§</button>
        <button class="btn btn-secondary" onclick="changeWritingTopic()">ğŸ”„ æ›å€‹ä¸»é¡Œ</button>
      </div>
    </div>



    <!-- åŠŸèƒ½æŒ‰éˆ•å€åŸŸ -->
    <div style="text-align: center; margin-top: 30px;">
      <button class="btn btn-secondary" onclick="location.href='index.html'">ğŸ  è¿”å›é¦–é </button>
    </div>
  </div>

  <script src="js/articleData.js"></script>
  <script src="js/starRewardSystem.js"></script>
  <script src="js/sound.js"></script>
  <script>
    // æ˜Ÿæ˜ŸèƒŒæ™¯æ•ˆæœ
    function createStars() {
      const starfield = document.getElementById('starfield');
      for (let i = 0; i < 100; i++) {
        const star = document.createElement('div');
        star.style.position = 'absolute';
        star.style.width = '2px';
        star.style.height = '2px';
        star.style.background = 'white';
        star.style.borderRadius = '50%';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 100 + '%';
        star.style.animation = `twinkle ${Math.random() * 3 + 2}s infinite`;
        starfield.appendChild(star);
      }
    }

    // ç•¶å‰æ¨¡å¼
    let currentMode = '';
    let currentReadingLevel = 1;
    let currentWritingTopicIndex = 0;
    let currentQuestionIndex = 0;
    let progress = 0;
    let completedExercises = [];
    let completedReadingLevels = [];


    // åˆå§‹åŒ–èªéŸ³ç³»çµ±
    function initSpeechSynthesis() {
      if ('speechSynthesis' in window) {
        // ç­‰å¾…èªéŸ³åˆ—è¡¨è¼‰å…¥
        speechSynthesis.onvoiceschanged = function() {
          const voices = speechSynthesis.getVoices();
          console.log('å¯ç”¨çš„èªéŸ³ï¼š', voices.map(v => `${v.name} (${v.lang})`));
        };
        
        // ç«‹å³å˜—è©¦ç²å–èªéŸ³åˆ—è¡¨
        const voices = speechSynthesis.getVoices();
        if (voices.length > 0) {
          console.log('èªéŸ³ç³»çµ±å·²åˆå§‹åŒ–');
        }
      }
    }

    // ç¦ç”¨å³éµé¸å–®
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
      return false;
    });
    
    // ç¦ç”¨éµç›¤å¿«æ·éµè¤‡è£½
    document.addEventListener('keydown', function(e) {
      // ç¦ç”¨ Ctrl+C, Ctrl+A, Ctrl+X, Ctrl+V
      if (e.ctrlKey && (e.key === 'c' || e.key === 'a' || e.key === 'x' || e.key === 'v')) {
        // å…è¨±åœ¨è¼¸å…¥æ¡†ä¸­ä½¿ç”¨é€™äº›å¿«æ·éµ
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
          return true;
        }
        e.preventDefault();
        return false;
      }
    });
    
    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      createStars();
      loadProgress();
      loadWritingTopic(); // è¼‰å…¥ç¬¬ä¸€å€‹å¯«ä½œä¸»é¡Œ
      loadReadingLevels(); // è¼‰å…¥é–±è®€é—œå¡
      
      // åˆå§‹åŒ–éŸ³æ•ˆç³»çµ±
      if (typeof SoundSystem !== 'undefined') {
        SoundSystem.init();
      }
      
      // åˆå§‹åŒ–èªéŸ³ç³»çµ±
      initSpeechSynthesis();
      
      // åˆå§‹åŒ–æ˜Ÿæ˜Ÿç³»çµ±é¡¯ç¤º
      updateStarsDisplay();
      
      // ç‚ºæ‰€æœ‰æŒ‰éˆ•æ·»åŠ é»æ“ŠéŸ³æ•ˆ
      if (typeof SoundSystem !== 'undefined') {
        SoundSystem.addClickSoundToElements(document.querySelectorAll('button'));
      }
      
      // å®šæœŸæ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤ºï¼ˆæ¯5ç§’ï¼‰
      setInterval(updateStarsDisplay, 5000);
      
      // å»¶é²æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤ºï¼Œç¢ºä¿DOMå®Œå…¨è¼‰å…¥
      setTimeout(updateStarsDisplay, 100);
      
      // ç‚ºç­”æ¡ˆè¼¸å…¥æ¡†æ·»åŠ  Enter éµäº‹ä»¶
      setupAnswerInputEvents();
      
      // æª¢æŸ¥é–±è®€é—œå¡æˆå°±
      setTimeout(checkReadingAchievements, 2000);
    });
    
    // è¨­ç½®ç­”æ¡ˆè¼¸å…¥æ¡†çš„ Enter éµäº‹ä»¶
    function setupAnswerInputEvents() {
      // ç‚ºé–±è®€ç·´ç¿’ç­”æ¡ˆè¼¸å…¥æ¡†æ·»åŠ  Enter éµäº‹ä»¶
      const readingAnswerInput = document.getElementById('reading-answer');
      if (readingAnswerInput) {
        readingAnswerInput.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault(); // é˜²æ­¢æ›è¡Œ
            checkReadingAnswer();
          }
        });
      }
      
      // ç‚ºéŠæˆ²æ¨¡å¼ç­”æ¡ˆè¼¸å…¥æ¡†æ·»åŠ  Enter éµäº‹ä»¶
      const gameReadingAnswerInput = document.getElementById('game-reading-answer');
      if (gameReadingAnswerInput) {
        gameReadingAnswerInput.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault(); // é˜²æ­¢æ›è¡Œ
            checkGameReadingAnswer();
          }
        });
      }
      
      // ç‚ºå¯«ä½œç·´ç¿’ç­”æ¡ˆè¼¸å…¥æ¡†æ·»åŠ  Enter éµäº‹ä»¶
      const writingAnswerInput = document.getElementById('writing-answer');
      if (writingAnswerInput) {
        writingAnswerInput.addEventListener('keydown', function(e) {
          if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault(); // é˜²æ­¢æ›è¡Œ
            saveWriting();
          }
        });
      }
    }
    
    // æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
    function updateStarsDisplay() {
      const starsCount = document.getElementById('totalStarsCount');
      if (starsCount) {
        const stars = parseInt(localStorage.getItem('totalStars') || '0');
        starsCount.textContent = `â­ ${stars}`;
        console.log('â­ æ˜Ÿæ˜Ÿæ•¸å·²æ›´æ–°:', stars);
      }
      
      // å¦‚æœStarRewardSystemå¯ç”¨ï¼Œä¹Ÿèª¿ç”¨å®ƒ
      if (typeof StarRewardSystem !== 'undefined') {
        StarRewardSystem.updateStarsDisplay();
      }
      
      // é‡æ–°è¼‰å…¥é—œå¡åˆ—è¡¨ä»¥æ›´æ–°è§£é–ç‹€æ…‹
      // æª¢æŸ¥æ˜¯å¦åœ¨é–±è®€æ¨¡å¼æˆ–å°šæœªé¸æ“‡æ¨¡å¼
      if (currentMode === 'reading' || !currentMode) {
        loadReadingLevels();
      }
    }

    // è¼‰å…¥é–±è®€é—œå¡
    function loadReadingLevels() {
      const levelGrid = document.getElementById('level-grid');
      const totalLevels = document.getElementById('total-levels');
      
      // æ›´æ–°ç¸½é—œå¡æ•¸
      totalLevels.textContent = articleLevels.length;
      
      // è¨ˆç®—é€šé—œçµ±è¨ˆ
      const completedCount = completedReadingLevels.length;
      const completionSummary = document.getElementById('completion-summary');
      if (completionSummary) {
        completionSummary.textContent = `é€šé—œé€²åº¦ï¼š${completedCount}/${articleLevels.length}`;
      }
      
      // ç”Ÿæˆé—œå¡å¡ç‰‡
      levelGrid.innerHTML = articleLevels.map((level, index) => {
        const unlockCost = (index + 1) * 5; // æ¯é—œè§£é–éœ€è¦èŠ±è²»5é¡†æ˜Ÿæ˜Ÿ
        const isUnlocked = index === 0 || localStorage.getItem(`level_${index + 1}_unlocked`) === 'true'; // ç¬¬ä¸€é—œé»˜èªè§£é–
        const isCompleted = completedReadingLevels.includes(index + 1);
        
        let statusText = '';
        let statusClass = '';
        let clickAction = '';
        
        if (isCompleted) {
          statusText = 'âœ… å·²é€šé—œ';
          statusClass = 'completed';
          clickAction = `selectReadingLevel(${index + 1})`;
        } else if (isUnlocked) {
          statusText = 'ğŸ”“ å·²è§£é–';
          statusClass = 'unlocked';
          clickAction = `selectReadingLevel(${index + 1})`;
        } else {
          statusText = `ğŸ”’ èŠ±è²» ${unlockCost} é¡†æ˜Ÿæ˜Ÿè§£é–`;
          statusClass = 'locked';
          clickAction = `unlockLevel(${index + 1}, ${unlockCost})`;
        }
        
        return `
          <div class="level-card ${statusClass}" onclick="${clickAction}">
            <h4>${index + 1}. ${level.title}</h4>
            <p>${level.difficulty} - ${level.category}</p>
            <div class="level-status ${statusClass}">${statusText}</div>
            ${isCompleted ? '<div class="completion-badge">ğŸ† é€šé—œ</div>' : ''}
          </div>
        `;
      }).join('');
    }
    
    // è§£é–é—œå¡
    function unlockLevel(levelNumber, cost) {
      const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
      
      if (currentStars >= cost) {
        // ç¢ºèªæ˜¯å¦è¦èŠ±è²»æ˜Ÿæ˜Ÿè§£é–
        const confirmUnlock = confirm(`ğŸ”“ ç¢ºå®šè¦èŠ±è²» ${cost} é¡†æ˜Ÿæ˜Ÿè§£é–ç¬¬ ${levelNumber} é—œå—ï¼Ÿ\n\næ‚¨ç›®å‰æœ‰ ${currentStars} é¡†æ˜Ÿæ˜Ÿ`);
        
        if (confirmUnlock) {
          // æ‰£é™¤æ˜Ÿæ˜Ÿ
          const newStars = currentStars - cost;
          localStorage.setItem('totalStars', newStars.toString());
          
          // æ¨™è¨˜é—œå¡ç‚ºå·²è§£é–
          localStorage.setItem(`level_${levelNumber}_unlocked`, 'true');
          
          // è¨˜éŒ„é—œå¡è§£é–
          recordLevelUnlock();
          
          // æ›´æ–°é¡¯ç¤º
          updateStarsDisplay();
          
          alert(`ğŸ‰ æ­å–œï¼ç¬¬ ${levelNumber} é—œå·²è§£é–ï¼\n\nèŠ±è²»äº† ${cost} é¡†æ˜Ÿæ˜Ÿï¼Œå‰©é¤˜ ${newStars} é¡†æ˜Ÿæ˜Ÿ`);
        }
      } else {
        alert(`ğŸ”’ æ˜Ÿæ˜Ÿä¸è¶³ï¼\n\nè§£é–ç¬¬ ${levelNumber} é—œéœ€è¦ ${cost} é¡†æ˜Ÿæ˜Ÿ\næ‚¨ç›®å‰åªæœ‰ ${currentStars} é¡†æ˜Ÿæ˜Ÿ\n\nè«‹ç¹¼çºŒç·´ç¿’ä»¥ç²å¾—æ›´å¤šæ˜Ÿæ˜Ÿï¼`);
      }
    }
    


    // é¸æ“‡æ¨¡å¼
    function selectMode(mode) {
      currentMode = mode;
      
      // éš±è—æ‰€æœ‰å€åŸŸ
      document.querySelectorAll('.article-section').forEach(section => {
        section.classList.remove('active');
      });
      
      // é¡¯ç¤ºé¸ä¸­çš„å€åŸŸ
      document.getElementById(mode + '-section').classList.add('active');
      
      // å¦‚æœæ˜¯é–±è®€æ¨¡å¼ï¼Œé¡¯ç¤ºé—œå¡é¸æ“‡
      if (mode === 'reading') {
        document.getElementById('reading-level-selection').style.display = 'block';
        document.getElementById('reading-level-content').style.display = 'none';
      }
      

      
      // æ›´æ–°é€²åº¦
      updateProgress();
    }

    // é¸æ“‡é–±è®€é—œå¡
    function selectReadingLevel(level) {
      currentReadingLevel = level;
      const levelData = articleLevels[level - 1];
      
      // éš±è—é—œå¡é¸æ“‡ï¼Œé¡¯ç¤ºé—œå¡å…§å®¹
      document.getElementById('reading-level-selection').style.display = 'none';
      document.getElementById('reading-level-content').style.display = 'block';
      
      // æ›´æ–°é—œå¡æ¨™é¡Œå’Œé€²åº¦
      document.getElementById('current-level-title').textContent = levelData.title;
      document.getElementById('current-level-number').textContent = level;
      
      // æ›´æ–°é€šé—œç‹€æ…‹
      const completionStatus = document.getElementById('level-completion-status');
      if (completedReadingLevels.includes(level)) {
        completionStatus.textContent = 'âœ… å·²é€šé—œ';
        completionStatus.style.color = '#ffd700';
      } else {
        completionStatus.textContent = '';
      }
      
      // è¨˜éŒ„é—œå¡é–‹å§‹æ™‚é–“
      recordLevelStart(level);
      
      // è¼‰å…¥æ–‡ç« å…§å®¹
      const articleDiv = document.getElementById('current-article');
      const highlightedContent = highlightVocabularyWords(levelData.article.content, levelData.vocabulary);
      articleDiv.innerHTML = `
        <div class="article-title">${levelData.article.title}</div>
        <p>${highlightedContent}</p>
      `;
      
      // é‡ç½®ç™¼éŸ³æŒ‰éˆ•ç‹€æ…‹
      const playBtn = document.getElementById('play-article-btn');
      if (playBtn) {
        playBtn.textContent = 'ğŸ”Š æ’­æ”¾æ–‡ç« ç™¼éŸ³';
        playBtn.onclick = playArticleAudio;
      }
      
      // é‡ç½®å•é¡Œç´¢å¼•
      currentQuestionIndex = 0;
      
      // è¼‰å…¥ç¬¬ä¸€å€‹å•é¡Œ
      loadCurrentQuestion();
      
      // è¼‰å…¥é¸æ“‡é¡Œæ¸¬é©—
      const quizDiv = document.getElementById('current-quiz');
      if (levelData.quiz) {
        quizDiv.innerHTML = levelData.quiz.map((quiz, index) => `
          <div class="quiz-question">
            <h5>${index + 1}. ${quiz.question}</h5>
            <div class="quiz-options">
              ${quiz.options.map((option, optIndex) => `
                <label class="quiz-option" onclick="selectQuizOption(${index}, ${optIndex})">
                  <input type="radio" name="quiz${index}" value="${optIndex}">
                  ${String.fromCharCode(65 + optIndex)}) ${option}
                </label>
              `).join('')}
            </div>
          </div>
        `).join('');
        
        // é‡æ–°å•Ÿç”¨æ¸¬é©—æäº¤æŒ‰éˆ•
        const quizSubmitBtn = document.querySelector('button[onclick="checkQuiz()"]');
        if (quizSubmitBtn) {
          quizSubmitBtn.disabled = false;
          quizSubmitBtn.textContent = 'âœ… æª¢æŸ¥æ¸¬é©—';
        }
      } else {
        quizDiv.innerHTML = '<p>æ­¤é—œå¡æš«ç„¡æ¸¬é©—é¡Œç›®</p>';
      }
      
      // æ¸…ç©ºç­”æ¡ˆè¼¸å…¥æ¡†
      document.getElementById('reading-answer').value = '';
      
      // é‡æ–°è¨­ç½® Enter éµäº‹ä»¶
      setupAnswerInputEvents();
    }

    // è¿”å›é—œå¡é¸æ“‡
    function backToLevelSelection() {
      document.getElementById('reading-level-selection').style.display = 'block';
      document.getElementById('reading-level-content').style.display = 'none';
    }

    // ä¸‹ä¸€é—œ
    function nextReadingLevel() {
      if (currentReadingLevel < articleLevels.length) {
        selectReadingLevel(currentReadingLevel + 1);
      } else {
        alert('ğŸ‰ æ­å–œï¼ä½ å·²å®Œæˆæ‰€æœ‰é–±è®€é—œå¡ï¼');
        backToLevelSelection();
      }
    }

    // é«˜äº®è©å½™å–®å­—
    function highlightVocabularyWords(content, vocabulary) {
      if (!vocabulary || vocabulary.length === 0) {
        return content;
      }
      
      let highlightedContent = content;
      
      // ç‚ºæ¯å€‹è©å½™å–®å­—æ·»åŠ é«˜äº®æ¨£å¼
      vocabulary.forEach(item => {
        const word = item.word;
        const meaning = item.meaning;
        
        // ä½¿ç”¨æ­£å‰‡è¡¨é”å¼ä¾†åŒ¹é…å–®å­—ï¼ˆè€ƒæ…®å¤§å°å¯«å’Œè©å½¢è®ŠåŒ–ï¼‰
        const regex = new RegExp(`\\b${word}\\b`, 'gi');
        
        // æ›¿æ›ç‚ºå¸¶æœ‰é«˜äº®æ¨£å¼çš„å–®å­—
        highlightedContent = highlightedContent.replace(regex, 
          `<span class="vocabulary-word" title="${meaning}">${word}</span>`
        );
      });
      
      return highlightedContent;
    }

    // æª¢æŸ¥é–±è®€ç­”æ¡ˆ
    function checkReadingAnswer() {
      const answerInput = document.getElementById('reading-answer');
      const submitBtn = document.getElementById('submit-answer-btn');
      const feedbackDiv = document.getElementById('answer-feedback');
      const answer = answerInput.value.trim();
      if (answer.length > 0) {
        const levelData = articleLevels[currentReadingLevel - 1];
        const correctAnswer = levelData.answers[currentQuestionIndex];
        // ... existing code ...
        let matchCount = 0;
        const answerWords = answer.toLowerCase().split(' ');
        const correctWords = correctAnswer.toLowerCase().split(' ');
        correctWords.forEach(word => {
          if (answerWords.includes(word)) {
            matchCount++;
          }
        });
        const isCorrect = matchCount / correctWords.length >= 0.6;
        recordAnswer(currentReadingLevel, currentQuestionIndex, isCorrect);
        
        // è¨˜éŒ„è©å½™å•é¡Œç­”å°æƒ…æ³
        if (isCorrect) {
          recordVocabCorrect();
        checkReadingAchievements();
        }
        
        // é–å®šè¼¸å…¥æ¡†èˆ‡æäº¤æŒ‰éˆ•
        answerInput.disabled = true;
        submitBtn.disabled = true;
        // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
        feedbackDiv.innerHTML = `æ­£ç¢ºç­”æ¡ˆï¼š<span style='color:#fff;'>${correctAnswer}</span>`;
        if (isCorrect) {
          // ... existing code ...
          if (typeof StarRewardSystem !== 'undefined') {
            StarRewardSystem.addStars(5);
          } else {
            const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
            const newStars = currentStars + 5;
            localStorage.setItem('totalStars', newStars.toString());
          }
          updateStarsDisplay();
          playSound('correct');
          showStarReward(5);
          checkLevelCompletion(currentReadingLevel);
          if (currentQuestionIndex === levelData.questions.length - 1) {
            if (!completedReadingLevels.includes(currentReadingLevel)) {
              completedReadingLevels.push(currentReadingLevel);
              localStorage.setItem(`level_${currentReadingLevel}_completed`, 'true');
              if (typeof StarRewardSystem !== 'undefined') {
                StarRewardSystem.addStars(5);
              } else {
                const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
                const newStars = currentStars + 5;
                localStorage.setItem('totalStars', newStars.toString());
              }
              updateStarsDisplay();
              playSound('complete');
            }
            markExerciseComplete('reading');
          } else {
            document.getElementById('next-question-btn').style.display = 'inline-block';
          }
        } else {
          playSound('wrong');
          // ç­”éŒ¯ä¹Ÿé¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•
          if (currentQuestionIndex < levelData.questions.length - 1) {
            document.getElementById('next-question-btn').style.display = 'inline-block';
          }
        }
      } else {
        alert('è«‹å…ˆå¯«ä¸‹ä½ çš„ç­”æ¡ˆï¼');
      }
    }

    // è¨˜éŒ„ç­”é¡Œçµæœ
    function recordAnswer(level, questionIndex, isCorrect) {
      const key = `level_${level}_answers`;
      let answers = JSON.parse(localStorage.getItem(key) || '{}');
      
      answers[questionIndex] = isCorrect;
      localStorage.setItem(key, JSON.stringify(answers));
    }
    
    // æª¢æŸ¥é—œå¡å®Œæˆåº¦
    function checkLevelCompletion(level) {
      const key = `level_${level}_answers`;
      const answers = JSON.parse(localStorage.getItem(key) || '{}');
      const levelData = articleLevels[level - 1];
      const totalQuestions = levelData.questions.length;
      
      // è¨ˆç®—æ­£ç¢ºç­”æ¡ˆæ•¸é‡
      let correctCount = 0;
      for (let i = 0; i < totalQuestions; i++) {
        if (answers[i] === true) {
          correctCount++;
        }
      }
      
      const practiceAccuracy = (correctCount / totalQuestions) * 100;
      
      // æª¢æŸ¥æ¸¬é©—æˆç¸¾
      const quizKey = `level_${level}_quiz_score`;
      const quizScore = parseInt(localStorage.getItem(quizKey) || '0');
      
      // åªæœ‰ç·´ç¿’å’Œæ¸¬é©—éƒ½é”åˆ°80%æ‰èƒ½é€šé—œ
      if (practiceAccuracy >= 80 && quizScore >= 80 && !completedReadingLevels.includes(level)) {
        completedReadingLevels.push(level);
        
        // æ¨™è¨˜é—œå¡ç‚ºå·²å®Œæˆ
        localStorage.setItem(`level_${level}_completed`, 'true');
        
        // æ›´æ–°å®Œæˆçš„é–±è®€é—œå¡åˆ—è¡¨
        localStorage.setItem('completedReadingLevels', JSON.stringify(completedReadingLevels));
        
        // æª¢æŸ¥æ˜¯å¦ç‚ºæ»¿åˆ†ï¼ˆç·´ç¿’å’Œæ¸¬é©—éƒ½100%ï¼‰
        if (practiceAccuracy === 100 && quizScore === 100) {
          const perfectScores = JSON.parse(localStorage.getItem('readingPerfectScores') || '[]');
          if (!perfectScores.includes(level)) {
            perfectScores.push(level);
            localStorage.setItem('readingPerfectScores', JSON.stringify(perfectScores));
          }
        }
        
        // æª¢æŸ¥å¿«é€Ÿå®Œæˆï¼ˆ10åˆ†é˜å…§ï¼‰
        const levelStartTime = localStorage.getItem(`level_${level}_start_time`);
        if (levelStartTime) {
          const completionTime = Date.now() - parseInt(levelStartTime);
          const timeInMinutes = completionTime / (1000 * 60);
          if (timeInMinutes <= 10) {
            const fastCompletions = JSON.parse(localStorage.getItem('readingFastCompletions') || '[]');
            if (!fastCompletions.includes(level)) {
              fastCompletions.push(level);
              localStorage.setItem('readingFastCompletions', JSON.stringify(fastCompletions));
            }
          }
        }
        
        // æ›´æ–°é€£çºŒé–±è®€å¤©æ•¸
        updateReadingStreak();
        
        // è§¸ç™¼æˆå°±æª¢æŸ¥
        checkReadingAchievements();
        
        // é—œå¡å®Œæˆçå‹µ - éš¨æ©Ÿçµ¦äºˆ10-100é¡†æ˜Ÿæ˜Ÿ
        const starsEarned = Math.floor(Math.random() * 91) + 10; // 10-100é¡†æ˜Ÿæ˜Ÿ
        
        if (typeof StarRewardSystem !== 'undefined') {
          StarRewardSystem.addStars(starsEarned);
        } else {
          // å‚™ç”¨æ˜Ÿæ˜Ÿç³»çµ±
          const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
          const newStars = currentStars + starsEarned;
          localStorage.setItem('totalStars', newStars.toString());
        }
        
        // ç«‹å³æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
        updateStarsDisplay();
        
        // é¡¯ç¤ºæ˜Ÿæ˜Ÿçå‹µå‹•ç•«
        showStarReward(starsEarned);
        
        // æ’­æ”¾å®ŒæˆéŸ³æ•ˆ
        playSound('complete');
        
        // é¡¯ç¤ºé€šé—œçå‹µè¨Šæ¯
        alert(`ğŸ‰ æ­å–œé€šé—œï¼\n\nâ­ ç²å¾— ${starsEarned} é¡†æ˜Ÿæ˜Ÿçå‹µï¼\n\nç¹¼çºŒæŒ‘æˆ°å…¶ä»–é—œå¡å§ï¼`);
        
        // æª¢æŸ¥æˆå°±
        checkReadingAchievements();
        
        // æ–°å¢ï¼šæª¢æŸ¥æ–‡ç« ç·´ç¿’é—œå¡é€šé—œæˆå°±
        checkArticleLevelAchievements(level, practiceAccuracy, quizScore);
      }
    }
    
    // é¡¯ç¤ºé—œå¡é€²åº¦
    function showLevelProgress(level) {
      const key = `level_${level}_answers`;
      const answers = JSON.parse(localStorage.getItem(key) || '{}');
      const levelData = articleLevels[level - 1];
      const totalQuestions = levelData.questions.length;
      
      // è¨ˆç®—ç·´ç¿’æ­£ç¢ºç­”æ¡ˆæ•¸é‡
      let correctCount = 0;
      for (let i = 0; i < totalQuestions; i++) {
        if (answers[i] === true) {
          correctCount++;
        }
      }
      
      const practiceAccuracy = (correctCount / totalQuestions) * 100;
      
      // ç²å–æ¸¬é©—æˆç¸¾
      const quizKey = `level_${level}_quiz_score`;
      const quizScore = parseInt(localStorage.getItem(quizKey) || '0');
      
      // æª¢æŸ¥æ˜¯å¦å·²é€šé—œ
      const isCompleted = completedReadingLevels.includes(level);
      
      let statusMessage = '';
      if (isCompleted) {
        statusMessage = 'ğŸ‰ å·²é€šé—œï¼';
      } else if (practiceAccuracy >= 80 && quizScore >= 80) {
        statusMessage = 'ğŸ‰ å·²é”åˆ°é€šé—œæ¨™æº–ï¼';
      } else {
        statusMessage = 'ğŸ’ª ç¹¼çºŒåŠªåŠ›ï¼';
      }
      
      alert(`ğŸ“Š ç¬¬ ${level} é—œé€²åº¦ï¼š\n\nğŸ“ ç·´ç¿’éƒ¨åˆ†ï¼š\nâœ… æ­£ç¢ºé¡Œæ•¸ï¼š${correctCount}/${totalQuestions}\nğŸ“ˆ æ­£ç¢ºç‡ï¼š${practiceAccuracy.toFixed(1)}%\n\nğŸ¯ æ¸¬é©—éƒ¨åˆ†ï¼š\nğŸ“ˆ æ­£ç¢ºç‡ï¼š${quizScore}%\n\nğŸ¯ é€šé—œæ¨™æº–ï¼šç·´ç¿’å’Œæ¸¬é©—éƒ½éœ€é”åˆ°80%\n\n${statusMessage}`);
    }
    
    // é¡¯ç¤ºç•¶å‰é—œå¡é€²åº¦
    function showCurrentLevelProgress() {
      if (currentReadingLevel) {
        showLevelProgress(currentReadingLevel);
      } else {
        alert('è«‹å…ˆé¸æ“‡ä¸€å€‹é—œå¡ï¼');
      }
    }
    
    // è¼‰å…¥ç•¶å‰å•é¡Œ
    function loadCurrentQuestion() {
      const levelData = articleLevels[currentReadingLevel - 1];
      const questionDiv = document.getElementById('current-question');
      const questionNumber = document.getElementById('current-question-number');
      const totalQuestions = document.getElementById('total-questions');
      
      // æ›´æ–°å•é¡Œé€²åº¦
      questionNumber.textContent = currentQuestionIndex + 1;
      totalQuestions.textContent = levelData.questions.length;
      
      // è¼‰å…¥ç•¶å‰å•é¡Œ
      questionDiv.innerHTML = `<p>${levelData.questions[currentQuestionIndex]}</p>`;
      
      // æ¸…ç©ºç­”æ¡ˆè¼¸å…¥æ¡†ä¸¦é‡æ–°å•Ÿç”¨
      const answerInput = document.getElementById('reading-answer');
      const submitBtn = document.getElementById('submit-answer-btn');
      const feedbackDiv = document.getElementById('answer-feedback');
      
      answerInput.value = '';
      answerInput.disabled = false;
      submitBtn.disabled = false;
      feedbackDiv.innerHTML = '';
      
      // éš±è—ä¸‹ä¸€é¡ŒæŒ‰éˆ•
      document.getElementById('next-question-btn').style.display = 'none';
      
      // é‡æ–°è¨­ç½® Enter éµäº‹ä»¶
      setupAnswerInputEvents();
    }

    // ä¸‹ä¸€é¡Œ
    function nextQuestion() {
      const levelData = articleLevels[currentReadingLevel - 1];
      
      if (currentQuestionIndex < levelData.questions.length - 1) {
        currentQuestionIndex++;
        loadCurrentQuestion();
        
        // éš±è—ä¸‹ä¸€é¡ŒæŒ‰éˆ•
        document.getElementById('next-question-btn').style.display = 'none';
      } else {
        // å¯ä»¥é¸æ“‡é‡æ–°é–‹å§‹æˆ–é€²å…¥ä¸‹ä¸€é—œ
        if (confirm('æ˜¯å¦è¦é‡æ–°é–‹å§‹ç·´ç¿’å•é¡Œï¼Ÿ')) {
          currentQuestionIndex = 0;
          loadCurrentQuestion();
          // éš±è—ä¸‹ä¸€é¡ŒæŒ‰éˆ•
          document.getElementById('next-question-btn').style.display = 'none';
        }
      }
    }

    // é¡¯ç¤ºé–±è®€ç­”æ¡ˆ
    function showReadingAnswer() {
      const levelData = articleLevels[currentReadingLevel - 1];
      const currentAnswer = levelData.answers[currentQuestionIndex];
      // ç§»é™¤é¡¯ç¤ºç­”æ¡ˆçš„å½ˆçª—
    }

    // é¸æ“‡æ¸¬é©—é¸é …
    function selectQuizOption(questionIndex, optionIndex) {
      const questionDiv = document.querySelectorAll('.quiz-question')[questionIndex];
      const options = questionDiv.querySelectorAll('.quiz-option');
      
      // ç§»é™¤æ‰€æœ‰é¸é …çš„é¸ä¸­ç‹€æ…‹
      options.forEach(option => {
        option.classList.remove('selected');
        option.querySelector('input').checked = false;
      });
      
      // é¸ä¸­ç•¶å‰é¸é …
      options[optionIndex].classList.add('selected');
      options[optionIndex].querySelector('input').checked = true;
    }

    // æª¢æŸ¥æ¸¬é©—ç­”æ¡ˆ
    function checkQuiz() {
      const levelData = articleLevels[currentReadingLevel - 1];
      if (!levelData.quiz) {
        return;
      }

      // æª¢æŸ¥æ˜¯å¦å·²ç¶“æäº¤é
      const quizSubmitBtn = document.querySelector('button[onclick="checkQuiz()"]');
      if (quizSubmitBtn.disabled) {
        return; // å·²ç¶“æäº¤éï¼Œä¸å†è™•ç†
      }

      let correctCount = 0;
      const questionDivs = document.querySelectorAll('.quiz-question');
      
      levelData.quiz.forEach((quiz, index) => {
        const selectedOption = questionDivs[index].querySelector('input:checked');
        const options = questionDivs[index].querySelectorAll('.quiz-option');
        
        if (selectedOption) {
          const selectedIndex = parseInt(selectedOption.value);
          
          // ç§»é™¤ä¹‹å‰çš„çµæœæ¨£å¼
          options.forEach(option => {
            option.classList.remove('correct', 'incorrect');
          });
          
          if (selectedIndex === quiz.correct) {
            options[selectedIndex].classList.add('correct');
            correctCount++;
            // è¨˜éŒ„ç†è§£å•é¡Œç­”å°
            recordComprehensionCorrect();
        checkReadingAchievements();
          } else {
            options[selectedIndex].classList.add('incorrect');
            options[quiz.correct].classList.add('correct');
          }
        }
      });
      
      const score = Math.round((correctCount / levelData.quiz.length) * 100);
      
      // è¨ˆç®—æ¸¬é©—çå‹µ
      let starsEarned = 0;
      if (score >= 90) {
        starsEarned = 5; // 90%ä»¥ä¸Šï¼š5æ˜Ÿ
      } else if (score >= 80) {
        starsEarned = 3; // 80%ä»¥ä¸Šï¼š3æ˜Ÿ
      } else if (score >= 60) {
        starsEarned = 1; // 60%ä»¥ä¸Šï¼š1æ˜Ÿ
      }
      
      // çµ¦äºˆæ˜Ÿæ˜Ÿçå‹µ
      if (starsEarned > 0) {
        if (typeof StarRewardSystem !== 'undefined') {
          StarRewardSystem.addStars(starsEarned);
        } else {
          // å‚™ç”¨æ˜Ÿæ˜Ÿç³»çµ±
          const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
          const newStars = currentStars + starsEarned;
          localStorage.setItem('totalStars', newStars.toString());
        }
        
        // ç«‹å³æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
        updateStarsDisplay();
        
        // é¡¯ç¤ºæ˜Ÿæ˜Ÿçå‹µå‹•ç•«
        showStarReward(starsEarned);
        
        // æ’­æ”¾æ­£ç¢ºéŸ³æ•ˆ
        playSound('correct');
      }
      
      // è¨˜éŒ„æ¸¬é©—æˆç¸¾
      const quizKey = `level_${currentReadingLevel}_quiz_score`;
      localStorage.setItem(quizKey, score.toString());
      
      // æª¢æŸ¥æ˜¯å¦é”åˆ°é€šé—œæ¨™æº–ï¼ˆç·´ç¿’å’Œæ¸¬é©—éƒ½80%ï¼‰
      checkLevelCompletion(currentReadingLevel);
      
      // é–å®šæ‰€æœ‰é¸é …å’Œæäº¤æŒ‰éˆ•
      questionDivs.forEach(questionDiv => {
        const options = questionDiv.querySelectorAll('input[type="radio"]');
        options.forEach(option => {
          option.disabled = true;
        });
      });
      quizSubmitBtn.disabled = true;
      quizSubmitBtn.textContent = 'âœ… å·²æäº¤';
      
      // é¡¯ç¤ºæ¸¬é©—çµæœ
      let resultMessage = `ğŸ¯ æ¸¬é©—çµæœï¼š${correctCount}/${levelData.quiz.length} é¡Œæ­£ç¢º (${score}åˆ†)`;
      if (starsEarned > 0) {
        resultMessage += `\n\nâ­ ç²å¾— ${starsEarned} é¡†æ˜Ÿæ˜Ÿçå‹µï¼`;
        if (score >= 90) {
          resultMessage += '\nğŸ‰ å„ªç§€è¡¨ç¾ï¼';
        } else if (score >= 80) {
          resultMessage += '\nğŸ‰ è‰¯å¥½è¡¨ç¾ï¼';
        } else if (score >= 60) {
          resultMessage += '\nğŸ‰ åŠæ ¼è¡¨ç¾ï¼';
        }
      } else {
        resultMessage += '\n\nğŸ’ª ç¹¼çºŒåŠªåŠ›ï¼Œä¸‹æ¬¡æœƒæ›´å¥½ï¼';
      }
      
      alert(resultMessage);
    }

    // æ’­æ”¾æ–‡ç« ç™¼éŸ³
    function playArticleAudio() {
      const levelData = articleLevels[currentReadingLevel - 1];
      if (!levelData) {
        alert('è«‹å…ˆé¸æ“‡é—œå¡ï¼');
        return;
      }
      
      const articleTitle = levelData.article.title;
      const articleContent = levelData.article.content;
      
      // è¨˜éŒ„ä½¿ç”¨ç™¼éŸ³åŠŸèƒ½
      recordAudioUsage();
      
      // æ’­æ”¾éŸ³æ•ˆæç¤º
      playSound('correct');
      
      // é¡¯ç¤ºæ–‡ç« å…§å®¹ä¾›é–±è®€
      const fullText = `${articleTitle}\n\n${articleContent}`;
      
      // ä½¿ç”¨ç€è¦½å™¨çš„èªéŸ³åˆæˆAPIï¼ˆå¦‚æœå¯ç”¨ï¼‰
      if ('speechSynthesis' in window) {
        // ç²å–å¯ç”¨çš„èªéŸ³
        const voices = speechSynthesis.getVoices();
        
        // å°‹æ‰¾æœ€ä½³çš„ç¾å¼è‹±èªèªéŸ³
        let selectedVoice = null;
        
        // å„ªå…ˆé¸æ“‡ï¼šGoogle ç¾å¼è‹±èªå¥³è²
        selectedVoice = voices.find(voice => 
          voice.lang === 'en-US' && 
          voice.name.includes('Google') && 
          voice.name.includes('Female')
        );
        
        // å…¶æ¬¡ï¼šMicrosoft ç¾å¼è‹±èªå¥³è²
        if (!selectedVoice) {
          selectedVoice = voices.find(voice => 
            voice.lang === 'en-US' && 
            voice.name.includes('Microsoft') && 
            voice.name.includes('Female')
          );
        }
        
        // å†æ¬¡ï¼šä»»ä½•ç¾å¼è‹±èªå¥³è²
        if (!selectedVoice) {
          selectedVoice = voices.find(voice => 
            voice.lang === 'en-US' && 
            voice.name.includes('Female')
          );
        }
        
        // æœ€å¾Œï¼šä»»ä½•ç¾å¼è‹±èªèªéŸ³
        if (!selectedVoice) {
          selectedVoice = voices.find(voice => 
            voice.lang === 'en-US'
          );
        }
        
        // å¦‚æœé‚„æ˜¯æ²’æœ‰æ‰¾åˆ°ï¼Œä½¿ç”¨ç¬¬ä¸€å€‹å¯ç”¨çš„èªéŸ³
        if (!selectedVoice && voices.length > 0) {
          selectedVoice = voices[0];
        }
        
        const utterance = new SpeechSynthesisUtterance(fullText);
        utterance.lang = 'en-US';
        utterance.rate = 1.0; // æ­£å¸¸é€Ÿåº¦
        utterance.pitch = 1.1; // ç¨å¾®æé«˜éŸ³èª¿ï¼Œæ›´æœ‰æ´»åŠ›
        utterance.volume = 1.0;
        
        // å¦‚æœæ‰¾åˆ°äº†åˆé©çš„èªéŸ³ï¼Œä½¿ç”¨å®ƒ
        if (selectedVoice) {
          utterance.voice = selectedVoice;
          console.log('ä½¿ç”¨èªéŸ³ï¼š', selectedVoice.name, selectedVoice.lang);
        } else {
          console.log('æœªæ‰¾åˆ°åˆé©çš„èªéŸ³ï¼Œä½¿ç”¨é»˜èªèªéŸ³');
        }
        
        // é–‹å§‹æ’­æ”¾
        speechSynthesis.speak(utterance);
        
        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        const playBtn = document.getElementById('play-article-btn');
        if (playBtn) {
          playBtn.textContent = 'â¸ï¸ æš«åœç™¼éŸ³';
          playBtn.onclick = pauseArticleAudio;
        }
        
        // æ’­æ”¾å®Œæˆå¾Œæ¢å¾©æŒ‰éˆ•
        utterance.onend = function() {
          if (playBtn) {
            playBtn.textContent = 'ğŸ”Š æ’­æ”¾æ–‡ç« ç™¼éŸ³';
            playBtn.onclick = playArticleAudio;
          }
        };
        
        // ç§»é™¤å½ˆçª—ï¼Œåªæ’­æ”¾èªéŸ³
      } else {
        // å¦‚æœç€è¦½å™¨ä¸æ”¯æŒèªéŸ³åˆæˆï¼Œéœé»˜è™•ç†
        console.log('ç€è¦½å™¨ä¸æ”¯æŒèªéŸ³åˆæˆ');
      }
    }
    
    // æš«åœæ–‡ç« ç™¼éŸ³
    function pauseArticleAudio() {
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel(); // åœæ­¢æ‰€æœ‰èªéŸ³
        
        // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
        const playBtn = document.getElementById('play-article-btn');
        if (playBtn) {
          playBtn.textContent = 'ğŸ”Š æ’­æ”¾æ–‡ç« ç™¼éŸ³';
          playBtn.onclick = playArticleAudio;
        }
        
        // ç§»é™¤å½ˆçª—ï¼Œéœé»˜æš«åœ
      }
    }



    // å„²å­˜å¯«ä½œ
    function saveWriting() {
      const writing = document.getElementById('writing-answer').value.trim();
      if (writing.length > 0) {
        localStorage.setItem('savedWriting', writing);
        markExerciseComplete('writing');
        
        // æ›´æ–°å¯«ä½œç·´ç¿’å®Œæˆæ¬¡æ•¸
        const writingCompleted = parseInt(localStorage.getItem('readingWritingCompleted') || '0') + 1;
        localStorage.setItem('readingWritingCompleted', writingCompleted.toString());
        
        // è¨ˆç®—å¯«ä½œçå‹µï¼ˆåŸºæ–¼æ–‡ç« é•·åº¦ï¼‰
        let starsEarned = 3; // åŸºç¤çå‹µ
        const wordCount = writing.split(' ').length;
        
        if (wordCount >= 50) {
          starsEarned = 8; // é•·æ–‡ç« çå‹µ
        } else if (wordCount >= 30) {
          starsEarned = 6; // ä¸­ç­‰æ–‡ç« çå‹µ
        } else if (wordCount >= 15) {
          starsEarned = 4; // çŸ­æ–‡ç« çå‹µ
        }
        
        // çµ¦äºˆå¯«ä½œå®Œæˆçå‹µ
        if (typeof StarRewardSystem !== 'undefined') {
          StarRewardSystem.addStars(starsEarned);
        } else {
          // å‚™ç”¨æ˜Ÿæ˜Ÿç³»çµ±
          const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
          const newStars = currentStars + starsEarned;
          localStorage.setItem('totalStars', newStars.toString());
        }
        
        // ç«‹å³æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
        updateStarsDisplay();
        
        // é¡¯ç¤ºæ˜Ÿæ˜Ÿçå‹µå‹•ç•«
        showStarReward(starsEarned);
        
        // æ’­æ”¾å®ŒæˆéŸ³æ•ˆ
        playSound('complete');
        
        // æª¢æŸ¥æˆå°±
        checkReadingAchievements();
        
        // é¡¯ç¤ºçµæœè¨Šæ¯
        let resultMessage = `ğŸ’¾ æ–‡ç« å·²å„²å­˜ï¼\n\nâ­ ç²å¾— ${starsEarned} é¡†æ˜Ÿæ˜Ÿçå‹µï¼`;
        if (wordCount >= 50) {
          resultMessage += '\nğŸ‰ å„ªç§€çš„é•·ç¯‡æ–‡ç« ï¼';
        } else if (wordCount >= 30) {
          resultMessage += '\nğŸ‰ è‰¯å¥½çš„ä¸­ç­‰æ–‡ç« ï¼';
        } else if (wordCount >= 15) {
          resultMessage += '\nğŸ‰ ä¸éŒ¯çš„çŸ­ç¯‡æ–‡ç« ï¼';
        }
        resultMessage += '\n\nç¹¼çºŒç·´ç¿’å…¶ä»–æ¨¡å¼ä¾†è§£é–éŠæˆ²é—œå¡ã€‚';
        
        alert(resultMessage);
        // æ–°å¢ï¼šç´¯åŠ æ–‡ç« ç·´ç¿’æ¬¡æ•¸
        let articlePracticeCount = parseInt(localStorage.getItem('articlePracticeCount') || '0');
        articlePracticeCount++;
        localStorage.setItem('articlePracticeCount', articlePracticeCount.toString());
      } else {
        alert('è«‹å…ˆå¯«ä¸‹ä½ çš„æ–‡ç« ï¼');
      }
    }

    // è¼‰å…¥å¯«ä½œä¸»é¡Œ
    function loadWritingTopic(index = 0) {
      const topic = writingTopics[index];
      document.getElementById('writing-title').textContent = `å¯«ä½œä¸»é¡Œï¼š${topic.title}`;
      document.getElementById('writing-description').textContent = topic.description;
      
      const promptsList = document.getElementById('writing-prompts');
      promptsList.innerHTML = topic.prompts.map(prompt => `<li>${prompt}</li>`).join('');
    }

    // åˆ‡æ›å¯«ä½œä¸»é¡Œ
    function changeWritingTopic() {
      currentWritingTopicIndex = (currentWritingTopicIndex + 1) % writingTopics.length;
      loadWritingTopic(currentWritingTopicIndex);
      document.getElementById('writing-answer').value = '';
      
      // é‡æ–°è¨­ç½® Enter éµäº‹ä»¶
      setupAnswerInputEvents();
    }

    // é¡¯ç¤ºå¯«ä½œæŠ€å·§
    function showWritingTips() {
      const currentTopic = writingTopics[currentWritingTopicIndex];
      alert('ğŸ’¡ å¯«ä½œæŠ€å·§ï¼š\n\n' + currentTopic.tips.join('\n'));
    }





    // æ¨™è¨˜ç·´ç¿’å®Œæˆ
    function markExerciseComplete(exercise) {
      if (!completedExercises.includes(exercise)) {
        completedExercises.push(exercise);
        
        // è¨ˆç®—é€²åº¦ï¼šåŒ…å«é–±è®€é—œå¡å®Œæˆåº¦
        let totalProgress = completedExercises.length;
        if (exercise === 'reading' && completedReadingLevels.length > 0) {
          totalProgress += completedReadingLevels.length * 0.5; // æ¯å€‹é–±è®€é—œå¡ç®—0.5åˆ†
        }
        
        progress = Math.min((totalProgress / 5) * 100, 100); // æœ€å¤š5åˆ†ï¼ˆ3å€‹æ¨¡å¼ + 4å€‹é–±è®€é—œå¡ï¼‰
        saveProgress();
        updateProgress();
      }
    }

    // æ›´æ–°é€²åº¦
    function updateProgress() {
      const progressFill = document.getElementById('progress-fill');
      const progressText = document.getElementById('progress-text');
      
      if (progressFill) progressFill.style.width = progress + '%';
      if (progressText) progressText.textContent = Math.round(progress) + '%';
    }


    
    // é¸æ“‡éŠæˆ²
    function selectGame(gameType) {
      // æ’­æ”¾é¸æ“‡éŸ³æ•ˆ
      playSound('correct');
      
      // é—œé–‰éŠæˆ²å°è©±æ¡†
      closeGameDialog();
      
      // è¼‰å…¥å°æ‡‰çš„éŠæˆ²å…§å®¹
      loadGameContent(gameType);
    }
    
    // è¼‰å…¥éŠæˆ²å…§å®¹
    function loadGameContent(gameType) {
      // éš±è—æ‰€æœ‰å€åŸŸ
      document.querySelectorAll('.article-section').forEach(section => {
        section.classList.remove('active');
        section.style.display = 'none';
      });
      
      // éš±è—æ¨¡å¼é¸æ“‡
      document.querySelector('.mode-selection').style.display = 'none';
      
      // é¡¯ç¤ºéŠæˆ²å€åŸŸ
      const gameSection = document.getElementById('game-section');
      if (gameSection) {
        gameSection.style.display = 'block';
        gameSection.classList.add('active');
      }
      
      // æ ¹æ“šéŠæˆ²é¡å‹è¼‰å…¥å…§å®¹
      switch(gameType) {
        case 'reading':
          loadReadingGame();
          break;
        case 'quiz':
          loadQuizGame();
          break;
        case 'cards':
          loadCardsGame();
          break;
        case 'gacha':
          loadGachaGame();
          break;
      }
    }
    
    // è¼‰å…¥é–±è®€ç·´ç¿’éŠæˆ²
    function loadReadingGame() {
      const gameSection = document.getElementById('game-section');
      const gameContent = gameSection.querySelector('.article-content');
      
      // éš¨æ©Ÿé¸æ“‡ä¸€å€‹é–±è®€ç­‰ç´š
      const randomLevel = Math.floor(Math.random() * articleLevels.length) + 1;
      currentReadingLevel = randomLevel;
      
      gameContent.innerHTML = `
        <div class="game-header">
          <button class="btn btn-secondary" onclick="backToArticlePractice()">â† è¿”å›ç·´ç¿’</button>
          <h2>ğŸ“– é–±è®€ç·´ç¿’æŒ‘æˆ°</h2>
          <div class="game-stats">
            <span id="reading-level">ç­‰ç´š: ${randomLevel}</span>
            <span id="reading-progress">é€²åº¦: 0%</span>
          </div>
        </div>
        <div class="reading-game-content">
          <div class="article-content" id="game-article">
            <!-- æ–‡ç« å…§å®¹æœƒå‹•æ…‹è¼‰å…¥ -->
          </div>
          <div style="text-align: center; margin-top: 15px;">
            <button class="btn btn-secondary" onclick="playGameArticleAudio()" id="play-game-article-btn">
              ğŸ”Š æ’­æ”¾æ–‡ç« ç™¼éŸ³
            </button>
          </div>
          <div class="practice-input">
            <h4>ğŸ“ ç·´ç¿’å•é¡Œï¼š</h4>
            <div id="game-current-question">
              <!-- ç•¶å‰å•é¡Œæœƒå‹•æ…‹è¼‰å…¥ -->
            </div>
            <div class="question-progress">
              <span id="game-current-question-number">1</span> / <span id="game-total-questions">3</span>
            </div>
            <textarea id="game-reading-answer" placeholder="è«‹åœ¨é€™è£¡å¯«ä¸‹ä½ çš„ç­”æ¡ˆ..."></textarea>
            <button class="btn" onclick="checkGameReadingAnswer()">âœ… æäº¤ç­”æ¡ˆ</button>
            <button class="btn btn-secondary" onclick="nextGameQuestion()" id="game-next-question-btn" style="display: none;">â¡ï¸ ä¸‹ä¸€é¡Œ</button>
            
            <h4 style="margin-top: 20px;">ğŸ¯ é–±è®€æ¸¬é©—ï¼š</h4>
            <div id="game-current-quiz">
              <!-- é¸æ“‡é¡Œæœƒå‹•æ…‹è¼‰å…¥ -->
            </div>
            <button class="btn" onclick="checkGameQuiz()">âœ… æª¢æŸ¥æ¸¬é©—</button>
            <button class="btn btn-secondary" onclick="showGameQuizAnswer()">ğŸ“– é¡¯ç¤ºæ¸¬é©—ç­”æ¡ˆ</button>
          </div>
        </div>
      `;
      
      // è¼‰å…¥æ–‡ç« å…§å®¹
      loadGameArticle();
    }
    
    // è¼‰å…¥éŠæˆ²æ–‡ç« 
    function loadGameArticle() {
      const levelData = articleLevels[currentReadingLevel - 1];
      if (!levelData) return;
      
      // è¼‰å…¥æ–‡ç« å…§å®¹
      const articleDiv = document.getElementById('game-article');
      const highlightedContent = highlightVocabularyWords(levelData.article.content, levelData.vocabulary);
      articleDiv.innerHTML = `
        <div class="article-title">${levelData.article.title}</div>
        <div class="article-text">${highlightedContent}</div>
      `;
      
      // è¼‰å…¥å•é¡Œ
      loadGameQuestions();
      
      // è¼‰å…¥æ¸¬é©—
      loadGameQuiz();
    }
    
    // è¼‰å…¥éŠæˆ²å•é¡Œ
    function loadGameQuestions() {
      const levelData = articleLevels[currentReadingLevel - 1];
      if (!levelData || !levelData.questions) return;
      
      currentQuestionIndex = 0;
      totalQuestions = levelData.questions.length;
      
      // æ›´æ–°å•é¡Œé€²åº¦
      document.getElementById('game-current-question-number').textContent = '1';
      document.getElementById('game-total-questions').textContent = totalQuestions;
      
      // é¡¯ç¤ºç¬¬ä¸€å€‹å•é¡Œ
      showGameQuestion();
    }
    
    // é¡¯ç¤ºéŠæˆ²å•é¡Œ
    function showGameQuestion() {
      const levelData = articleLevels[currentReadingLevel - 1];
      if (!levelData || !levelData.questions) return;
      
      const question = levelData.questions[currentQuestionIndex];
      if (!question) return;
      
      const questionDiv = document.getElementById('game-current-question');
      questionDiv.innerHTML = `
        <p><strong>å•é¡Œ ${currentQuestionIndex + 1}ï¼š</strong>${question.question}</p>
      `;
      
      // æ¸…ç©ºç­”æ¡ˆè¼¸å…¥æ¡†
      document.getElementById('game-reading-answer').value = '';
      
      // é‡æ–°è¨­ç½® Enter éµäº‹ä»¶
      setupAnswerInputEvents();
    }
    
    // è¼‰å…¥éŠæˆ²æ¸¬é©—
    function loadGameQuiz() {
      const levelData = articleLevels[currentReadingLevel - 1];
      if (!levelData || !levelData.quiz) return;
      
      const quizDiv = document.getElementById('game-current-quiz');
      quizDiv.innerHTML = '';
      
      levelData.quiz.forEach((quizItem, index) => {
        const quizElement = document.createElement('div');
        quizElement.className = 'quiz-item';
        quizElement.innerHTML = `
          <p><strong>æ¸¬é©— ${index + 1}ï¼š</strong>${quizItem.question}</p>
          <div class="quiz-options">
            ${quizItem.options.map((option, optionIndex) => `
              <label>
                <input type="radio" name="quiz-${index}" value="${optionIndex}">
                ${option}
              </label>
            `).join('')}
          </div>
        `;
        quizDiv.appendChild(quizElement);
      });
    }
    
    // è¼‰å…¥æ‰“å­—æŒ‘æˆ°éŠæˆ²
    function loadQuizGame() {
      const gameSection = document.getElementById('game-section');
      const gameContent = gameSection.querySelector('.article-content');
      gameContent.innerHTML = `
        <div class="game-header">
          <button class="btn btn-secondary" onclick="backToArticlePractice()">â† è¿”å›ç·´ç¿’</button>
          <h2>ğŸ¯ æ‰“å­—æŒ‘æˆ°</h2>
          <div class="game-stats">
            <span id="quiz-score">åˆ†æ•¸: 0</span>
            <span id="quiz-time">æ™‚é–“: 60s</span>
          </div>
        </div>
        <div class="quiz-game-content">
          <div class="word-display" id="current-word">è¼‰å…¥ä¸­...</div>
          <input type="text" id="word-input" placeholder="è«‹è¼¸å…¥å–®å­—..." autocomplete="off">
          <div class="quiz-instructions">
            <p>ğŸ¯ ç›®æ¨™ï¼šå¿«é€Ÿæº–ç¢ºåœ°è¼¸å…¥é¡¯ç¤ºçš„è‹±æ–‡å–®å­—</p>
            <p>â±ï¸ æ™‚é–“ï¼š60ç§’å…§è¼¸å…¥è¶Šå¤šå–®å­—è¶Šå¥½</p>
            <p>â­ çå‹µï¼šæ­£ç¢ºè¼¸å…¥å¯ç²å¾—æ˜Ÿæ˜Ÿçå‹µ</p>
          </div>
          <button class="btn" onclick="startQuizGame()" id="start-quiz-btn">ğŸš€ é–‹å§‹æŒ‘æˆ°</button>
        </div>
      `;
      
      // ç‚ºè¼¸å…¥æ¡†æ·»åŠ äº‹ä»¶ç›£è½
      const input = document.getElementById('word-input');
      if (input) {
        input.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            checkQuizWord();
          }
        });
      }
    }
    
    // è¼‰å…¥å¡ç‰‡éŠæˆ²
    function loadCardsGame() {
      const gameSection = document.getElementById('game-section');
      const gameContent = gameSection.querySelector('.article-content');
      gameContent.innerHTML = `
        <div class="game-header">
          <button class="btn btn-secondary" onclick="backToArticlePractice()">â† è¿”å›ç·´ç¿’</button>
          <h2>ğŸƒ å¡ç‰‡é…å°éŠæˆ²</h2>
          <div class="game-stats">
            <span id="cards-score">é…å°: 0</span>
            <span id="cards-time">æ™‚é–“: 120s</span>
          </div>
        </div>
        <div class="cards-game-content">
          <div class="cards-grid" id="cards-grid">
            <!-- å¡ç‰‡æœƒå‹•æ…‹ç”Ÿæˆ -->
          </div>
          <div class="cards-instructions">
            <p>ğŸƒ ç›®æ¨™ï¼šé…å°è‹±æ–‡å–®å­—å’Œä¸­æ–‡æ„æ€</p>
            <p>â±ï¸ æ™‚é–“ï¼š120ç§’å…§å®Œæˆé…å°</p>
            <p>â­ çå‹µï¼šæ¯å°é…å°å¯ç²å¾—æ˜Ÿæ˜Ÿçå‹µ</p>
          </div>
          <button class="btn" onclick="startCardsGame()" id="start-cards-btn">ğŸš€ é–‹å§‹éŠæˆ²</button>
        </div>
      `;
    }
    
    // è¼‰å…¥æŠ½å¡éŠæˆ²
    function loadGachaGame() {
      const gameSection = document.getElementById('game-section');
      const gameContent = gameSection.querySelector('.article-content');
      gameContent.innerHTML = `
        <div class="game-header">
          <button class="btn btn-secondary" onclick="backToArticlePractice()">â† è¿”å›ç·´ç¿’</button>
          <h2>ğŸ° æŠ½å¡éŠæˆ²</h2>
          <div class="game-stats">
            <span id="gacha-stars">æ˜Ÿæ˜Ÿ: ${localStorage.getItem('totalStars') || '0'}</span>
            <span id="gacha-cards">å¡ç‰‡: 0</span>
          </div>
        </div>
        <div class="gacha-game-content">
          <div class="gacha-machine" id="gacha-machine">
            <div class="gacha-display">ğŸ°</div>
            <div class="gacha-result" id="gacha-result"></div>
          </div>
          <div class="gacha-instructions">
            <p>ğŸ° ç›®æ¨™ï¼šä½¿ç”¨æ˜Ÿæ˜ŸæŠ½å–ç¨€æœ‰è‹±æ–‡å–®å­—å¡ç‰‡</p>
            <p>â­ æ¶ˆè€—ï¼šæ¯æ¬¡æŠ½å¡æ¶ˆè€—5é¡†æ˜Ÿæ˜Ÿ</p>
            <p>ğŸ çå‹µï¼šç²å¾—ç¨€æœ‰å–®å­—å¡ç‰‡</p>
          </div>
          <button class="btn" onclick="drawCard()" id="draw-card-btn">ğŸ° æŠ½å¡ (5â­)</button>
        </div>
      `;
    }
    
    // è¿”å›æ–‡ç« ç·´ç¿’
    function backToArticlePractice() {
      // éš±è—éŠæˆ²å€åŸŸ
      const gameSection = document.getElementById('game-section');
      if (gameSection) {
        gameSection.style.display = 'none';
        gameSection.classList.remove('active');
      }
      
      // é¡¯ç¤ºæ‰€æœ‰å€åŸŸ
      document.querySelectorAll('.article-section').forEach(section => {
        section.style.display = 'block';
      });
      
      // é¡¯ç¤ºæ¨¡å¼é¸æ“‡
      document.querySelector('.mode-selection').style.display = 'grid';
      
      // é‡ç½®ç•¶å‰æ¨¡å¼
      currentMode = '';
      
      // é‡ç½®éŠæˆ²ç‹€æ…‹
      if (quizTimer) clearInterval(quizTimer);
      if (cardsTimer) clearInterval(cardsTimer);
      quizGameActive = false;
      cardsGameActive = false;
      
      // æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
      updateStarsDisplay();
    }
    

    
    // é–‹å§‹æ‰“å­—æŒ‘æˆ°éŠæˆ²
    function startQuizGame() {
      quizGameActive = true;
      quizScore = 0;
      quizTimeLeft = 60;
      
      // ç”Ÿæˆå–®å­—åˆ—è¡¨ï¼ˆå¾æ–‡ç« è³‡æ–™ä¸­æå–ï¼‰
      quizWords = generateQuizWords();
      
      // é¡¯ç¤ºç¬¬ä¸€å€‹å–®å­—
      showNextQuizWord();
      
      // é–‹å§‹è¨ˆæ™‚
      startQuizTimer();
      
      // éš±è—é–‹å§‹æŒ‰éˆ•
      document.getElementById('start-quiz-btn').style.display = 'none';
      
      // èšç„¦è¼¸å…¥æ¡†
      document.getElementById('word-input').focus();
    }
    
    // ç”Ÿæˆæ¸¬é©—å–®å­—
    function generateQuizWords() {
      const words = [];
      
      // å¾æ–‡ç« è³‡æ–™ä¸­æå–å–®å­—
      articleLevels.forEach(level => {
        if (level.vocabulary) {
          level.vocabulary.forEach(vocab => {
            words.push(vocab.word);
          });
        }
      });
      
      // å¦‚æœæ²’æœ‰è¶³å¤ çš„å–®å­—ï¼Œæ·»åŠ ä¸€äº›åŸºæœ¬å–®å­—
      if (words.length < 20) {
        const basicWords = ['hello', 'world', 'good', 'bad', 'big', 'small', 'happy', 'sad', 'fast', 'slow', 'hot', 'cold', 'new', 'old', 'young', 'beautiful', 'ugly', 'strong', 'weak', 'rich', 'poor'];
        words.push(...basicWords);
      }
      
      // éš¨æ©Ÿæ‰“äº‚ä¸¦è¿”å›å‰30å€‹å–®å­—
      return words.sort(() => Math.random() - 0.5).slice(0, 30);
    }
    
    // é¡¯ç¤ºä¸‹ä¸€å€‹æ¸¬é©—å–®å­—
    function showNextQuizWord() {
      if (quizWords.length > 0) {
        currentQuizWord = quizWords.shift();
        document.getElementById('current-word').textContent = currentQuizWord;
        document.getElementById('word-input').value = '';
        document.getElementById('word-input').focus();
      } else {
        // éŠæˆ²çµæŸ
        endQuizGame();
      }
    }
    
    // æª¢æŸ¥æ¸¬é©—å–®å­—
    function checkQuizWord() {
      const input = document.getElementById('word-input');
      const userInput = input.value.trim().toLowerCase();
      const correctWord = currentQuizWord.toLowerCase();
      
      if (userInput === correctWord) {
        // æ­£ç¢º
        quizScore += 10;
        playSound('correct');
        
        // çµ¦äºˆæ˜Ÿæ˜Ÿçå‹µ
        if (typeof StarRewardSystem !== 'undefined') {
          StarRewardSystem.addStars(1);
        } else {
          const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
          localStorage.setItem('totalStars', (currentStars + 1).toString());
        }
        
        // æ›´æ–°åˆ†æ•¸é¡¯ç¤º
        document.getElementById('quiz-score').textContent = `åˆ†æ•¸: ${quizScore}`;
        
        // é¡¯ç¤ºæ­£ç¢ºå‹•ç•«
        document.getElementById('current-word').style.color = '#00ff00';
        setTimeout(() => {
          document.getElementById('current-word').style.color = '#ffd700';
          showNextQuizWord();
        }, 500);
      } else {
        // éŒ¯èª¤
        playSound('wrong');
        document.getElementById('current-word').style.color = '#ff0000';
        setTimeout(() => {
          document.getElementById('current-word').style.color = '#ffd700';
        }, 500);
      }
    }
    
    // é–‹å§‹æ¸¬é©—è¨ˆæ™‚å™¨
    function startQuizTimer() {
      quizTimer = setInterval(() => {
        quizTimeLeft--;
        document.getElementById('quiz-time').textContent = `æ™‚é–“: ${quizTimeLeft}s`;
        
        if (quizTimeLeft <= 0) {
          endQuizGame();
        }
      }, 1000);
    }
    
    // çµæŸæ¸¬é©—éŠæˆ²
    function endQuizGame() {
      quizGameActive = false;
      clearInterval(quizTimer);
      
      // è¨ˆç®—æœ€çµ‚çå‹µ
      const finalStars = Math.floor(quizScore / 10);
      if (typeof StarRewardSystem !== 'undefined') {
        StarRewardSystem.addStars(finalStars);
      } else {
        const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
        localStorage.setItem('totalStars', (currentStars + finalStars).toString());
      }
      
      // æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
      updateStarsDisplay();
      
      // é¡¯ç¤ºçµæœ
      alert(`ğŸ¯ æ‰“å­—æŒ‘æˆ°çµæŸï¼\n\nåˆ†æ•¸ï¼š${quizScore}\næ­£ç¢ºå–®å­—ï¼š${Math.floor(quizScore / 10)}å€‹\nç²å¾—æ˜Ÿæ˜Ÿï¼š${finalStars}é¡†`);
      
      // é‡æ–°è¼‰å…¥éŠæˆ²
      setTimeout(() => {
        loadQuizGame();
      }, 1000);
    }
    
    // é–‹å§‹å¡ç‰‡éŠæˆ²
    function startCardsGame() {
      cardsGameActive = true;
      cardsScore = 0;
      cardsTimeLeft = 120;
      matchedPairs = 0;
      flippedCards = [];
      
      // ç”Ÿæˆå¡ç‰‡
      generateCards();
      
      // é–‹å§‹è¨ˆæ™‚
      startCardsTimer();
      
      // éš±è—é–‹å§‹æŒ‰éˆ•
      document.getElementById('start-cards-btn').style.display = 'none';
    }
    
    // ç”Ÿæˆå¡ç‰‡
    function generateCards() {
      const cardsData = [
        { word: 'hello', meaning: 'ä½ å¥½' },
        { word: 'world', meaning: 'ä¸–ç•Œ' },
        { word: 'good', meaning: 'å¥½çš„' },
        { word: 'bad', meaning: 'å£çš„' },
        { word: 'big', meaning: 'å¤§çš„' },
        { word: 'small', meaning: 'å°çš„' }
      ];
      
      // å‰µå»ºå¡ç‰‡å°
      const cards = [];
      cardsData.forEach(item => {
        cards.push({ content: item.word, type: 'word', id: item.word });
        cards.push({ content: item.meaning, type: 'meaning', id: item.word });
      });
      
      // éš¨æ©Ÿæ‰“äº‚
      cards.sort(() => Math.random() - 0.5);
      
      // ç”ŸæˆHTML
      const cardsGrid = document.getElementById('cards-grid');
      cardsGrid.innerHTML = cards.map((card, index) => `
        <div class="card" onclick="flipCard(${index})" data-index="${index}" data-id="${card.id}" data-type="${card.type}" data-content="${card.content}">
          ?
        </div>
      `).join('');
    }
    
    // ç¿»è½‰å¡ç‰‡
    function flipCard(index) {
      if (!cardsGameActive) return;
      
      const card = document.querySelector(`[data-index="${index}"]`);
      if (card.classList.contains('flipped') || card.classList.contains('matched')) return;
      
      // ç¿»è½‰å¡ç‰‡
      card.classList.add('flipped');
      card.textContent = card.dataset.content;
      
      flippedCards.push({ element: card, id: card.dataset.id, type: card.dataset.type });
      
      if (flippedCards.length === 2) {
        // æª¢æŸ¥æ˜¯å¦é…å°
        setTimeout(() => {
          checkCardMatch();
        }, 500);
      }
    }
    
    // æª¢æŸ¥å¡ç‰‡é…å°
    function checkCardMatch() {
      const [card1, card2] = flippedCards;
      
      if (card1.id === card2.id && card1.type !== card2.type) {
        // é…å°æˆåŠŸ
        card1.element.classList.add('matched');
        card2.element.classList.add('matched');
        cardsScore += 10;
        matchedPairs++;
        
        playSound('correct');
        
        // çµ¦äºˆæ˜Ÿæ˜Ÿçå‹µ
        if (typeof StarRewardSystem !== 'undefined') {
          StarRewardSystem.addStars(2);
        } else {
          const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
          localStorage.setItem('totalStars', (currentStars + 2).toString());
        }
        
        document.getElementById('cards-score').textContent = `é…å°: ${matchedPairs}`;
        
        // æª¢æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰é…å°
        if (matchedPairs === 6) {
          endCardsGame();
        }
      } else {
        // é…å°å¤±æ•—ï¼Œç¿»å›å¡ç‰‡
        setTimeout(() => {
          card1.element.classList.remove('flipped');
          card2.element.classList.remove('flipped');
          card1.element.textContent = '?';
          card2.element.textContent = '?';
        }, 1000);
      }
      
      flippedCards = [];
    }
    
    // é–‹å§‹å¡ç‰‡è¨ˆæ™‚å™¨
    function startCardsTimer() {
      cardsTimer = setInterval(() => {
        cardsTimeLeft--;
        document.getElementById('cards-time').textContent = `æ™‚é–“: ${cardsTimeLeft}s`;
        
        if (cardsTimeLeft <= 0) {
          endCardsGame();
        }
      }, 1000);
    }
    
    // çµæŸå¡ç‰‡éŠæˆ²
    function endCardsGame() {
      cardsGameActive = false;
      clearInterval(cardsTimer);
      
      // è¨ˆç®—æœ€çµ‚çå‹µ
      const finalStars = matchedPairs * 2;
      if (typeof StarRewardSystem !== 'undefined') {
        StarRewardSystem.addStars(finalStars);
      } else {
        const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
        localStorage.setItem('totalStars', (currentStars + finalStars).toString());
      }
      
      // æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
      updateStarsDisplay();
      
      // é¡¯ç¤ºçµæœ
      alert(`ğŸƒ å¡ç‰‡éŠæˆ²çµæŸï¼\n\né…å°æˆåŠŸï¼š${matchedPairs}å°\nç²å¾—æ˜Ÿæ˜Ÿï¼š${finalStars}é¡†`);
      
      // é‡æ–°è¼‰å…¥éŠæˆ²
      setTimeout(() => {
        loadCardsGame();
      }, 1000);
    }
    
    // éŠæˆ²é–±è®€ç·´ç¿’ç›¸é—œå‡½æ•¸
    function playGameArticleAudio() {
      const levelData = articleLevels[currentReadingLevel - 1];
      if (!levelData) return;
      
      const fullText = `${levelData.title}. ${levelData.content}`;
      
      if ('speechSynthesis' in window) {
        const utterance = new SpeechSynthesisUtterance(fullText);
        utterance.lang = 'en-US';
        utterance.rate = 1.0;
        utterance.pitch = 1.1;
        utterance.volume = 1.0;
        
        // é¸æ“‡æœ€ä½³èªéŸ³
        const voices = speechSynthesis.getVoices();
        const preferredVoice = voices.find(voice => 
          voice.name.includes('Google US English Female') ||
          voice.name.includes('Microsoft US English Female') ||
          (voice.lang.includes('en-US') && voice.name.includes('Female'))
        ) || voices.find(voice => voice.lang.includes('en-US')) || voices[0];
        
        if (preferredVoice) {
          utterance.voice = preferredVoice;
        }
        
        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        const playBtn = document.getElementById('play-game-article-btn');
        if (playBtn) {
          playBtn.textContent = 'â¸ï¸ æš«åœç™¼éŸ³';
          playBtn.onclick = pauseGameArticleAudio;
        }
        
        speechSynthesis.speak(utterance);
      } else {
        console.log('ç€è¦½å™¨ä¸æ”¯æŒèªéŸ³åˆæˆ');
      }
    }
    
    function pauseGameArticleAudio() {
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel();
        
        // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
        const playBtn = document.getElementById('play-game-article-btn');
        if (playBtn) {
          playBtn.textContent = 'ğŸ”Š æ’­æ”¾æ–‡ç« ç™¼éŸ³';
          playBtn.onclick = playGameArticleAudio;
        }
      }
    }
    
    function checkGameReadingAnswer() {
      const levelData = articleLevels[currentReadingLevel - 1];
      if (!levelData || !levelData.questions) return;
      
      const question = levelData.questions[currentQuestionIndex];
      if (!question) return;
      
      const userAnswer = document.getElementById('game-reading-answer').value.trim();
      const correctAnswer = question.answer;
      
      // æª¢æŸ¥ç­”æ¡ˆï¼ˆ60%é—œéµå­—åŒ¹é…ï¼‰
      const userWords = userAnswer.toLowerCase().split(/\s+/);
      const correctWords = correctAnswer.toLowerCase().split(/\s+/);
      const matchCount = userWords.filter(word => correctWords.includes(word)).length;
      const matchPercentage = (matchCount / Math.max(userWords.length, correctWords.length)) * 100;
      
      if (matchPercentage >= 60) {
        // æ­£ç¢º
        playSound('correct');
        
        // çµ¦äºˆæ˜Ÿæ˜Ÿçå‹µï¼ˆç¿»è­¯ç·´ç¿’å›ºå®š5é¡†æ˜Ÿæ˜Ÿï¼‰
        if (typeof StarRewardSystem !== 'undefined') {
          StarRewardSystem.addStars(5);
        } else {
          const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
          localStorage.setItem('totalStars', (currentStars + 5).toString());
        }
        
        // å¦‚æœä¸æ˜¯æœ€å¾Œä¸€é¡Œï¼Œé¡¯ç¤ºä¸‹ä¸€é¡ŒæŒ‰éˆ•
        const levelData = articleLevels[currentReadingLevel - 1];
        if (currentQuestionIndex < levelData.questions.length - 1) {
          document.getElementById('game-next-question-btn').style.display = 'inline-block';
        }
      } else {
        // éŒ¯èª¤
        playSound('wrong');
      }
    }
    
    function showGameReadingAnswer() {
      const levelData = articleLevels[currentReadingLevel - 1];
      if (!levelData || !levelData.questions) return;
      
      const question = levelData.questions[currentQuestionIndex];
      if (!question) return;
      
      alert(`ğŸ“– æ­£ç¢ºç­”æ¡ˆï¼š\n\n${question.answer}`);
    }
    
    function nextGameQuestion() {
      const levelData = articleLevels[currentReadingLevel - 1];
      if (!levelData || !levelData.questions) return;
      
      if (currentQuestionIndex < levelData.questions.length - 1) {
        currentQuestionIndex++;
        
        // æ›´æ–°å•é¡Œé€²åº¦
        document.getElementById('game-current-question-number').textContent = currentQuestionIndex + 1;
        
        // é¡¯ç¤ºä¸‹ä¸€å€‹å•é¡Œ
        showGameQuestion();
        
        // éš±è—ä¸‹ä¸€é¡ŒæŒ‰éˆ•
        document.getElementById('game-next-question-btn').style.display = 'none';
      } else {
        // æ‰€æœ‰å•é¡Œå®Œæˆ
        if (typeof StarRewardSystem !== 'undefined') {
          StarRewardSystem.addStars(5);
        } else {
          const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
          localStorage.setItem('totalStars', (currentStars + 5).toString());
        }
        
        // é‡ç½®å•é¡Œç´¢å¼•
        currentQuestionIndex = 0;
        
        // æ›´æ–°å•é¡Œé€²åº¦
        document.getElementById('game-current-question-number').textContent = currentQuestionIndex + 1;
        
        // é¡¯ç¤ºä¸‹ä¸€å€‹å•é¡Œ
        showGameQuestion();
        
        // éš±è—ä¸‹ä¸€é¡ŒæŒ‰éˆ•
        document.getElementById('game-next-question-btn').style.display = 'none';
      }
    }
    
    function checkGameQuiz() {
      const levelData = articleLevels[currentReadingLevel - 1];
      if (!levelData || !levelData.quiz) return;
      
      let correctCount = 0;
      const totalQuestions = levelData.quiz.length;
      
      levelData.quiz.forEach((quizItem, index) => {
        const selectedOption = document.querySelector(`input[name="quiz-${index}"]:checked`);
        if (selectedOption && parseInt(selectedOption.value) === quizItem.correctAnswer) {
          correctCount++;
        }
      });
      
      const score = (correctCount / totalQuestions) * 100;
      
      // æ ¹æ“šåˆ†æ•¸çµ¦äºˆæ˜Ÿæ˜Ÿçå‹µ
      let starsEarned = 0;
      if (score >= 90) {
        starsEarned = 5;
      } else if (score >= 80) {
        starsEarned = 3;
      } else if (score >= 60) {
        starsEarned = 1;
      }
      
      if (typeof StarRewardSystem !== 'undefined') {
        StarRewardSystem.addStars(starsEarned);
      } else {
        const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
        localStorage.setItem('totalStars', (currentStars + starsEarned).toString());
      }
      
      // æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
      updateStarsDisplay();
    }
    
    function showGameQuizAnswer() {
      const levelData = articleLevels[currentReadingLevel - 1];
      if (!levelData || !levelData.quiz) return;
      
      let answerText = 'ğŸ“– æ¸¬é©—ç­”æ¡ˆï¼š\n\n';
      
      levelData.quiz.forEach((quizItem, index) => {
        const correctOption = quizItem.options[quizItem.correctAnswer];
        answerText += `æ¸¬é©— ${index + 1}ï¼š${correctOption}\n`;
      });
      
      alert(answerText);
    }
    
    function nextGameReadingLevel() {
      // éš¨æ©Ÿé¸æ“‡ä¸‹ä¸€å€‹ç­‰ç´š
      const randomLevel = Math.floor(Math.random() * articleLevels.length) + 1;
      currentReadingLevel = randomLevel;
      
      // é‡æ–°è¼‰å…¥éŠæˆ²
      loadReadingGame();
    }
    
    // æŠ½å¡
    function drawCard() {
      const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
      
      if (currentStars < 5) {
        alert('â­ æ˜Ÿæ˜Ÿä¸è¶³ï¼éœ€è¦5é¡†æ˜Ÿæ˜Ÿæ‰èƒ½æŠ½å¡ã€‚');
        return;
      }
      
      // æ‰£é™¤æ˜Ÿæ˜Ÿ
      if (typeof StarRewardSystem !== 'undefined') {
        StarRewardSystem.addStars(-5);
      } else {
        localStorage.setItem('totalStars', (currentStars - 5).toString());
      }
      
      // æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
      updateStarsDisplay();
      
      // æ’­æ”¾æŠ½å¡éŸ³æ•ˆ
      playSound('correct');
      
      // éš¨æ©Ÿé¸æ“‡å¡ç‰‡
      const cards = [
        'hello - ä½ å¥½',
        'world - ä¸–ç•Œ',
        'beautiful - ç¾éº—çš„',
        'amazing - é©šäººçš„',
        'wonderful - ç¾å¦™çš„',
        'excellent - å„ªç§€çš„',
        'fantastic - æ¥µå¥½çš„',
        'brilliant - è°æ˜çš„',
        'perfect - å®Œç¾çš„',
        'magnificent - å®å‰çš„'
      ];
      
      const randomCard = cards[Math.floor(Math.random() * cards.length)];
      
      // é¡¯ç¤ºæŠ½å¡çµæœ
      const resultDiv = document.getElementById('gacha-result');
      resultDiv.innerHTML = `
        <div style="color: #ffd700; font-size: 1.2rem; font-weight: bold;">
          ğŸ‰ æ­å–œç²å¾—ç¨€æœ‰å¡ç‰‡ï¼
        </div>
        <div style="color: #fff; font-size: 1rem; margin-top: 10px;">
          ${randomCard}
        </div>
      `;
      
      // æ›´æ–°å¡ç‰‡æ•¸é‡
      const currentCards = parseInt(document.getElementById('gacha-cards').textContent.split(': ')[1]) + 1;
      document.getElementById('gacha-cards').textContent = `å¡ç‰‡: ${currentCards}`;
      
      // æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
      document.getElementById('gacha-stars').textContent = `æ˜Ÿæ˜Ÿ: ${localStorage.getItem('totalStars') || '0'}`;
    }
    
    // é—œé–‰éŠæˆ²å°è©±æ¡†
    function closeGameDialog() {
      const dialog = document.querySelector('div[style*="position: fixed"]');
      if (dialog) {
        document.body.removeChild(dialog);
      }
    }

    // è¿”å›é¸æ“‡
    function backToSelection() {
      currentMode = '';
      document.querySelectorAll('.article-section').forEach(section => {
        section.classList.remove('active');
      });
    }

    // å„²å­˜é€²åº¦
    function saveProgress() {
      localStorage.setItem('articlePracticeProgress', JSON.stringify({
        progress: progress,
        completedExercises: completedExercises,
        completedReadingLevels: completedReadingLevels,

      }));
    }

    // è¼‰å…¥é€²åº¦
    function loadProgress() {
      const saved = localStorage.getItem('articlePracticeProgress');
      if (saved) {
        const data = JSON.parse(saved);
        progress = data.progress || 0;
        completedExercises = data.completedExercises || [];
        completedReadingLevels = data.completedReadingLevels || [];

        updateProgress();
      }
    }
    
    // è¨ˆç®—æ˜Ÿæ˜Ÿçå‹µ
    function calculateStarReward(isCorrect, answerTime, consecutiveCount, questionType) {
      if (!isCorrect) return 0;
      
      let baseReward = 1; // åŸºç¤çå‹µ
      
      // ç¿»è­¯ç·´ç¿’ç‰¹æ®Šçå‹µï¼šç­”å°ä¸€é¡Œç›´æ¥çµ¦5é¡†æ˜Ÿæ˜Ÿ
      if (questionType === 'translation') {
        return 5; // ç¿»è­¯ç·´ç¿’å›ºå®š5é¡†æ˜Ÿæ˜Ÿ
      }
      
      // æ™‚é–“çå‹µï¼šè¶Šå¿«ç­”å°çå‹µè¶Šå¤š
      if (answerTime <= 5) {
        baseReward += 2; // 5ç§’å…§ +2æ˜Ÿ
      } else if (answerTime <= 10) {
        baseReward += 1; // 10ç§’å…§ +1æ˜Ÿ
      }
      
      // é€£æ“Šçå‹µï¼šé€£çºŒç­”å°è¶Šå¤šçå‹µè¶Šå¤š
      if (consecutiveCount >= 5) {
        baseReward += 3; // 5é€£æ“Š +3æ˜Ÿ
      } else if (consecutiveCount >= 3) {
        baseReward += 2; // 3é€£æ“Š +2æ˜Ÿ
      } else if (consecutiveCount >= 2) {
        baseReward += 1; // 2é€£æ“Š +1æ˜Ÿ
      }
      
      // å•é¡Œé¡å‹çå‹µ
      if (questionType === 'quiz') {
        baseReward += 2; // æ¸¬é©—é¡Œé¡å¤–çå‹µ
      }
      
      return baseReward;
    }
    
    // é¡¯ç¤ºæ˜Ÿæ˜Ÿçå‹µå‹•ç•«
    function showStarReward(amount) {
      const rewardDiv = document.createElement('div');
      rewardDiv.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, rgba(255, 215, 0, 0.9), rgba(255, 170, 0, 0.9));
        color: #000;
        padding: 20px 30px;
        border-radius: 15px;
        font-size: 1.5rem;
        font-weight: bold;
        z-index: 1000;
        box-shadow: 0 0 30px #ffd700;
        animation: starRewardPop 3s cubic-bezier(.4,2,.6,1) forwards;
        font-family: 'Orbitron', 'Segoe UI', sans-serif;
      `;
      rewardDiv.innerHTML = `â­ +${amount} æ˜Ÿæ˜Ÿ â­`;
      
      // æ·»åŠ å‹•ç•«æ¨£å¼
      const style = document.createElement('style');
      style.textContent = `
        @keyframes starRewardPop {
          0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
          20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
          80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
          100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(rewardDiv);
      
      // 3ç§’å¾Œç§»é™¤
      setTimeout(() => {
        if (document.body.contains(rewardDiv)) {
          document.body.removeChild(rewardDiv);
        }
      }, 3000);
    }
    
    // æ’­æ”¾éŸ³æ•ˆ
    function playSound(soundName) {
      if (typeof SoundSystem !== 'undefined') {
        SoundSystem.play(soundName);
      }
    }
    
    // é¡¯ç¤ºçµ±è¨ˆä¿¡æ¯
    function showStatistics() {
      const stats = {
        completedReadingLevels: completedReadingLevels.length,
        completedExercises: completedExercises.length,
        totalProgress: Math.round(progress),
        totalStars: parseInt(localStorage.getItem('totalStars') || '0'),
        gameStats: gameStats
      };
      
      const statsText = `
ğŸ“Š ç·´ç¿’çµ±è¨ˆï¼š

ğŸ“– å·²å®Œæˆé–±è®€é—œå¡ï¼š${stats.completedReadingLevels} å€‹
âœ… å·²å®Œæˆç·´ç¿’æ¨¡å¼ï¼š${stats.completedExercises} å€‹
ğŸ“ˆ ç¸½é€²åº¦ï¼š${stats.totalProgress}%
â­ ç¸½æ˜Ÿæ˜Ÿæ•¸ï¼š${stats.totalStars} é¡†

ğŸ¯ éŠæˆ²çµ±è¨ˆï¼š
âœ… æ­£ç¢ºç­”æ¡ˆï¼š${stats.gameStats.correctAnswers} å€‹
ğŸ¯ å®Œç¾ç­”æ¡ˆï¼š${stats.gameStats.perfectAnswers} å€‹
â±ï¸ ç¸½ç”¨æ™‚ï¼š${Math.round(stats.gameStats.totalTimeUsed)} ç§’
      `;
      
      alert(statsText);
    }
    
    // é‡ç½®é€²åº¦
    function resetProgress() {
      if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰é€²åº¦å—ï¼Ÿé€™å°‡æ¸…é™¤æ‰€æœ‰ç·´ç¿’è¨˜éŒ„ï¼')) {
        completedExercises = [];
        completedReadingLevels = [];

        progress = 0;
        gameStats = {
          correctAnswers: 0,
          totalQuestions: 0,
          consecutiveCorrect: 0,
          startTime: Date.now(),
          perfectAnswers: 0,
          totalTimeUsed: 0
        };
        
        localStorage.removeItem('articlePracticeProgress');
        updateProgress();
        
        // é‡æ–°è¼‰å…¥é—œå¡
        loadReadingLevels();
        loadWritingTopic();
        
        alert('âœ… é€²åº¦å·²é‡ç½®ï¼');
      }
    }
    
    // éŸ³æ•ˆé–‹é—œ
    function toggleSound() {
      if (typeof SoundSystem !== 'undefined') {
        if (SoundSystem.bgm && SoundSystem.bgm.isPlaying) {
          SoundSystem.bgm.pause();
          alert('ğŸ”‡ éŸ³æ•ˆå·²é—œé–‰');
        } else {
          SoundSystem.bgm.play();
          alert('ğŸ”Š éŸ³æ•ˆå·²é–‹å•Ÿ');
        }
      } else {
        alert('éŸ³æ•ˆç³»çµ±æœªè¼‰å…¥');
      }
    }
    
    // æª¢æŸ¥ç­”æ¡ˆä¸¦çµ¦äºˆçå‹µ
    function checkAnswerWithReward(isCorrect, answerTime, questionType) {
      if (isCorrect) {
        gameStats.correctAnswers++;
        gameStats.consecutiveCorrect++;
        gameStats.totalTimeUsed += answerTime;
        
        // æª¢æŸ¥æ˜¯å¦ç‚ºå®Œç¾ç­”æ¡ˆï¼ˆ5ç§’å…§ç­”å°ï¼‰
        if (answerTime <= 5) {
          gameStats.perfectAnswers++;
        }
        
        // è¨ˆç®—æ˜Ÿæ˜Ÿçå‹µ
        const starsEarned = calculateStarReward(true, answerTime, gameStats.consecutiveCorrect, questionType);
        
        // çµ¦äºˆæ˜Ÿæ˜Ÿçå‹µ
        if (typeof StarRewardSystem !== 'undefined') {
          StarRewardSystem.addStars(starsEarned);
        } else {
          // å‚™ç”¨æ˜Ÿæ˜Ÿç³»çµ±
          const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
          const newStars = currentStars + starsEarned;
          localStorage.setItem('totalStars', newStars.toString());
        }
        
        // ç«‹å³æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
        updateStarsDisplay();
        
        // æ’­æ”¾æ­£ç¢ºéŸ³æ•ˆ
        playSound('correct');
        
        // é¡¯ç¤ºæ˜Ÿæ˜Ÿçå‹µå‹•ç•«
        showStarReward(starsEarned);
        
        return true;
      } else {
        gameStats.consecutiveCorrect = 0;
        playSound('wrong');
        return false;
      }
    }

    // æ˜Ÿæ˜Ÿé–ƒçˆå‹•ç•«
    const style = document.createElement('style');
    style.textContent = `
      @keyframes twinkle {
        0%, 100% { opacity: 0.3; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.2); }
      }
    `;
    document.head.appendChild(style);
    
    // æ–°å¢ï¼šæˆå°±æª¢æŸ¥å‡½æ•¸
    function checkReadingAchievements() {
      // æª¢æŸ¥é–±è®€é—œå¡ç›¸é—œæˆå°±
      const completedLevels = JSON.parse(localStorage.getItem('completedReadingLevels') || '[]');
      const perfectScores = JSON.parse(localStorage.getItem('readingPerfectScores') || '[]');
      const fastCompletions = JSON.parse(localStorage.getItem('readingFastCompletions') || '[]');
      const streakDays = parseInt(localStorage.getItem('readingStreakDays') || '0');
      const vocabCorrect = parseInt(localStorage.getItem('readingVocabCorrect') || '0');
      const comprehensionCorrect = parseInt(localStorage.getItem('readingComprehensionCorrect') || '0');
      const writingCompleted = parseInt(localStorage.getItem('readingWritingCompleted') || '0');
      const audioUsed = parseInt(localStorage.getItem('readingAudioUsed') || '0');
      const levelsUnlocked = parseInt(localStorage.getItem('readingLevelsUnlocked') || '0');
      
      // æª¢æŸ¥å„ç¨®æˆå°±ä¸¦è§¸ç™¼æˆå°±ç³»çµ±
      const achievements = [
        { id: 'reading_beginner', requirement: 1, reward: 10, icon: 'ğŸ“–', name: 'é–±è®€æ–°æ‰‹', description: 'å®Œæˆç¬¬ä¸€å€‹é–±è®€é—œå¡ï¼Œé–‹å§‹é–±è®€å­¸ç¿’ä¹‹æ—…' },
        { id: 'reading_regular', requirement: 5, reward: 25, icon: 'ğŸ“š', name: 'é–±è®€å¸¸å®¢', description: 'å®Œæˆ5å€‹é–±è®€é—œå¡ï¼Œå±•ç¾é–±è®€ç†±æƒ…' },
        { id: 'reading_expert', requirement: 10, reward: 50, icon: 'ğŸ“', name: 'é–±è®€å°ˆå®¶', description: 'å®Œæˆ10å€‹é–±è®€é—œå¡ï¼Œæˆç‚ºé–±è®€å°ˆå®¶' },
        { id: 'reading_master', requirement: 20, reward: 100, icon: 'ğŸ‘‘', name: 'é–±è®€å¤§å¸«', description: 'å®Œæˆ20å€‹é–±è®€é—œå¡ï¼Œæˆç‚ºé–±è®€å¤§å¸«' },
        { id: 'reading_legend', requirement: 30, reward: 200, icon: 'ğŸ†', name: 'é–±è®€å‚³å¥‡', description: 'å®Œæˆ30å€‹é–±è®€é—œå¡ï¼Œå‰µé€ é–±è®€å‚³å¥‡' },
        { id: 'reading_perfect', requirement: 1, reward: 30, icon: 'ğŸ’¯', name: 'å®Œç¾é–±è®€', description: 'åœ¨é–±è®€é—œå¡ä¸­ç²å¾—æ»¿åˆ†ï¼ˆç·´ç¿’å’Œæ¸¬é©—éƒ½100%ï¼‰' },
        { id: 'reading_speed', requirement: 5, reward: 25, icon: 'âš¡', name: 'å¿«é€Ÿé–±è®€', description: 'åœ¨5å€‹é–±è®€é—œå¡ä¸­å¹³å‡æ™‚é–“å°‘æ–¼10åˆ†é˜' },
        { id: 'reading_streak', requirement: 7, reward: 40, icon: 'ğŸ”¥', name: 'é€£çºŒé–±è®€', description: 'é€£çºŒ7å¤©å®Œæˆé–±è®€é—œå¡' },
        { id: 'reading_vocab', requirement: 100, reward: 60, icon: 'ğŸ“', name: 'è©å½™é–±è®€', description: 'åœ¨é–±è®€é—œå¡ä¸­ç­”å°100å€‹è©å½™å•é¡Œ' },
        { id: 'reading_comprehension', requirement: 50, reward: 80, icon: 'ğŸ§ ', name: 'ç†è§£å¤§å¸«', description: 'åœ¨é–±è®€æ¸¬é©—ä¸­ç­”å°50å€‹ç†è§£å•é¡Œ' },
        { id: 'reading_writing', requirement: 10, reward: 40, icon: 'âœï¸', name: 'å¯«ä½œç·´ç¿’', description: 'å®Œæˆ10æ¬¡å¯«ä½œç·´ç¿’ï¼Œæå‡è¡¨é”èƒ½åŠ›' },
        { id: 'reading_audio', requirement: 20, reward: 30, icon: 'ğŸ”Š', name: 'è½åŠ›ç·´ç¿’', description: 'ä½¿ç”¨20æ¬¡æ–‡ç« ç™¼éŸ³åŠŸèƒ½ï¼Œæå‡è½åŠ›ç†è§£' },
        { id: 'reading_unlock', requirement: 10, reward: 50, icon: 'ğŸ”“', name: 'é—œå¡è§£é–è€…', description: 'ä½¿ç”¨æ˜Ÿæ˜Ÿè§£é–10å€‹é–±è®€é—œå¡' },
        { id: 'reading_all', requirement: 1, reward: 300, icon: 'ğŸŒŸ', name: 'å…¨é—œå¡é€šé—œ', description: 'å®Œæˆæ‰€æœ‰é–±è®€é—œå¡ï¼Œé”åˆ°é–±è®€å­¸ç¿’çš„å·”å³°' }
      ];
      
      achievements.forEach(achievement => {
        let isUnlocked = false;
        
        // æ ¹æ“šæˆå°±é¡å‹æª¢æŸ¥æ˜¯å¦è§£é–
        switch (achievement.id) {
          case 'reading_beginner':
          case 'reading_regular':
          case 'reading_expert':
          case 'reading_master':
          case 'reading_legend':
            isUnlocked = completedLevels.length >= achievement.requirement;
            break;
          case 'reading_perfect':
            isUnlocked = perfectScores.length >= achievement.requirement;
            break;
          case 'reading_speed':
            isUnlocked = fastCompletions.length >= achievement.requirement;
            break;
          case 'reading_streak':
            isUnlocked = streakDays >= achievement.requirement;
            break;
          case 'reading_vocab':
            isUnlocked = vocabCorrect >= achievement.requirement;
            break;
          case 'reading_comprehension':
            isUnlocked = comprehensionCorrect >= achievement.requirement;
            break;
          case 'reading_writing':
            isUnlocked = writingCompleted >= achievement.requirement;
            break;
          case 'reading_audio':
            isUnlocked = audioUsed >= achievement.requirement;
            break;
          case 'reading_unlock':
            isUnlocked = levelsUnlocked >= achievement.requirement;
            break;
          case 'reading_all':
            isUnlocked = completedLevels.length >= 40; // å‡è¨­ç¸½å…±æœ‰40å€‹é—œå¡
            break;
        }
        
        // æª¢æŸ¥æ˜¯å¦å·²ç¶“é ˜å–éé€™å€‹æˆå°±
        const claimedAchievements = JSON.parse(localStorage.getItem('claimedAchievements') || '[]');
        if (isUnlocked && !claimedAchievements.includes(achievement.id)) {
          // è§¸ç™¼æˆå°±é”æˆäº‹ä»¶
          if (typeof showAchievementModal === 'function') {
            showAchievementModal(achievement, achievement.reward, parseInt(localStorage.getItem('totalStars') || '0'));
          }
        }
      });
    }
    
    // æ–°å¢ï¼šæ›´æ–°é€£çºŒé–±è®€å¤©æ•¸
    function updateReadingStreak() {
      const today = new Date().toDateString();
      const lastReadingDate = localStorage.getItem('lastReadingDate');
      const currentStreak = parseInt(localStorage.getItem('readingStreakDays') || '0');
      
      if (lastReadingDate === today) {
        // ä»Šå¤©å·²ç¶“é–±è®€éäº†
        return;
      }
      
      if (lastReadingDate === new Date(Date.now() - 24 * 60 * 60 * 1000).toDateString()) {
        // æ˜¨å¤©æœ‰é–±è®€ï¼Œé€£çºŒå¤©æ•¸+1
        localStorage.setItem('readingStreakDays', (currentStreak + 1).toString());
      } else {
        // é€£çºŒä¸­æ–·ï¼Œé‡ç½®ç‚º1
        localStorage.setItem('readingStreakDays', '1');
      }
      
      localStorage.setItem('lastReadingDate', today);
    }
    
    // æ–°å¢ï¼šè¨˜éŒ„è©å½™å•é¡Œç­”å°
    function recordVocabCorrect() {
      const current = parseInt(localStorage.getItem('readingVocabCorrect') || '0');
      localStorage.setItem('readingVocabCorrect', (current + 1).toString());
    }
    
    // æ–°å¢ï¼šè¨˜éŒ„ç†è§£å•é¡Œç­”å°
    function recordComprehensionCorrect() {
      const current = parseInt(localStorage.getItem('readingComprehensionCorrect') || '0');
      localStorage.setItem('readingComprehensionCorrect', (current + 1).toString());
    }
    
    // æª¢æŸ¥é–±è®€æˆå°±
    function checkReadingAchievements() {
      // ç²å–å„ç¨®çµ±è¨ˆæ•¸æ“š
      const completedLevels = completedReadingLevels.length;
      const perfectScores = JSON.parse(localStorage.getItem('readingPerfectScores') || '[]').length;
      const fastCompletions = JSON.parse(localStorage.getItem('readingFastCompletions') || '[]').length;
      const streakDays = parseInt(localStorage.getItem('readingStreakDays') || '0');
      const vocabCorrect = parseInt(localStorage.getItem('readingVocabCorrect') || '0');
      const comprehensionCorrect = parseInt(localStorage.getItem('readingComprehensionCorrect') || '0');
      const writingCompleted = parseInt(localStorage.getItem('readingWritingCompleted') || '0');
      const audioUsed = parseInt(localStorage.getItem('readingAudioUsed') || '0');
      const levelsUnlocked = parseInt(localStorage.getItem('readingLevelsUnlocked') || '0');
      
      // å®šç¾©æˆå°±åˆ—è¡¨
      const achievements = [
        { id: 'reading_beginner', requirement: 1, reward: 10, icon: 'ğŸ“š', name: 'é–±è®€æ–°æ‰‹', description: 'å®Œæˆç¬¬ä¸€å€‹é–±è®€é—œå¡ï¼Œé–‹å§‹é–±è®€å­¸ç¿’ä¹‹æ—…' },
        { id: 'reading_regular', requirement: 5, reward: 25, icon: 'ğŸ“–', name: 'é–±è®€å¸¸å®¢', description: 'å®Œæˆ5å€‹é–±è®€é—œå¡ï¼Œé¤Šæˆé–±è®€ç¿’æ…£' },
        { id: 'reading_expert', requirement: 10, reward: 50, icon: 'ğŸ“', name: 'é–±è®€å°ˆå®¶', description: 'å®Œæˆ10å€‹é–±è®€é—œå¡ï¼Œæˆç‚ºé–±è®€å°ˆå®¶' },
        { id: 'reading_master', requirement: 20, reward: 100, icon: 'ğŸ‘‘', name: 'é–±è®€å¤§å¸«', description: 'å®Œæˆ20å€‹é–±è®€é—œå¡ï¼Œæˆç‚ºé–±è®€å¤§å¸«' },
        { id: 'reading_legend', requirement: 30, reward: 200, icon: 'ğŸ†', name: 'é–±è®€å‚³å¥‡', description: 'å®Œæˆ30å€‹é–±è®€é—œå¡ï¼Œå‰µé€ é–±è®€å‚³å¥‡' },
        { id: 'reading_perfect', requirement: 1, reward: 30, icon: 'ğŸ’¯', name: 'å®Œç¾é–±è®€', description: 'åœ¨é–±è®€é—œå¡ä¸­ç²å¾—æ»¿åˆ†ï¼ˆç·´ç¿’å’Œæ¸¬é©—éƒ½100%ï¼‰' },
        { id: 'reading_speed', requirement: 5, reward: 25, icon: 'âš¡', name: 'å¿«é€Ÿé–±è®€', description: 'åœ¨5å€‹é–±è®€é—œå¡ä¸­å¹³å‡æ™‚é–“å°‘æ–¼10åˆ†é˜' },
        { id: 'reading_streak', requirement: 7, reward: 40, icon: 'ğŸ”¥', name: 'é€£çºŒé–±è®€', description: 'é€£çºŒ7å¤©å®Œæˆé–±è®€é—œå¡' },
        { id: 'reading_vocab', requirement: 100, reward: 60, icon: 'ğŸ“', name: 'è©å½™é–±è®€', description: 'åœ¨é–±è®€é—œå¡ä¸­ç­”å°100å€‹è©å½™å•é¡Œ' },
        { id: 'reading_comprehension', requirement: 50, reward: 80, icon: 'ğŸ§ ', name: 'ç†è§£å¤§å¸«', description: 'åœ¨é–±è®€æ¸¬é©—ä¸­ç­”å°50å€‹ç†è§£å•é¡Œ' },
        { id: 'reading_writing', requirement: 10, reward: 40, icon: 'âœï¸', name: 'å¯«ä½œç·´ç¿’', description: 'å®Œæˆ10æ¬¡å¯«ä½œç·´ç¿’ï¼Œæå‡è¡¨é”èƒ½åŠ›' },
        { id: 'reading_audio', requirement: 20, reward: 30, icon: 'ğŸ”Š', name: 'è½åŠ›ç·´ç¿’', description: 'ä½¿ç”¨20æ¬¡æ–‡ç« ç™¼éŸ³åŠŸèƒ½ï¼Œæå‡è½åŠ›ç†è§£' },
        { id: 'reading_unlock', requirement: 10, reward: 50, icon: 'ğŸ”“', name: 'é—œå¡è§£é–è€…', description: 'ä½¿ç”¨æ˜Ÿæ˜Ÿè§£é–10å€‹é–±è®€é—œå¡' },
        { id: 'reading_all', requirement: 1, reward: 300, icon: 'ğŸŒŸ', name: 'å…¨é—œå¡é€šé—œ', description: 'å®Œæˆæ‰€æœ‰é–±è®€é—œå¡ï¼Œé”åˆ°é–±è®€å­¸ç¿’çš„å·”å³°' }
      ];
      
      // æª¢æŸ¥æ¯å€‹æˆå°±
      achievements.forEach(achievement => {
        let isUnlocked = false;
        
        // æ ¹æ“šæˆå°±é¡å‹æª¢æŸ¥æ˜¯å¦è§£é–
        switch (achievement.id) {
          case 'reading_beginner':
          case 'reading_regular':
          case 'reading_expert':
          case 'reading_master':
          case 'reading_legend':
            isUnlocked = completedLevels >= achievement.requirement;
            break;
          case 'reading_perfect':
            isUnlocked = perfectScores >= achievement.requirement;
            break;
          case 'reading_speed':
            isUnlocked = fastCompletions >= achievement.requirement;
            break;
          case 'reading_streak':
            isUnlocked = streakDays >= achievement.requirement;
            break;
          case 'reading_vocab':
            isUnlocked = vocabCorrect >= achievement.requirement;
            break;
          case 'reading_comprehension':
            isUnlocked = comprehensionCorrect >= achievement.requirement;
            break;
          case 'reading_writing':
            isUnlocked = writingCompleted >= achievement.requirement;
            break;
          case 'reading_audio':
            isUnlocked = audioUsed >= achievement.requirement;
            break;
          case 'reading_unlock':
            isUnlocked = levelsUnlocked >= achievement.requirement;
            break;
          case 'reading_all':
            isUnlocked = completedLevels >= articleLevels.length; // å®Œæˆæ‰€æœ‰é—œå¡
            break;
        }
        
        // æª¢æŸ¥æ˜¯å¦å·²ç¶“é ˜å–éé€™å€‹æˆå°±
        const claimedAchievements = JSON.parse(localStorage.getItem('claimedAchievements') || '[]');
        if (isUnlocked && !claimedAchievements.includes(achievement.id)) {
          // è§¸ç™¼æˆå°±é”æˆäº‹ä»¶
          showReadingAchievementNotification(achievement);
        }
      });
    }
    
    // é¡¯ç¤ºé–±è®€æˆå°±é€šçŸ¥
    function showReadingAchievementNotification(achievement) {
      // å‰µå»ºæˆå°±é€šçŸ¥å½ˆçª—
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #ffd700, #ffed4e);
        color: #000;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 0 30px #ffd700;
        z-index: 10000;
        text-align: center;
        min-width: 300px;
        animation: achievementPop 0.8s cubic-bezier(.68, -0.55, .27, 1.55);
      `;
      
      notification.innerHTML = `
        <div style="font-size: 2rem; margin-bottom: 10px;">${achievement.icon}</div>
        <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 8px;">ğŸ† æˆå°±é”æˆï¼</div>
        <div style="font-size: 1.1rem; font-weight: bold; margin-bottom: 8px;">${achievement.name}</div>
        <div style="font-size: 0.9rem; margin-bottom: 15px;">${achievement.description}</div>
        <div style="font-size: 1rem; color: #ff6b6b; font-weight: bold;">çå‹µï¼š${achievement.reward} é¡†æ˜Ÿæ˜Ÿ</div>
        <div style="margin-top: 15px;">
          <button onclick="window.location.href='achievement.html'" style="
            background: linear-gradient(135deg, #00ffff, #a259ff);
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
            margin-right: 10px;
            cursor: pointer;
          ">æŸ¥çœ‹æˆå°±</button>
          <button onclick="this.parentElement.parentElement.remove()" style="
            background: #bbb;
            color: #222;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
          ">é—œé–‰</button>
        </div>
      `;
      
      // æ·»åŠ å‹•ç•«æ¨£å¼
      const style = document.createElement('style');
      style.textContent = `
        @keyframes achievementPop {
          0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
          50% { transform: translate(-50%, -50%) scale(1.1); }
          100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
      `;
      document.head.appendChild(style);
      
      // æ·»åŠ åˆ°é é¢
      document.body.appendChild(notification);
      
      // æ’­æ”¾æˆå°±éŸ³æ•ˆ
      playSound('correct');
      
      // æ·»åŠ æ˜Ÿæ˜Ÿçå‹µ
      if (typeof StarRewardSystem !== 'undefined') {
        StarRewardSystem.addStars(achievement.reward);
      } else {
        const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
        const newStars = currentStars + achievement.reward;
        localStorage.setItem('totalStars', newStars.toString());
      }
      
      // è¨˜éŒ„å·²é ˜å–çš„æˆå°±
      const claimedAchievements = JSON.parse(localStorage.getItem('claimedAchievements') || '[]');
      if (!claimedAchievements.includes(achievement.id)) {
        claimedAchievements.push(achievement.id);
        localStorage.setItem('claimedAchievements', JSON.stringify(claimedAchievements));
      }
      
      // 5ç§’å¾Œè‡ªå‹•é—œé–‰
      setTimeout(() => {
        if (notification.parentElement) {
          notification.remove();
        }
      }, 5000);
    }
    
    // æ–°å¢ï¼šè¨˜éŒ„ä½¿ç”¨ç™¼éŸ³åŠŸèƒ½
    function recordAudioUsage() {
      const current = parseInt(localStorage.getItem('readingAudioUsed') || '0');
      localStorage.setItem('readingAudioUsed', (current + 1).toString());
      checkReadingAchievements();
    }
    
    // æ–°å¢ï¼šè¨˜éŒ„é—œå¡è§£é–
    function recordLevelUnlock() {
      const current = parseInt(localStorage.getItem('readingLevelsUnlocked') || '0');
      localStorage.setItem('readingLevelsUnlocked', (current + 1).toString());
      checkReadingAchievements();
    }
    
    // æ–°å¢ï¼šè¨˜éŒ„é—œå¡é–‹å§‹æ™‚é–“
    function recordLevelStart(level) {
      localStorage.setItem(`level_${level}_start_time`, Date.now().toString());
    }
    
    // è§¸ç™¼æˆå°±ç³»çµ±é€£å‹•
    function triggerAchievementSystem(level) {
      // æª¢æŸ¥æ˜¯å¦ç‚ºé¦–æ¬¡é€šé—œ
      const completedLevels = JSON.parse(localStorage.getItem('completedReadingLevels') || '[]');
      const isFirstTimeCompletion = !completedLevels.includes(level);
      
      if (isFirstTimeCompletion) {
        // è¨˜éŒ„é—œå¡å®Œæˆ
        completedLevels.push(level);
        localStorage.setItem('completedReadingLevels', JSON.stringify(completedLevels));
        
        // æª¢æŸ¥æ˜¯å¦è§¸ç™¼æˆå°±
        checkAchievementTriggers(level);
        
        // é¡¯ç¤ºé€šé—œæˆå°±é€šçŸ¥
        showLevelCompletionAchievement(level);
      }
    }
    
    // æª¢æŸ¥æˆå°±è§¸ç™¼æ¢ä»¶
    function checkAchievementTriggers(level) {
      const completedLevels = JSON.parse(localStorage.getItem('completedReadingLevels') || '[]');
      const totalLevels = articleLevels.length;
      
      // æª¢æŸ¥å„ç¨®æˆå°±è§¸ç™¼æ¢ä»¶
      const achievements = [
        { id: 'reading_beginner', condition: completedLevels.length >= 1, reward: 10, icon: 'ğŸ“–', name: 'é–±è®€æ–°æ‰‹', description: 'å®Œæˆç¬¬ä¸€å€‹é–±è®€é—œå¡ï¼Œé–‹å§‹é–±è®€å­¸ç¿’ä¹‹æ—…' },
        { id: 'reading_regular', condition: completedLevels.length >= 5, reward: 25, icon: 'ğŸ“š', name: 'é–±è®€å¸¸å®¢', description: 'å®Œæˆ5å€‹é–±è®€é—œå¡ï¼Œå±•ç¾é–±è®€ç†±æƒ…' },
        { id: 'reading_expert', condition: completedLevels.length >= 10, reward: 50, icon: 'ğŸ“', name: 'é–±è®€å°ˆå®¶', description: 'å®Œæˆ10å€‹é–±è®€é—œå¡ï¼Œæˆç‚ºé–±è®€å°ˆå®¶' },
        { id: 'reading_master', condition: completedLevels.length >= 20, reward: 100, icon: 'ğŸ‘‘', name: 'é–±è®€å¤§å¸«', description: 'å®Œæˆ20å€‹é–±è®€é—œå¡ï¼Œæˆç‚ºé–±è®€å¤§å¸«' },
        { id: 'reading_legend', condition: completedLevels.length >= 30, reward: 200, icon: 'ğŸ†', name: 'é–±è®€å‚³å¥‡', description: 'å®Œæˆ30å€‹é–±è®€é—œå¡ï¼Œå‰µé€ é–±è®€å‚³å¥‡' },
        { id: 'reading_all', condition: completedLevels.length >= totalLevels, reward: 300, icon: 'ğŸŒŸ', name: 'å…¨é—œå¡é€šé—œ', description: 'å®Œæˆæ‰€æœ‰é–±è®€é—œå¡ï¼Œé”åˆ°é–±è®€å­¸ç¿’çš„å·”å³°' }
      ];
      
      // æª¢æŸ¥æ¯å€‹æˆå°±
      achievements.forEach(achievement => {
        if (achievement.condition) {
          // æª¢æŸ¥æ˜¯å¦å·²ç¶“é ˜å–éé€™å€‹æˆå°±
          const claimedAchievements = JSON.parse(localStorage.getItem('claimedAchievements') || '[]');
          if (!claimedAchievements.includes(achievement.id)) {
            // è§¸ç™¼æˆå°±é”æˆ
            triggerAchievementUnlock(achievement);
          }
        }
      });
    }
    
    // è§¸ç™¼æˆå°±è§£é–
    function triggerAchievementUnlock(achievement) {
      // è¨˜éŒ„å·²é ˜å–çš„æˆå°±
      const claimedAchievements = JSON.parse(localStorage.getItem('claimedAchievements') || '[]');
      if (!claimedAchievements.includes(achievement.id)) {
        claimedAchievements.push(achievement.id);
        localStorage.setItem('claimedAchievements', JSON.stringify(claimedAchievements));
        
        // çµ¦äºˆæˆå°±çå‹µ
        if (typeof StarRewardSystem !== 'undefined') {
          StarRewardSystem.addStars(achievement.reward);
        } else {
          const currentStars = parseInt(localStorage.getItem('totalStars') || '0');
          const newStars = currentStars + achievement.reward;
          localStorage.setItem('totalStars', newStars.toString());
        }
        
        // æ›´æ–°æ˜Ÿæ˜Ÿé¡¯ç¤º
        updateStarsDisplay();
        
        // é¡¯ç¤ºæˆå°±é€šçŸ¥
        showAchievementNotification(achievement);
      }
    }
    
    // é¡¯ç¤ºæˆå°±é€šçŸ¥
    function showAchievementNotification(achievement) {
      // å‰µå»ºæˆå°±é€šçŸ¥å½ˆçª—
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #ffd700, #ffed4e);
        color: #000;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 0 30px #ffd700;
        z-index: 10000;
        text-align: center;
        min-width: 300px;
        animation: achievementPop 0.8s cubic-bezier(.68, -0.55, .27, 1.55);
      `;
      
      notification.innerHTML = `
        <div style="font-size: 2rem; margin-bottom: 10px;">${achievement.icon}</div>
        <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 8px;">ğŸ† æˆå°±é”æˆï¼</div>
        <div style="font-size: 1.1rem; font-weight: bold; margin-bottom: 8px;">${achievement.name}</div>
        <div style="font-size: 0.9rem; margin-bottom: 15px;">${achievement.description}</div>
        <div style="font-size: 1rem; color: #ff6b6b; font-weight: bold;">çå‹µï¼š${achievement.reward} é¡†æ˜Ÿæ˜Ÿ</div>
        <div style="margin-top: 15px;">
          <button onclick="window.location.href='achievement.html'" style="
            background: linear-gradient(135deg, #00ffff, #a259ff);
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
            margin-right: 10px;
            cursor: pointer;
          ">æŸ¥çœ‹æˆå°±</button>
          <button onclick="this.parentElement.parentElement.remove()" style="
            background: #bbb;
            color: #222;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
          ">é—œé–‰</button>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // æ’­æ”¾æˆå°±éŸ³æ•ˆ
      playSound('correct');
      
      // 5ç§’å¾Œè‡ªå‹•ç§»é™¤
      setTimeout(() => {
        if (document.body.contains(notification)) {
          document.body.removeChild(notification);
        }
      }, 5000);
    }
    
    // é¡¯ç¤ºé—œå¡é€šé—œæˆå°±
    function showLevelCompletionAchievement(level) {
      const levelData = articleLevels[level - 1];
      if (!levelData) return;
      
      // å‰µå»ºé€šé—œé€šçŸ¥
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(135deg, #00ffff, #a259ff);
        color: #000;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 0 30px #00ffff;
        z-index: 10000;
        text-align: center;
        min-width: 300px;
        animation: levelCompletionPop 0.8s cubic-bezier(.68, -0.55, .27, 1.55);
      `;
      
      notification.innerHTML = `
        <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ‰</div>
        <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 8px;">é—œå¡é€šé—œï¼</div>
        <div style="font-size: 1.1rem; font-weight: bold; margin-bottom: 8px;">ç¬¬ ${level} é—œï¼š${levelData.title}</div>
        <div style="font-size: 0.9rem; margin-bottom: 15px;">æ­å–œå®Œæˆæ­¤é—œå¡ï¼</div>
        <div style="font-size: 1rem; color: #ff6b6b; font-weight: bold;">çå‹µï¼š10 é¡†æ˜Ÿæ˜Ÿ</div>
        <div style="margin-top: 15px;">
          <button onclick="window.location.href='achievement.html'" style="
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
            margin-right: 10px;
            cursor: pointer;
          ">æŸ¥çœ‹æˆå°±</button>
          <button onclick="this.parentElement.parentElement.remove()" style="
            background: #bbb;
            color: #222;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
          ">é—œé–‰</button>
        </div>
      `;
      
      // æ·»åŠ å‹•ç•«æ¨£å¼
      const style = document.createElement('style');
      style.textContent = `
        @keyframes levelCompletionPop {
          0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
          20% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
          80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
          100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
      `;
      document.head.appendChild(style);
      
      document.body.appendChild(notification);
      
      // æ’­æ”¾é€šé—œéŸ³æ•ˆ
      playSound('complete');
      
      // 5ç§’å¾Œè‡ªå‹•ç§»é™¤
      setTimeout(() => {
        if (document.body.contains(notification)) {
          document.body.removeChild(notification);
        }
      }, 5000);
    }
    
    // æ–°å¢ï¼šæª¢æŸ¥æ–‡ç« ç·´ç¿’é—œå¡é€šé—œæˆå°±
    function checkArticleLevelAchievements(level, practiceAccuracy, quizScore) {
      const claimedAchievements = JSON.parse(localStorage.getItem('claimedAchievements') || '[]');
      
      // æª¢æŸ¥é—œå¡é€šé—œæˆå°± - 40å€‹é—œå¡éƒ½å¯ä»¥é ˜å–
      const levelAchievements = [
        { id: 'article_level_1', name: 'æ–‡ç« ç·´ç¿’åˆå­¸è€…', reward: 30, icon: 'ğŸ“–', description: 'é€šéç¬¬1å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œé–‹å§‹é–±è®€ä¹‹æ—…' },
        { id: 'article_level_2', name: 'æ–‡ç« ç·´ç¿’é€²éšè€…', reward: 50, icon: 'ğŸ“š', description: 'é€šéç¬¬2å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œå±•ç¾å­¸ç¿’ç†±æƒ…' },
        { id: 'article_level_3', name: 'æ–‡ç« ç·´ç¿’å°ˆå®¶', reward: 80, icon: 'ğŸ“', description: 'é€šéç¬¬3å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œæˆç‚ºé–±è®€å°ˆå®¶' },
        { id: 'article_level_4', name: 'æ–‡ç« ç·´ç¿’å¤§å¸«', reward: 120, icon: 'ğŸ‘‘', description: 'é€šéç¬¬4å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œæˆç‚ºé–±è®€å¤§å¸«' },
        { id: 'article_level_5', name: 'æ–‡ç« ç·´ç¿’ç‹è€…', reward: 150, icon: 'ğŸ†', description: 'é€šéç¬¬5å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œæˆç‚ºé–±è®€ç‹è€…' },
        { id: 'article_level_6', name: 'æ–‡ç« ç·´ç¿’å‚³å¥‡', reward: 200, icon: 'ğŸŒŸ', description: 'é€šéç¬¬6å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œå‰µé€ é–±è®€å‚³å¥‡' },
        { id: 'article_level_7', name: 'æ–‡ç« ç·´ç¿’ç¥è©±', reward: 250, icon: 'ğŸ’', description: 'é€šéç¬¬7å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œé”åˆ°ç¥è©±å¢ƒç•Œ' },
        { id: 'article_level_8', name: 'æ–‡ç« ç·´ç¿’è‡³å°Š', reward: 300, icon: 'ğŸ‘‘', description: 'é€šéç¬¬8å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œæˆç‚ºé–±è®€è‡³å°Š' },
        { id: 'article_level_9', name: 'æ–‡ç« ç·´ç¿’è–è€…', reward: 350, icon: 'âœ¨', description: 'é€šéç¬¬9å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œæˆç‚ºé–±è®€è–è€…' },
        { id: 'article_level_10', name: 'æ–‡ç« ç·´ç¿’ç¥éˆ', reward: 400, icon: 'ğŸ”®', description: 'é€šéç¬¬10å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼ŒåŒ–èº«é–±è®€ç¥éˆ' },
        { id: 'article_level_11', name: 'æ–‡ç« ç·´ç¿’æ˜Ÿè¾°', reward: 450, icon: 'â­', description: 'é€šéç¬¬11å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œå¦‚æ˜Ÿè¾°èˆ¬é–ƒè€€' },
        { id: 'article_level_12', name: 'æ–‡ç« ç·´ç¿’éŠ€æ²³', reward: 500, icon: 'ğŸŒŒ', description: 'é€šéç¬¬12å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œè·¨è¶ŠéŠ€æ²³ç•Œé™' },
        { id: 'article_level_13', name: 'æ–‡ç« ç·´ç¿’å®‡å®™', reward: 550, icon: 'ğŸŒ', description: 'é€šéç¬¬13å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œæ¢ç´¢å®‡å®™å¥§ç§˜' },
        { id: 'article_level_14', name: 'æ–‡ç« ç·´ç¿’æ™‚ç©º', reward: 600, icon: 'â°', description: 'é€šéç¬¬14å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼ŒæŒæ§æ™‚ç©ºä¹‹åŠ›' },
        { id: 'article_level_15', name: 'æ–‡ç« ç·´ç¿’ç¶­åº¦', reward: 650, icon: 'ğŸ”²', description: 'é€šéç¬¬15å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œçªç ´ç¶­åº¦å£å£˜' },
        { id: 'article_level_16', name: 'æ–‡ç« ç·´ç¿’æ¬¡å…ƒ', reward: 700, icon: 'ğŸŒ€', description: 'é€šéç¬¬16å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œç©¿æ¢­æ¬¡å…ƒä¹‹é–“' },
        { id: 'article_level_17', name: 'æ–‡ç« ç·´ç¿’è™›ç©º', reward: 750, icon: 'âš«', description: 'é€šéç¬¬17å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œå¾æœè™›ç©ºæ·±æ·µ' },
        { id: 'article_level_18', name: 'æ–‡ç« ç·´ç¿’æ··æ²Œ', reward: 800, icon: 'ğŸŒªï¸', description: 'é€šéç¬¬18å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œé§•é¦­æ··æ²Œä¹‹åŠ›' },
        { id: 'article_level_19', name: 'æ–‡ç« ç·´ç¿’ç§©åº', reward: 850, icon: 'âš–ï¸', description: 'é€šéç¬¬19å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œå»ºç«‹ç§©åºæ³•å‰‡' },
        { id: 'article_level_20', name: 'æ–‡ç« ç·´ç¿’å¹³è¡¡', reward: 900, icon: 'âš–ï¸', description: 'é€šéç¬¬20å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼ŒæŒæ¡å¹³è¡¡ä¹‹é“' },
        { id: 'article_level_21', name: 'æ–‡ç« ç·´ç¿’æ™ºæ…§', reward: 950, icon: 'ğŸ§ ', description: 'é€šéç¬¬21å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œç²å¾—ç„¡ä¸Šæ™ºæ…§' },
        { id: 'article_level_22', name: 'æ–‡ç« ç·´ç¿’çŸ¥è­˜', reward: 1000, icon: 'ğŸ“š', description: 'é€šéç¬¬22å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œç©ç´¯æµ©ç€šçŸ¥è­˜' },
        { id: 'article_level_23', name: 'æ–‡ç« ç·´ç¿’çœŸç†', reward: 1050, icon: 'ğŸ’¡', description: 'é€šéç¬¬23å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œé ˜æ‚ŸçœŸç†å¥§ç¾©' },
        { id: 'article_level_24', name: 'æ–‡ç« ç·´ç¿’å•Ÿç¤º', reward: 1100, icon: 'âœ¨', description: 'é€šéç¬¬24å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œç²å¾—ç¥è–å•Ÿç¤º' },
        { id: 'article_level_25', name: 'æ–‡ç« ç·´ç¿’è¦ºé†’', reward: 1150, icon: 'ğŸ‘ï¸', description: 'é€šéç¬¬25å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œè¦ºé†’å…§åœ¨æ½›èƒ½' },
        { id: 'article_level_26', name: 'æ–‡ç« ç·´ç¿’è¶…è¶Š', reward: 1200, icon: 'ğŸš€', description: 'é€šéç¬¬26å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œè¶…è¶Šè‡ªæˆ‘æ¥µé™' },
        { id: 'article_level_27', name: 'æ–‡ç« ç·´ç¿’æ˜‡è¯', reward: 1250, icon: 'â¬†ï¸', description: 'é€šéç¬¬27å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œéˆé­‚å¾—åˆ°æ˜‡è¯' },
        { id: 'article_level_28', name: 'æ–‡ç« ç·´ç¿’æ¶…æ§ƒ', reward: 1300, icon: 'ğŸ”¥', description: 'é€šéç¬¬28å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œç¶“æ­·æ¶…æ§ƒé‡ç”Ÿ' },
        { id: 'article_level_29', name: 'æ–‡ç« ç·´ç¿’æ°¸æ†', reward: 1350, icon: 'â™¾ï¸', description: 'é€šéç¬¬29å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œè§¸æ‘¸æ°¸æ†ä¹‹é–€' },
        { id: 'article_level_30', name: 'æ–‡ç« ç·´ç¿’ä¸æœ½', reward: 1400, icon: 'ğŸ’', description: 'é€šéç¬¬30å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œæˆå°±ä¸æœ½å‚³å¥‡' },
        { id: 'article_level_31', name: 'æ–‡ç« ç·´ç¿’ç¥è©±', reward: 1450, icon: 'ğŸ›ï¸', description: 'é€šéç¬¬31å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œæ›¸å¯«ç¥è©±ç¯‡ç« ' },
        { id: 'article_level_32', name: 'æ–‡ç« ç·´ç¿’å‚³èªª', reward: 1500, icon: 'ğŸ“–', description: 'é€šéç¬¬32å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œæˆç‚ºå‚³èªªå­˜åœ¨' },
        { id: 'article_level_33', name: 'æ–‡ç« ç·´ç¿’å²è©©', reward: 1550, icon: 'ğŸ“œ', description: 'é€šéç¬¬33å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œå‰µé€ å²è©©ç¯‡ç« ' },
        { id: 'article_level_34', name: 'æ–‡ç« ç·´ç¿’ç¥è–', reward: 1600, icon: 'ğŸ‘¼', description: 'é€šéç¬¬34å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œç²å¾—ç¥è–ç¥ç¦' },
        { id: 'article_level_35', name: 'æ–‡ç« ç·´ç¿’å¤©é¸', reward: 1650, icon: 'ğŸ‘‘', description: 'é€šéç¬¬35å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œæˆç‚ºå¤©é¸ä¹‹äºº' },
        { id: 'article_level_36', name: 'æ–‡ç« ç·´ç¿’å‘½é‹', reward: 1700, icon: 'ğŸ²', description: 'é€šéç¬¬36å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼ŒæŒæ§å‘½é‹ä¹‹è¼ª' },
        { id: 'article_level_37', name: 'æ–‡ç« ç·´ç¿’å› æœ', reward: 1750, icon: 'ğŸ”—', description: 'é€šéç¬¬37å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œåƒé€å› æœå¥§ç§˜' },
        { id: 'article_level_38', name: 'æ–‡ç« ç·´ç¿’è¼ªè¿´', reward: 1800, icon: 'ğŸ”„', description: 'é€šéç¬¬38å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œè¶…è„«è¼ªè¿´æŸç¸›' },
        { id: 'article_level_39', name: 'æ–‡ç« ç·´ç¿’çµ‚æ¥µ', reward: 1850, icon: 'âš¡', description: 'é€šéç¬¬39å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œé”åˆ°çµ‚æ¥µå¢ƒç•Œ' },
        { id: 'article_level_40', name: 'æ–‡ç« ç·´ç¿’ç„¡ä¸Š', reward: 2000, icon: 'ğŸ‘‘', description: 'é€šéç¬¬40å€‹æ–‡ç« ç·´ç¿’é—œå¡ï¼Œæˆå°±ç„¡ä¸Šè‡³å°Š' }
      ];
      
      // æª¢æŸ¥ç•¶å‰é—œå¡çš„æˆå°±
      const currentLevelAchievement = levelAchievements[level - 1];
      if (currentLevelAchievement && !claimedAchievements.includes(currentLevelAchievement.id)) {
        showReadingAchievementNotification({
          id: currentLevelAchievement.id,
          reward: currentLevelAchievement.reward,
          icon: currentLevelAchievement.icon,
          name: currentLevelAchievement.name,
          description: currentLevelAchievement.description
        });
      }
      
      // æª¢æŸ¥æ»¿åˆ†æˆå°±
      if (practiceAccuracy === 100 && quizScore === 100 && !claimedAchievements.includes('article_perfect_score')) {
        showReadingAchievementNotification({
          id: 'article_perfect_score',
          reward: 100,
          icon: 'ğŸ’¯',
          name: 'å®Œç¾é–±è®€è€…',
          description: 'åœ¨æ–‡ç« ç·´ç¿’ä¸­ç²å¾—æ»¿åˆ†ï¼Œå±•ç¾å“è¶Šçš„é–±è®€èƒ½åŠ›'
        });
      }
    }
  </script>
</body>
</html> 
