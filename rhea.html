<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>å¡«ç©ºæŒ‘æˆ° - è‹±æ‰“å°è‹±é›„</title>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />
<style>
  :root{--gold:#ffd700;--cyan:#00ffff;--panel:rgba(30,30,40,.97);--glass:rgba(30,30,40,.92)}
  *{box-sizing:border-box} html,body{margin:0;padding:0;overflow-x:hidden}
  body{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px;
       font-family:'Segoe UI',Arial,sans-serif,'Orbitron',sans-serif;color:#fff;
       background:linear-gradient(135deg,#232526 0%,#414345 100%)}
  h1{margin:60px 0 20px;color:var(--gold);text-shadow:0 0 8px var(--gold);letter-spacing:2px;font:700 2.2rem Orbitron,Arial,sans-serif}
  .top-btns{position:fixed;top:20px;right:20px;display:flex;gap:8px;z-index:11}
  .top-btns button,button{cursor:pointer;border:0;border-radius:12px;box-shadow:0 2px 8px #0003;transition:.2s;background:var(--gold);color:#000}
  .top-btns button{padding:6px 12px;font:1rem Orbitron,Arial,sans-serif}
  button{padding:10px 26px;font:1rem Orbitron,Arial,sans-serif}
  #submit-btn{background:var(--gold);color:#111} #skip-btn{background:#bbb;color:#222} #next-btn{background:#4caf50;color:#fff}
  #speak-btn{background:#0ff;color:#111;margin-top:10px}
  #submit-btn:disabled,#speak-btn:disabled{background:#555;color:#888;cursor:not-allowed}
  #skip-btn:hover{background:#ccc} #next-btn:hover{background:#6fdc7f} .top-btns button:hover{background:#ffe54f}
  #bgMusicControl{position:fixed;right:20px;bottom:20px;width:50px;height:50px;border-radius:50%;font-size:1.5rem;
                  display:flex;align-items:center;justify-content:center;background:rgba(255,215,0,.9);box-shadow:0 0 12px rgba(255,215,0,.4);z-index:12}
  #bgMusicControl:hover{transform:scale(1.1);box-shadow:0 0 20px rgba(255,215,0,.6)} #bgMusicControl.paused{background:rgba(255,255,255,.3);color:#fff}
  #starsDisplay{position:fixed;top:20px;left:20px;background:rgba(10,20,40,.85);border:2px solid var(--cyan);box-shadow:0 0 12px var(--gold),0 0 32px var(--cyan);
                color:var(--gold);padding:8px 14px;border-radius:10px;font-weight:bold;z-index:10}
  #star-counter{display:flex;gap:18px;align-items:center;justify-content:center;background:var(--glass);border:1.5px solid #ffd70044;border-radius:18px;
                padding:14px 32px;margin:0 0 18px;color:var(--gold);min-width:260px;font:1.18rem Orbitron,Arial,sans-serif}
  #timer{font-size:1.1rem;margin-bottom:16px} .hidden{display:none}
  #question-container{background:var(--panel);border:1.5px solid #ffd70044;border-radius:22px;box-shadow:0 8px 32px rgba(31,38,135,.37);
                      padding:38px 30px 30px;max-width:440px;width:100%;margin:auto;display:flex;flex-direction:column;align-items:center}
  .question-title{font-size:1.1rem;margin-bottom:8px;letter-spacing:1px}
  .question-sentence{font-size:1.6rem;font-weight:700;margin:10px 0 20px;line-height:1.5;word-break:break-word}
  .blank{color:#0ff;background:#fff2;border-radius:8px;padding:2px 16px;box-shadow:0 1px 4px #0ff2}
  .question-zh{color:var(--gold);margin-bottom:16px;font-size:1.05rem}
  input{width:92%;padding:14px;font-size:1.1rem;border:2px solid var(--gold);border-radius:14px;background:#222;color:#fff;margin-bottom:18px;outline:0}
  input:focus{border-color:var(--cyan)} .btn-row{display:flex;gap:20px;justify-content:center;margin-bottom:10px;width:100%}
  #feedback{min-height:28px;margin-top:10px;font-size:1.05rem}
  .feedback-box{display:inline-block;padding:10px 22px;border-radius:16px;font-weight:700;box-shadow:0 2px 16px #0004;margin-top:8px;animation:pf .7s cubic-bezier(.68,-.55,.27,1.55)}
  .feedback-correct{background:linear-gradient(90deg,#2ecc40,#bfff00);color:#222} .feedback-wrong{background:linear-gradient(90deg,#ff4f4f,#ffbaba);color:#fff}
  .feedback-bonus{color:var(--gold);animation:bflash 1s infinite alternate;font-size:1.15em}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.8);display:flex;align-items:center;justify-content:center;z-index:1000;backdrop-filter:blur(4px)}
  .modal-content{background:rgba(30,30,40,.95);border:2px solid var(--gold);border-radius:20px;padding:32px;text-align:center;max-width:500px;width:90%;
                 box-shadow:0 0 32px #ffd70044,0 0 80px #00ffff22 inset;animation:mp .5s cubic-bezier(.68,-.55,.27,1.55)}
  .end-icon{font-size:3.2rem;margin-bottom:14px;animation:tada 1.2s infinite}
  .end-buttons{display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
  @keyframes pf{0%{transform:scale(.7);opacity:0}60%{transform:scale(1.12);opacity:1}100%{transform:scale(1)}}
  @keyframes mp{0%{transform:scale(.7);opacity:0}60%{transform:scale(1.1);opacity:1}100%{transform:scale(1)}}
  @keyframes bflash{0%{text-shadow:0 0 8px var(--gold)}100%{text-shadow:0 0 24px #fff700}}
  @keyframes tada{0%{transform:scale(1)}10%,20%{transform:scale(.9) rotate(-3deg)}30%,50%,70%,90%{transform:scale(1.1) rotate(3deg)}40%,60%,80%{transform:scale(1.1) rotate(-3deg)}100%{transform:scale(1)}}
  @media (max-width:768px){.top-btns{top:10px;right:10px;flex-wrap:wrap}.top-btns button{font-size:.9rem;padding:4px 8px}
    #starsDisplay{top:10px;left:10px;font-size:1rem;padding:6px 10px} h1{font-size:1.8rem;margin-top:60px}
    #question-container{max-width:95vw;padding:20px 15px;margin:10px auto}.question-sentence{font-size:1.3rem}
    .modal-content{max-width:95vw;padding:20px}}
  @media (max-width:480px){h1{font-size:1.5rem;margin-top:10px}.btn-row{flex-direction:column}.btn-row button{width:100%}}
</style>
</head>
<body>
  <button id="bgMusicControl" title="èƒŒæ™¯éŸ³æ¨‚æ§åˆ¶">ğŸµ</button>

  <div id="starsDisplay">â­<span id="totalStarsCount">0</span></div>

  <div class="top-btns">
    <button onclick="location.href='atlas.html?tab=greek'">ğŸ  å›é¦–é </button>
    <button onclick="resetProgress()">ğŸ”„ é‡æ–°é–‹å§‹</button>
    <button onclick="showReviewModal()">ğŸ“š è¤‡ç¿’å–®å­—</button>
  </div>

  <h1>ç‘äº Rhea - å¡«ç©ºæŒ‘æˆ°</h1>

  <div id="sessionStarsDisplay" style="margin-bottom:10px;color:#ffd700;font-weight:bold;font-size:1.02rem;">æœ¬æ¬¡å·²ç²å¾— 0 é¡†æ˜Ÿæ˜Ÿ</div>

  <div id="star-counter">ç¬¬ <span id="current-index">0</span> / <span id="total-questions">0</span> é¡Œ</div>

  <div id="timer" class="hidden">â³ å€’æ•¸ï¼š<span id="time-left">0</span> ç§’</div>

  <div id="question-container"></div>

  <!-- éŠæˆ²çµæŸ -->
  <div id="gameEndModal" class="modal" style="display:none">
    <div class="modal-content">
      <div class="end-icon">ğŸ‰</div>
      <h2 style="color:#ffd700;text-shadow:0 0 12px #ffd700">éŠæˆ²å®Œæˆï¼</h2>
      <div class="end-stats">
        <p>â­ æœ¬æ¬¡ç²å¾—æ˜Ÿæ˜Ÿï¼š<b id="endSessionStars">0</b></p>
        <p>âœ… ç­”å°é¡Œæ•¸ï¼š<b id="endCorrectCount">0</b></p>
        <p>âŒ ç­”éŒ¯é¡Œæ•¸ï¼š<b id="endWrongCount">0</b></p>
        <p>â­ ç´¯ç©ç¸½æ˜Ÿæ˜Ÿï¼š<b id="endTotalStars">0</b></p>
      </div>
      <div class="end-buttons">
        <button onclick="restartGame()">ğŸ”„ é‡æ–°é–‹å§‹</button>
        <button onclick="location.href='atlas.html?tab=greek'">ğŸ  è¿”å›é¦–é </button>
      </div>
    </div>
  </div>

  <!-- è¤‡ç¿’å–®å­— -->
  <div id="reviewModal" class="modal" style="display:none">
    <div class="modal-content">
      <div class="end-icon">ğŸ“š</div>
      <h2 style="color:#ffd700">å–®å­—è¤‡ç¿’</h2>
      <div style="margin-bottom:12px">
        <label for="categoryFilter" style="color:#ffd700;font-weight:700;margin-right:8px">é¸æ“‡åˆ†é¡ï¼š</label>
        <select id="categoryFilter" style="background:#222;color:#fff;border:2px solid #ffd700;border-radius:8px;padding:6px 10px">
          <option value="all">å…¨éƒ¨å–®å­—</option>
        </select>
      </div>
      <div id="vocabStats" style="background:rgba(255,215,0,.1);border:1px solid #ffd700;border-radius:8px;padding:8px;color:#ffd700;font-size:.9rem">
        ç¸½å…± <span id="totalVocabCount">0</span> å€‹å–®å­—
        <button onclick="showVocabStats()" style="background:#0ff;color:#000;border:none;border-radius:6px;padding:4px 8px;font-size:.8rem;margin-left:8px">ğŸ“Š è©³ç´°çµ±è¨ˆ</button>
        <button onclick="exportVocabData()" style="background:#4caf50;color:#fff;border:none;border-radius:6px;padding:4px 8px;font-size:.8rem;margin-left:4px">ğŸ“¥ åŒ¯å‡ºå­—åº«</button>
      </div>
      <div id="reviewWordsContainer" style="max-height:400px;overflow-y:auto;margin:14px 0"></div>
      <div class="end-buttons"><button onclick="closeReviewModal()">é—œé–‰</button></div>
    </div>
  </div>

  <audio id="backgroundMusic" loop>
    <source src="sound/åˆå¾Œæ”¾é¬†æ™‚å…‰ï¼ˆç´”éŸ³æ¨‚ï¼‰.mp3" type="audio/mpeg">
  </audio>

<script>
/* ===================== è¨­å®š & å°å·¥å…· ===================== */
const $ = s => document.querySelector(s);
const GAME = { QUESTIONS_COUNT: 20, TIME_LIMIT: 30, MAX_ATTEMPTS: 3 };
const SOUNDS = { correct:new Audio('sound/correct.mp3'), wrong:new Audio('sound/wrong.mp3'), type:new Audio('sound/type.mp3') };
const speakSys = { voice:null };
const state = { data:[], i:0, tries:0, answered:false, timer:null, log:[], sessionStars:0 };
const esc = s => s.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
const safeBlank = (sent, ans) => { try{ return sent.replace(new RegExp(esc(ans),'i'),'___'); }catch{ const L=sent.toLowerCase(),t=ans.toLowerCase(),i=L.indexOf(t); return i>=0?sent.slice(0,i)+'___'+sent.slice(i+ans.length):sent; } };
const say = (t,rate=1,cb)=>{ if(!speechSynthesis) return; const u=new SpeechSynthesisUtterance(t); u.lang='en-US'; u.rate=rate; u.pitch=1.12; if(speakSys.voice) u.voice=speakSys.voice; if(cb) u.onend=cb; speechSynthesis.cancel(); speechSynthesis.speak(u); };

/* ===================== é¡Œåº«ï¼ˆç¤ºä¾‹ 60 ç­†ï¼Œå¯è‡ªè¡Œå†åŠ ï¼‰ ===================== */
const VOCAB_DATA = [
  {"word":"second","zh":"ç¬¬äºŒï¼›ç§’","en_sentence":"This is the second time I've met him.","zh_sentence":"é€™æ˜¯æˆ‘ç¬¬äºŒæ¬¡è¦‹åˆ°ä»–ã€‚","category":"åºæ•¸/æ™‚é–“"},
  {"word":"third","zh":"ç¬¬ä¸‰","en_sentence":"She won the third prize in the race.","zh_sentence":"å¥¹åœ¨æ¯”è³½ä¸­è´å¾—äº†ç¬¬ä¸‰åã€‚","category":"åºæ•¸"},
  {"word":"money","zh":"é‡‘éŒ¢","en_sentence":"I need some money to buy a new book.","zh_sentence":"æˆ‘éœ€è¦ä¸€äº›éŒ¢è²·ä¸€æœ¬æ–°æ›¸ã€‚","category":"åè©/é‡‘éŒ¢"},
  {"word":"Mother's Day","zh":"æ¯è¦ªç¯€","en_sentence":"We always give Mom flowers on Mother's Day.","zh_sentence":"æˆ‘å€‘ç¸½æ˜¯åœ¨æ¯è¦ªç¯€é€èŠ±çµ¦åª½åª½ã€‚","category":"ç¯€æ—¥/æ´»å‹•"},
  {"word":"idea","zh":"ä¸»æ„ï¼›æƒ³æ³•","en_sentence":"That's a great idea for a party theme.","zh_sentence":"é‚£æ˜¯ä¸€å€‹å¾ˆæ£’çš„æ´¾å°ä¸»é¡Œé»å­ã€‚","category":"æŠ½è±¡åè©"},
  {"word":"because","zh":"å› ç‚º","en_sentence":"I'm happy because it's Friday.","zh_sentence":"æˆ‘å¾ˆé–‹å¿ƒï¼Œå› ç‚ºä»Šå¤©æ˜¯æ˜ŸæœŸäº”ã€‚","category":"é€£æ¥è©"},
  {"word":"drawer","zh":"æŠ½å±œ","en_sentence":"Keep your socks in the bottom drawer.","zh_sentence":"æŠŠä½ çš„è¥ªå­æ”¾åœ¨æœ€ä¸‹é¢çš„æŠ½å±œè£¡ã€‚","category":"å®¶å±…/ç‰©å“"},
  {"word":"bath","zh":"æ´—æ¾¡","en_sentence":"I like to take a warm bath before bed.","zh_sentence":"æˆ‘å–œæ­¡åœ¨ç¡å‰æ´—å€‹ç†±æ°´æ¾¡ã€‚","category":"æ´»å‹•/åè©"},
  {"word":"cow","zh":"æ¯ç‰›","en_sentence":"The cow is grazing in the field.","zh_sentence":"æ¯ç‰›æ­£åœ¨ç”°é‡è£¡åƒè‰ã€‚","category":"å‹•ç‰©/åè©"},
  {"word":"market","zh":"å¸‚å ´","en_sentence":"She buys fresh vegetables at the morning market.","zh_sentence":"å¥¹åœ¨æ—©å¸‚è²·æ–°é®®çš„è”¬èœã€‚","category":"åœ°é»/å ´æ‰€"},
  {"word":"expensive","zh":"æ˜‚è²´çš„","en_sentence":"That watch is too expensive for me.","zh_sentence":"é‚£éš»æ‰‹éŒ¶å°æˆ‘ä¾†èªªå¤ªè²´äº†ã€‚","category":"å½¢å®¹è©"},
  {"word":"cheap","zh":"ä¾¿å®œçš„","en_sentence":"We found a cheap hotel near the beach.","zh_sentence":"æˆ‘å€‘åœ¨æµ·ç˜é™„è¿‘æ‰¾åˆ°äº†ä¸€å®¶ä¾¿å®œçš„æ—…é¤¨ã€‚","category":"å½¢å®¹è©"},
  {"word":"enough","zh":"è¶³å¤ çš„","en_sentence":"Do we have enough food for all the guests?","zh_sentence":"æˆ‘å€‘æœ‰è¶³å¤ çš„é£Ÿç‰©çµ¦æ‰€æœ‰å®¢äººå—ï¼Ÿ","category":"é‡è©/å½¢å®¹è©"},
  {"word":"all","zh":"å…¨éƒ¨","en_sentence":"I ate all the cookies by myself.","zh_sentence":"æˆ‘è‡ªå·±åƒæ‰äº†æ‰€æœ‰é¤…ä¹¾ã€‚","category":"é™å®šè©/ä»£åè©"},
  {"word":"poor","zh":"è²§çª®çš„ï¼›å¯æ†çš„","en_sentence":"The poor man lost his job yesterday.","zh_sentence":"é‚£å€‹çª®äººæ˜¨å¤©å¤±æ¥­äº†ã€‚","category":"å½¢å®¹è©"},
  {"word":"early","zh":"æ—©çš„ï¼›ææ—©","en_sentence":"We need to get up early tomorrow.","zh_sentence":"æˆ‘å€‘æ˜å¤©éœ€è¦æ—©èµ·ã€‚","category":"å½¢å®¹è©/å‰¯è©"},
  {"word":"dirty","zh":"é«’çš„","en_sentence":"My shoes are dirty from walking in the mud.","zh_sentence":"æˆ‘çš„é‹å­åœ¨æ³¥æ¿˜ä¸­è¡Œèµ°å¼„é«’äº†ã€‚","category":"å½¢å®¹è©"},
  {"word":"easy","zh":"å®¹æ˜“çš„","en_sentence":"The test was surprisingly easy.","zh_sentence":"é€™æ¬¡è€ƒè©¦å‡ºä¹æ„æ–™åœ°å®¹æ˜“ã€‚","category":"å½¢å®¹è©"},
  {"word":"hard","zh":"å›°é›£çš„ï¼›åŠªåŠ›åœ°","en_sentence":"She works very hard to save money.","zh_sentence":"å¥¹éå¸¸åŠªåŠ›åœ°å·¥ä½œä¾†å­˜éŒ¢ã€‚","category":"å½¢å®¹è©/å‰¯è©"},
  {"word":"busy","zh":"å¿™ç¢Œçš„","en_sentence":"He is always busy with work and study.","zh_sentence":"ä»–ç¸½æ˜¯å¿™æ–¼å·¥ä½œå’Œå­¸ç¿’ã€‚","category":"å½¢å®¹è©"},
  {"word":"free","zh":"æœ‰ç©ºçš„ï¼›å…è²»çš„","en_sentence":"Are you free this afternoon to meet up?","zh_sentence":"ä½ ä»Šå¤©ä¸‹åˆæœ‰ç©ºè¦‹é¢å—ï¼Ÿ","category":"å½¢å®¹è©"},
  {"word":"need","zh":"éœ€è¦","en_sentence":"I need your help with this heavy box.","zh_sentence":"æˆ‘éœ€è¦ä½ å¹«å¿™æ¬é€™å€‹é‡ç®±å­ã€‚","category":"å‹•è©/åè©"},
  {"word":"end","zh":"çµæŸï¼›æœ«ç«¯","en_sentence":"The movie will end in five minutes.","zh_sentence":"é›»å½±å°‡åœ¨äº”åˆ†é˜å…§çµæŸã€‚","category":"åè©/å‹•è©"},
  {"word":"cost","zh":"èŠ±è²»","en_sentence":"How much does it cost to fix the car?","zh_sentence":"ä¿®ç†æ±½è»Šéœ€è¦å¤šå°‘éŒ¢ï¼Ÿ","category":"å‹•è©/åè©"},
  {"word":"buy","zh":"è³¼è²·","en_sentence":"I want to buy a new pair of glasses.","zh_sentence":"æˆ‘æƒ³è²·ä¸€å‰¯æ–°çœ¼é¡ã€‚","category":"å‹•è©"},
  {"word":"put","zh":"æ”¾ç½®","en_sentence":"Put the plate on the dining table.","zh_sentence":"æŠŠç›¤å­æ”¾åœ¨é¤æ¡Œä¸Šã€‚","category":"å‹•è©"},
  {"word":"feed","zh":"é¤µé£Ÿ","en_sentence":"Don't forget to feed the cat this evening.","zh_sentence":"ä»Šæ™šåˆ¥å¿˜äº†é¤µè²“ã€‚","category":"å‹•è©"},
  {"word":"sell","zh":"è²©è³£","en_sentence":"They sell fresh bread at the bakery.","zh_sentence":"ä»–å€‘åœ¨éºµåŒ…åº—è²©è³£æ–°é®®çš„éºµåŒ…ã€‚","category":"å‹•è©"},
  {"word":"also","zh":"ä¹Ÿ","en_sentence":"She is a singer and also an actress.","zh_sentence":"å¥¹æ˜¯æ­Œæ‰‹ï¼Œä¹Ÿæ˜¯æ¼”å“¡ã€‚","category":"å‰¯è©"},
  {"word":"once","zh":"ä¸€æ¬¡","en_sentence":"I have only been to Taipei once.","zh_sentence":"æˆ‘åªå»éå°åŒ—ä¸€æ¬¡ã€‚","category":"å‰¯è©"},
  {"word":"twice","zh":"å…©æ¬¡","en_sentence":"He visits his grandmother twice a week.","zh_sentence":"ä»–æ¯é€±æ¢æœ›ä»–çš„ç¥–æ¯å…©æ¬¡ã€‚","category":"å‰¯è©"},
  {"word":"place","zh":"åœ°æ–¹ï¼›æ”¾ç½®","en_sentence":"This is a lovely place for a picnic.","zh_sentence":"é€™æ˜¯ä¸€å€‹é©åˆé‡é¤çš„å¯æ„›åœ°æ–¹ã€‚","category":"åè©/å‹•è©"},
  {"word":"road","zh":"é“è·¯","en_sentence":"The road to the mountain is narrow.","zh_sentence":"é€šå¾€å±±ä¸Šçš„è·¯å¾ˆç‹¹çª„ã€‚","category":"åœ°é»"},
  {"word":"temple","zh":"å¯ºå»Ÿ","en_sentence":"We visited an ancient temple in the town.","zh_sentence":"æˆ‘å€‘åƒè§€äº†é®ä¸Šçš„ä¸€åº§å¤è€å¯ºå»Ÿã€‚","category":"åœ°é»"},
  {"word":"museum","zh":"åšç‰©é¤¨","en_sentence":"The new art museum opened last week.","zh_sentence":"æ–°çš„è—è¡“åšç‰©é¤¨ä¸Šé€±é–‹æ”¾äº†ã€‚","category":"åœ°é»"},
  {"word":"hotel","zh":"æ—…é¤¨","en_sentence":"We stayed at a fancy hotel near the beach.","zh_sentence":"æˆ‘å€‘ä½åœ¨æµ·ç˜é™„è¿‘çš„ä¸€å®¶é«˜ç´šæ—…é¤¨ã€‚","category":"åœ°é»"},
  {"word":"season","zh":"å­£ç¯€","en_sentence":"Spring is my favorite season of the year.","zh_sentence":"æ˜¥å¤©æ˜¯æˆ‘ä¸€å¹´ä¸­æœ€å–œæ­¡çš„å­£ç¯€ã€‚","category":"æ™‚é–“"},
  {"word":"autumn","zh":"ç§‹å¤©","en_sentence":"The leaves turn red and yellow in autumn.","zh_sentence":"æ¨¹è‘‰åœ¨ç§‹å¤©æœƒè®Šç´…è®Šé»ƒã€‚","category":"æ™‚é–“"},
  {"word":"snow","zh":"é›ªï¼›ä¸‹é›ª","en_sentence":"It is starting to snow outside.","zh_sentence":"å¤–é¢é–‹å§‹ä¸‹é›ªäº†ã€‚","category":"è‡ªç„¶"},
  {"word":"snowman","zh":"é›ªäºº","en_sentence":"The children built a big snowman in the yard.","zh_sentence":"å­©å­å€‘åœ¨é™¢å­è£¡å †äº†ä¸€å€‹å¤§é›ªäººã€‚","category":"åè©"},
  {"word":"plan","zh":"è¨ˆç•«","en_sentence":"Do you have a plan for the weekend?","zh_sentence":"ä½ é€±æœ«æœ‰ä»€éº¼è¨ˆç•«å—ï¼Ÿ","category":"æŠ½è±¡/å‹•è©"},
  {"word":"date","zh":"æ—¥æœŸï¼›ç´„æœƒ","en_sentence":"What is the date today?","zh_sentence":"ä»Šå¤©çš„æ—¥æœŸæ˜¯ä»€éº¼ï¼Ÿ","category":"æ™‚é–“"},
  {"word":"USA","zh":"ç¾åœ‹","en_sentence":"She plans to visit the USA next summer.","zh_sentence":"å¥¹è¨ˆç•«æ˜å¹´å¤å¤©å»ç¾åœ‹ã€‚","category":"åœ‹å®¶"},
  {"word":"photo","zh":"ç…§ç‰‡","en_sentence":"I keep my favorite photos in an album.","zh_sentence":"æˆ‘æŠŠæœ€å–œæ­¡çš„ç…§ç‰‡æ”¾åœ¨ç›¸ç°¿è£¡ã€‚","category":"åè©"},
  {"word":"mind","zh":"ä»‹æ„ï¼›é ­è…¦","en_sentence":"Do you mind closing the window?","zh_sentence":"ä½ ä»‹æ„é—œçª—æˆ¶å—ï¼Ÿ","category":"å‹•è©/åè©"},
  {"word":"exercise","zh":"é‹å‹•ï¼›ç·´ç¿’","en_sentence":"We should exercise every day to stay healthy.","zh_sentence":"æˆ‘å€‘æ‡‰è©²æ¯å¤©é‹å‹•ä»¥ä¿æŒå¥åº·ã€‚","category":"å‹•è©/åè©"},
  {"word":"practice","zh":"ç·´ç¿’","en_sentence":"She needs to practice the piano daily.","zh_sentence":"å¥¹éœ€è¦æ¯å¤©ç·´ç¿’é‹¼ç´ã€‚","category":"å‹•è©/åè©"},
  {"word":"team","zh":"éšŠä¼","en_sentence":"Our school baseball team won the championship.","zh_sentence":"æˆ‘å€‘å­¸æ ¡çš„æ£’çƒéšŠè´äº†å† è»ã€‚","category":"åœ˜é«”"},
  {"word":"problem","zh":"å•é¡Œ","en_sentence":"She needs help solving a math problem.","zh_sentence":"å¥¹éœ€è¦å¹«åŠ©è§£æ±ºæ•¸å­¸å•é¡Œã€‚","category":"æŠ½è±¡"},
  {"word":"toe","zh":"è…³è¶¾","en_sentence":"He stubbed his toe on the table edge.","zh_sentence":"ä»–çš„è…³è¶¾æ’åˆ°æ¡Œé‚Šã€‚","category":"èº«é«”"},
  {"word":"violin","zh":"å°æç´","en_sentence":"He practices the violin every evening.","zh_sentence":"ä»–æ¯å¤©æ™šä¸Šç·´å°æç´ã€‚","category":"æ¨‚å™¨"},
  {"word":"flute","zh":"é•·ç¬›","en_sentence":"The sound of the flute is sweet.","zh_sentence":"é•·ç¬›çš„è²éŸ³å¾ˆç”œç¾ã€‚","category":"æ¨‚å™¨"},
  {"word":"special","zh":"ç‰¹åˆ¥çš„","en_sentence":"Today is special because it's my birthday.","zh_sentence":"ä»Šå¤©å¾ˆç‰¹åˆ¥ï¼Œå› ç‚ºæ˜¯æˆ‘ç”Ÿæ—¥ã€‚","category":"å½¢å®¹è©"},
  {"word":"afraid","zh":"å®³æ€•çš„","en_sentence":"I am afraid of spiders.","zh_sentence":"æˆ‘å®³æ€•èœ˜è››ã€‚","category":"æƒ…ç·’"},
  {"word":"same","zh":"ç›¸åŒçš„","en_sentence":"We chose the same color.","zh_sentence":"æˆ‘å€‘é¸äº†ç›¸åŒçš„é¡è‰²ã€‚","category":"å½¢å®¹è©"},
  {"word":"different","zh":"ä¸åŒçš„","en_sentence":"They have different ideas.","zh_sentence":"ä»–å€‘æœ‰ä¸åŒçš„æƒ³æ³•ã€‚","category":"å½¢å®¹è©"},
  {"word":"dry","zh":"ä¹¾ç‡¥çš„","en_sentence":"Please keep the dishes dry.","zh_sentence":"è«‹ç¢ºä¿ç›¤å­ä¹¾ç‡¥ã€‚","category":"å½¢å®¹è©"},
  {"word":"wet","zh":"æ¿•çš„","en_sentence":"The floor is wet; be careful.","zh_sentence":"åœ°æ¿æ˜¯æ¿•çš„ï¼Œå°å¿ƒã€‚","category":"å½¢å®¹è©"},
  {"word":"popular","zh":"å—æ­¡è¿çš„","en_sentence":"That coffee shop is popular.","zh_sentence":"é‚£å®¶å’–å•¡åº—å¾ˆå—æ­¡è¿ã€‚","category":"å½¢å®¹è©"},
  {"word":"dark","zh":"é»‘æš—çš„","en_sentence":"It gets dark early in winter.","zh_sentence":"å†¬å¤©å¾ˆæ—©å°±å¤©é»‘äº†ã€‚","category":"å½¢å®¹è©"},
  {"word":"know","zh":"çŸ¥é“","en_sentence":"Do you know the way to the post office?","zh_sentence":"ä½ çŸ¥é“å»éƒµå±€çš„è·¯å—ï¼Ÿ","category":"å¿ƒç†"},
  {"word":"keep","zh":"ä¿æŒ","en_sentence":"Please keep quiet during the meeting.","zh_sentence":"é–‹æœƒæ™‚è«‹ä¿æŒå®‰éœã€‚","category":"å‹•ä½œ"},
  {"word":"join","zh":"åŠ å…¥","en_sentence":"Would you like to join us for lunch?","zh_sentence":"è¦ä¸€èµ·åƒåˆé¤å—ï¼Ÿ","category":"å‹•ä½œ"},
  {"word":"throw","zh":"ä¸Ÿ","en_sentence":"Please throw the trash into the bin.","zh_sentence":"è«‹æŠŠåƒåœ¾ä¸Ÿé€²åƒåœ¾æ¡¶ã€‚","category":"å‹•ä½œ"},
  {"word":"hit","zh":"æ“Šä¸­","en_sentence":"He hit the ball hard.","zh_sentence":"ä»–ç”¨åŠ›æ“Šçƒã€‚","category":"å‹•ä½œ"},
  {"word":"enjoy","zh":"äº«å—","en_sentence":"We enjoy spending time in nature.","zh_sentence":"æˆ‘å€‘å–œæ­¡å¾…åœ¨å¤§è‡ªç„¶ã€‚","category":"æƒ…ç·’"}
];

/* ===================== åˆå§‹åŒ–è³‡æ–™ ===================== */
const pick = (arr,n)=>arr.slice().sort(()=>Math.random()-.5).slice(0,Math.min(n,arr.length));
function initData(){
  const list = pick(VOCAB_DATA,GAME.QUESTIONS_COUNT);
  state.data = list.map(v=>({answer:v.word, zh:v.zh, sentence:safeBlank(v.en_sentence,v.word),
                             original:v.en_sentence, zh_sentence:v.zh_sentence, category:v.category}));
  $('#total-questions').textContent = state.data.length;
}

/* ===================== æœ¬åœ°å„²å­˜ & æ˜Ÿæ˜Ÿ ===================== */
const loadStars = ()=> parseInt(localStorage.getItem('totalStars')||'0',10);
const saveStars = n => { localStorage.setItem('totalStars',n); updateStars(); };
const addStars = n => saveStars(loadStars()+n);
const updateStars = ()=> { $('#totalStarsCount').textContent = loadStars(); };
function resetProgress(){ localStorage.removeItem('fillIndex'); location.reload(); }

/* ===================== èƒŒæ™¯éŸ³æ¨‚ ===================== */
let music = null, playing=false;
function initMusic(){
  music = $('#backgroundMusic'); music.volume = .3;
  if(localStorage.getItem('bgMusicState')==='playing') playMusic();
  $('#bgMusicControl').onclick = toggleMusic; updateMusicBtn();
}
function playMusic(){ if(!music) return; music.play().then(()=>{playing=true;localStorage.setItem('bgMusicState','playing');updateMusicBtn();}).catch(()=>{}); }
function pauseMusic(){ if(!music) return; music.pause(); playing=false; localStorage.setItem('bgMusicState','paused'); updateMusicBtn(); }
function toggleMusic(){ playing?pauseMusic():playMusic(); }
function updateMusicBtn(){ const b=$('#bgMusicControl'); b.textContent = playing?'ğŸ”Š':'ğŸ”‡'; b.classList.toggle('paused',!playing); }

/* ===================== èªéŸ³ ===================== */
function pickVoice(){
  const vs = speechSynthesis.getVoices();
  const prefer = ['Google US English','Microsoft Aria Online','Microsoft Jenny Online','Samantha','Jenny','Aria','en-US'];
  speakSys.voice = vs.find(v=>prefer.some(p=>v.name.includes(p))) || vs.find(v=>v.lang==='en-US') || vs[0];
}
if(typeof speechSynthesis!=='undefined'){ speechSynthesis.onvoiceschanged=pickVoice; pickVoice(); }

/* ===================== é¡Œç›®æµç¨‹ ===================== */
function timerStart(){
  clearInterval(state.timer); let t=GAME.TIME_LIMIT;
  $('#time-left').textContent=t; $('#timer').classList.remove('hidden');
  state.timer=setInterval(()=>{ t--; $('#time-left').textContent=t; if(t<=0){ clearInterval(state.timer); revealAnswer(true); } },1000);
}
function timerStop(){ clearInterval(state.timer); }

function showQ(){
  if(!state.data.length){ $('#question-container').innerHTML='<div style="color:#f66;font-size:1.2rem">âš ï¸ é¡Œåº«æ²’æœ‰é¡Œç›®</div>'; return; }
  if(state.i>=state.data.length){ endGame(); return; }

  state.answered=false; state.tries=0;
  const q = state.data[state.i];
  $('#question-container').innerHTML =
    `<div class="question-title">è‹±æ–‡å¥å­ï¼š</div>
     <div class="question-sentence">${q.sentence.replace('___','<span class="blank">___</span>')}</div>
     <div class="question-zh">ä¸­æ–‡æç¤ºï¼š${q.zh_sentence||q.zh}</div>
     <input id="user-input" placeholder="è¼¸å…¥ç­”æ¡ˆâ€¦" autocomplete="off" />
     <div class="btn-row">
       <button id="submit-btn" onclick="checkAnswer()">é€å‡º</button>
       <button id="skip-btn" onclick="skipQ()">è·³é</button>
       <button id="next-btn" onclick="nextQ()">ä¸‹ä¸€é¡Œ</button>
     </div>
     <div id="feedback"></div>
     <button id="speak-btn">ğŸ”Š æœ—è®€</button>`;

  $('#speak-btn').onclick = ()=> { say(q.original,.97,()=> setTimeout(()=>{ say(safeBlank(q.original,q.answer).replace('___','...'),1.02,()=>setTimeout(()=>say(q.answer,1.08),350)); },350)); };
  const input = $('#user-input'); input.focus();
  input.onkeydown = e => { if(e.key==='Enter') checkAnswer(); else if(e.key.length===1){ try{ SOUNDS.type.currentTime=0; SOUNDS.type.play(); }catch(_){} } };
  $('#current-index').textContent = state.i+1; timerStart(); setTimeout(()=>say(q.original,.97),400);
  window.answerStartTime = Date.now();
}

function revealAnswer(autoNext=false){
  state.tries = 999;
  $('#feedback').innerHTML = `<span style="color:#f66">â° æ™‚é–“åˆ°ï¼æ­£ç¢ºç­”æ¡ˆï¼š<b>${state.data[state.i].answer}</b></span>`;
  $('#submit-btn').disabled = true; $('#user-input').disabled = true;
  log(false);
  if(autoNext) setTimeout(()=>{ state.i++; showQ(); }, 500);
}

function log(correct,user=''){
  const q = state.data[state.i];
  state.log[state.i] = { word:q.answer, zh:q.zh_sentence||q.zh, en:q.original, user, correct, stars:0, category:q.category };
}

function checkAnswer(){
  if(state.answered) return;
  state.tries++;
  const ans = state.data[state.i].answer.toLowerCase();
  const val = $('#user-input').value.trim().toLowerCase();

  if(val===ans){
    state.answered=true; timerStop();
    const sec = (Date.now()-(window.answerStartTime||Date.now()))/1000;
    let bonus = sec<10 ? 2 : 0;
    $('#feedback').innerHTML = `<div class="feedback-box feedback-correct">âœ… ç­”å°äº†ï¼å¤ªæ£’äº†ï¼ ${bonus?'<span class="feedback-bonus">BONUS! â±ï¸ +2</span>':''}</div>`;
    $('#user-input').disabled=true; $('#submit-btn').disabled=true; say(ans,1.1);
    log(true,$('#user-input').value.trim());
    const add = 1+bonus; addStars(add); state.sessionStars+=add; $('#sessionStarsDisplay').textContent=`æœ¬æ¬¡å·²ç²å¾— ${state.sessionStars} é¡†æ˜Ÿæ˜Ÿ`;
    try{ SOUNDS.correct.currentTime=0; SOUNDS.correct.play(); }catch(_){}
    setTimeout(()=>{ state.i++; showQ(); },1300);
  }else{
    if(state.tries<GAME.MAX_ATTEMPTS){
      $('#feedback').innerHTML = `<div class="feedback-box feedback-wrong">âŒ å†è©¦ä¸€æ¬¡ï¼ä½ å¯ä»¥çš„ï¼</div>`;
      try{ SOUNDS.wrong.currentTime=0; SOUNDS.wrong.play(); }catch(_){}
    }else{
      $('#feedback').innerHTML = `<div class="feedback-box feedback-wrong">âŒ æ­£ç¢ºç­”æ¡ˆï¼š<b>${state.data[state.i].answer}</b><br>åˆ¥æ°£é¤’ï¼Œå†æ¥å†å²ï¼</div>`;
      $('#user-input').disabled=true; $('#submit-btn').disabled=true;
      log(false,$('#user-input').value.trim());
      try{ SOUNDS.wrong.currentTime=0; SOUNDS.wrong.play(); }catch(_){}
      setTimeout(()=>{ state.i++; showQ(); },1300);
    }
  }
}

function skipQ(){ timerStop(); log(null,''); $('#feedback').innerHTML='<span style="color:#bbb">å·²è·³éæœ¬é¡Œ</span>'; setTimeout(()=>{ state.i++; showQ(); },400); }
function nextQ(){ timerStop(); if(!state.log[state.i]){ log(false,$('#user-input')?.value||''); $('#feedback').innerHTML='<span style="color:#bbb">æœªä½œç­”</span>'; } setTimeout(()=>{ state.i++; showQ(); },400); }

/* ===================== çµæŸç•«é¢ ===================== */
function endGame(){
  const correct = state.log.filter(x=>x && x.correct===true).length;
  const wrong   = state.log.filter(x=>x && x.correct===false).length;
  $('#endSessionStars').textContent = state.sessionStars;
  $('#endCorrectCount').textContent = correct;
  $('#endWrongCount').textContent = wrong;
  $('#endTotalStars').textContent = loadStars();
  $('#gameEndModal').style.display='flex';
  timerStop();
  try{ SOUNDS.correct.currentTime=0; SOUNDS.correct.play(); }catch(_){}
}
function restartGame(){
  $('#gameEndModal').style.display='none';
  state.i=0; state.sessionStars=0; state.log=[];
  initData(); $('#current-index').textContent=1; $('#sessionStarsDisplay').textContent='æœ¬æ¬¡å·²ç²å¾— 0 é¡†æ˜Ÿæ˜Ÿ';
  showQ();
}

/* ===================== è¤‡ç¿’/çµ±è¨ˆ/åŒ¯å‡º ===================== */
function showReviewModal(){ timerStop(); fillCategories(); showList('all'); $('#totalVocabCount').textContent=VOCAB_DATA.length; $('#reviewModal').style.display='flex'; }
function closeReviewModal(){ $('#reviewModal').style.display='none'; if(state.i<state.data.length && !state.answered) timerStart(); }
function speakWord(w){ say(w,.9); }

function fillCategories(){
  const sel = $('#categoryFilter'); sel.innerHTML = '<option value="all">å…¨éƒ¨å–®å­—</option>';
  [...new Set(VOCAB_DATA.map(v=>v.category))].forEach(c=>{ const o=document.createElement('option'); o.value=c; o.textContent=c; sel.appendChild(o); });
  sel.onchange = e=> showList(e.target.value);
}

function showList(cat){
  const box=$('#reviewWordsContainer'); box.innerHTML='';
  const list = cat==='all'? VOCAB_DATA : VOCAB_DATA.filter(v=>v.category===cat);
  $('#totalVocabCount').textContent=list.length;
  if(cat!=='all'){
    const t=document.createElement('div'); t.style.cssText='color:#0ff;font-size:1.1rem;font-weight:700;margin:8px 0;padding:8px;background:rgba(0,255,255,.1);border-radius:8px;text-align:center';
    t.textContent=`ğŸ“‚ ${cat} (${list.length}å€‹å–®å­—)`; box.appendChild(t);
  }
  list.forEach((v,i)=>{
    const d=document.createElement('div');
    d.style.cssText='background:rgba(255,255,255,.1);border:1px solid #ffd700;border-radius:10px;padding:12px;margin:8px 0;text-align:left;cursor:pointer;transition:.2s';
    d.innerHTML = `
      <div style="display:flex;gap:12px;align-items:flex-start">
        <div style="flex:1;min-width:0">
          <div style="color:#ffd700;font-weight:700;margin-bottom:6px;word-break:break-word">${i+1}. ${v.word}${cat==='all'?` <span style="color:#0ff;font-size:.8rem;background:rgba(0,255,255,.2);padding:2px 6px;border-radius:4px">${v.category}</span>`:''}</div>
          <div style="color:#fff;margin-bottom:6px">${v.zh}</div>
          <div style="color:#0ff;font-size:.95rem;font-style:italic">${v.en_sentence}</div>
        </div>
        <button onclick="event.stopPropagation();speakWord('${v.word.replace(/'/g,"\\'")}')" style="background:#0ff;color:#000;border:none;border-radius:50%;width:42px;height:42px;font-size:1.2rem;box-shadow:0 2px 8px rgba(0,255,255,.3)">ğŸ”Š</button>
      </div>`;
    d.onmouseenter=()=>{ d.style.background='rgba(255,215,0,.2)'; d.style.transform='scale(1.02)'; };
    d.onmouseleave=()=>{ d.style.background='rgba(255,255,255,.1)'; d.style.transform='scale(1)'; };
    d.onclick=()=>speakWord(v.word);
    box.appendChild(d);
  });
  if(!list.length){ const n=document.createElement('div'); n.style.cssText='text-align:center;color:#888;padding:30px;font-style:italic'; n.textContent='æ­¤åˆ†é¡æš«ç„¡å–®å­—'; box.appendChild(n); }
}

function showVocabStats(){
  const stats = {}; VOCAB_DATA.forEach(v=> stats[v.category]=(stats[v.category]||0)+1 );
  const modal=document.createElement('div'); modal.className='modal'; modal.style.display='flex';
  modal.innerHTML = `<div class="modal-content" style="max-width:600px">
    <div class="end-icon">ğŸ“Š</div><h2 style="color:#ffd700">å­—åº«çµ±è¨ˆ</h2>
    <div style="text-align:left;margin:12px 0">${Object.entries(stats).map(([c,n])=>`
      <div style="display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px solid rgba(255,215,0,.3)">
        <span style="color:#fff">${c}</span><span style="color:#0ff;font-weight:700">${n} å€‹å–®å­—</span>
      </div>`).join('')}
      <div style="display:flex;justify-content:space-between;padding:10px 0;border-top:2px solid #ffd700;margin-top:8px;font-weight:700">
        <span style="color:#ffd700">ç¸½è¨ˆ</span><span style="color:#ffd700">${VOCAB_DATA.length} å€‹å–®å­—</span>
      </div>
    </div>
    <div class="end-buttons"><button onclick="this.closest('.modal').remove()">é—œé–‰</button></div></div>`;
  modal.onclick=e=>{ if(e.target===modal) modal.remove(); };
  document.body.appendChild(modal);
}

function exportVocabData(){
  const csv = [
    ['å–®å­—','ä¸­æ–‡','è‹±æ–‡ä¾‹å¥','ä¸­æ–‡ä¾‹å¥','åˆ†é¡'],
    ...VOCAB_DATA.map(v=>[v.word,v.zh,v.en_sentence,v.zh_sentence||'',v.category])
  ].map(r=>r.map(x=>`"${String(x).replace(/"/g,'""')}"`).join(',')).join('\n');
  const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'}); const a=document.createElement('a');
  a.href=URL.createObjectURL(blob); a.download=`zeus_vocabulary_${new Date().toISOString().slice(0,10)}.csv`; a.click();
}

/* ===================== äº‹ä»¶ & å•Ÿå‹• ===================== */
function updateIndex(){ $('#current-index').textContent = state.i+1; }
function addNotice(msg,type='info'){
  const n=document.createElement('div'); n.style.cssText=`position:fixed;top:20px;left:50%;transform:translateX(-50%);
    background:${type==='success'?'#4caf50':'#2196f3'};color:#fff;padding:10px 18px;border-radius:8px;font-weight:700;z-index:2000`;
  n.textContent=msg; document.body.appendChild(n); setTimeout(()=>n.remove(),2200);
}
function addStarsAndToast(n){ addStars(n); addNotice('âœ… å­—åº«å·²æˆåŠŸåŒ¯å‡ºï¼','success'); }

document.addEventListener('DOMContentLoaded',()=>{
  updateStars(); $('#sessionStarsDisplay').textContent='æœ¬æ¬¡å·²ç²å¾— 0 é¡†æ˜Ÿæ˜Ÿ';
  initData(); state.i=0; updateIndex(); showQ(); localStorage.removeItem('fillIndex');
  initMusic();
  // é»å½ˆçª—å¤–é—œé–‰
  ['reviewModal','gameEndModal'].forEach(id=>{
    const m=$('#'+id); if(m) m.addEventListener('click',e=>{ if(e.target===m) m.style.display='none'; });
  });
});

</script>
</body>
</html>
